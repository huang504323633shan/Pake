import{r as o,d as K,u as A,t as p,j as s}from"./index-CBGP0-9V.js";import{S as P,a as B}from"./public-DIX_InEl.js";import{u as F}from"./request-CRuLXg2Q.js";import{C as O}from"./chevron-left-BTOK750O.js";import{C as _}from"./check-4WT4jp_I.js";function G(){const b=o.useRef(!1),R=K(),f=A(),{phone:c,areaCode:m}=R.state||{},[i,x]=o.useState(["","","","","",""]),[h,j]=o.useState(60),[u,v]=o.useState(!0),[l,y]=o.useState(!1),[L,w]=o.useState(!1),a=o.useRef([]);o.useEffect(()=>{a.current=a.current.slice(0,6)},[]),o.useEffect(()=>{b.current||(b.current=!0,u&&C())},[]),o.useEffect(()=>{if(!c){f("/login");return}},[c]),o.useEffect(()=>{let t;return h>0&&!u?t=setTimeout(()=>{j(n=>n-1)},1e3):v(!0),()=>{t&&clearTimeout(t)}},[h,u]);const D=async()=>{u&&C()},C=async()=>{P({mobile:c,telephoneCode:m,scene:1}).then(async t=>{console.log("发送成功"),j(60),v(!1),w(!0),setTimeout(()=>{w(!1)},3e3)}).catch(t=>{console.log("短信发送失败",t),p({variant:"destructive",title:"短信发送失败",description:(t==null?void 0:t.msg)||"短信发送失败"})})},N=async t=>{var n;console.log("登录中");try{y(!0);const e=await B({mobile:c,telephoneCode:m,code:t});e?(p({description:s.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[200px] min-h-[100px]",children:[s.jsx(_,{className:"w-10 h-10 mb-1"}),s.jsx("span",{className:"text-lg font-medium",children:"成功"})]}),variant:"default",duration:1e3}),localStorage.setItem("ACCESS_TOKEN",e.accessToken),localStorage.setItem("REFRESH_TOKEN",e.refreshToken),F.getState().auth.setAccessToken(e.accessToken),f("/app/project-select")):p({variant:"destructive",title:"登录失败",description:"登录失败"})}catch(e){console.error("登录失败:",e),x(["","","","","",""]),(n=a.current[0])==null||n.focus()}finally{y(!1)}},E=(t,n)=>{var d;if(console.log("验证码改变了",t),!/^\d*$/.test(n))return;const e=[...i];e[t]=n,x(e),n&&t<5&&a.current[t+1]&&((d=a.current[t+1])==null||d.focus()),e.every(r=>r)&&(console.log("验证码已填满6位，自动提交"),N(e.join("")))},S=t=>{var d;t.preventDefault();const e=t.clipboardData.getData("text").replace(/[^\d]/g,"").split("").slice(0,6);if(e.length){const r=[...i];e.forEach((g,k)=>{k<6&&(r[k]=g)}),x(r),e.length<6&&a.current[e.length]&&((d=a.current[e.length])==null||d.focus()),r.length===6&&r.every(g=>g)&&(console.log("粘贴完成，自动提交"),N(r.join("")))}},T=(t,n)=>{var e;n.key==="Backspace"&&!i[t]&&t>0&&a.current[t-1]&&((e=a.current[t-1])==null||e.focus())},I=()=>{f("/login")};return s.jsxs("div",{className:"min-h-[100dvh] flex flex-col items-center bg-white px-3 pt-12 safe-top",children:[s.jsx("div",{className:"w-full text-2xl  font-bold mb-4 mt-4",children:"输入手机号验证码"}),s.jsx("div",{className:"w-full text-left mb-8",children:s.jsxs("div",{className:"text-[14px] text-gray-500",children:["请输入发送至"," ",s.jsxs("span",{className:"font-bold text-black",children:[m,c==null?void 0:c.slice(0,3),"****",c==null?void 0:c.slice(-2)]})," ","的6位验证码， 10分钟内有效，如未收到，请重新获取验证"]})}),s.jsx("div",{className:"w-full mb-4",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("div",{className:"flex-1 flex justify-between items-center",children:i.slice(0,3).map((t,n)=>s.jsx("input",{ref:e=>{a.current&&(a.current[n]=e)},type:"text",maxLength:1,value:t,onChange:e=>E(n,e.target.value),onKeyDown:e=>T(n,e),onPaste:S,disabled:l,className:"w-[50px] h-[50px] mr-1 text-center text-xl font-medium border rounded-lg focus:border-[#0363E0] focus:ring-1 focus:ring-[#0363E0] outline-none disabled:bg-gray-100 disabled:text-gray-400"},n))}),s.jsx("div",{className:"w-6 h-[2px] bg-black mx-2"}),s.jsx("div",{className:"flex-1 flex justify-between items-center",children:i.slice(3).map((t,n)=>s.jsx("input",{ref:e=>{a.current&&(a.current[n+3]=e)},type:"number",maxLength:1,value:t,onChange:e=>E(n+3,e.target.value),onKeyDown:e=>T(n+3,e),onPaste:S,disabled:l,className:"w-[50px] h-[50px] mr-1 text-center text-xl font-medium border rounded-lg focus:border-[#0363E0] focus:ring-1 focus:ring-[#0363E0] outline-none disabled:bg-gray-100 disabled:text-gray-400"},n+3))})]})}),s.jsx("div",{className:"w-full text-[14px] text-gray-400",children:u?s.jsx("button",{className:"text-[#0363E0]",onClick:D,disabled:l,children:"重新获取验证码"}):s.jsxs("span",{children:[h,"秒后可重新获取验证码"]})}),(L||l)&&s.jsx("div",{className:"fixed inset-0 flex items-center justify-center pointer-events-none",children:s.jsx("div",{className:"bg-[#666666] text-white px-6 py-3 rounded-lg text-[14px]",children:l?"登录中，请稍候...":"验证码已通过短信发送，请耐心等待~"})}),s.jsx("button",{className:"absolute left-1 top-5 hover:bg-gray-100 rounded-full transition-colors",onClick:I,disabled:l,children:s.jsx(O,{className:"w-6 h-6"})})]})}export{G as default};
