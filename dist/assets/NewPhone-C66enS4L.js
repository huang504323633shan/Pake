import{r as s,u as T,j as e,X as M,t as x}from"./index-CBGP0-9V.js";import{g as P,c as R}from"./user-BeTEafWb.js";import{S as U}from"./public-DIX_InEl.js";import{C as A}from"./CountryCodeSelect-Ci_nzvUD.js";import{C as F}from"./chevron-left-BTOK750O.js";import{C as O}from"./index-DCyT9wRJ.js";import"./request-CRuLXg2Q.js";import"./sheet-DoL-zHHZ.js";import"./input-CZNvtCT8.js";import"./search-DxQ-bB_0.js";import"./index-jn0p1ufw.js";function Q(){const m=s.useRef(!1),u=T(),[n,b]=s.useState(""),[o,h]=s.useState(""),[N,p]=s.useState(!1),[_,i]=s.useState(!1),[f,v]=s.useState(0),[w,a]=s.useState(!1),[E,r]=s.useState(""),[S,l]=s.useState(!1),[y,c]=s.useState("+86"),[g,j]=s.useState({nickname:"",email:"",mobile:"",telephoneCode:"",avatar:"",deptNames:[],userPosition:[],companyName:""}),k=async()=>{try{const t=await P();j(t),c(t.telephoneCode)}catch(t){x({variant:"destructive",title:"获取数据失败",description:(t==null?void 0:t.msg)||"获取数据失败",duration:1e3})}};s.useEffect(()=>{if(!m.current){m.current=!0;let t=JSON.parse(localStorage.getItem("USER_INFO"));t&&t.mobile?(j(t),c(t.telephoneCode)):k()}},[]);const L=async()=>{U({mobile:g.mobile,telephoneCode:g.telephoneCode,scene:10}).then(async t=>{v(60),r("验证码已发送"),a(!0),setTimeout(()=>a(!1),2e3);const d=setInterval(()=>{v(C=>C<=1?(clearInterval(d),i(!1),0):C-1)},1e3)}).catch(t=>{console.log("短信发送失败",t),x({variant:"destructive",title:"短信发送失败",description:(t==null?void 0:t.msg)||"短信发送失败",duration:1e3})})},D=async()=>{if(n)try{i(!0),L()}catch{i(!1),r("发送失败，请重试"),a(!0),setTimeout(()=>a(!1),2e3)}},I=async()=>{if(!(!n||!o))try{p(!0),await new Promise(d=>setTimeout(d,1e3)),await R({mobile:n,code:o})?(r("手机号修改成功"),a(!0),setTimeout(()=>{u("/app/user-settings")},2e3)):x({variant:"destructive",title:"验证失败",description:"验证失败",duration:1e3})}catch{r("修改失败，请重试"),a(!0),setTimeout(()=>a(!1),2e3)}finally{p(!1)}};return e.jsxs("div",{className:"min-h-[100dvh] bg-white",children:[e.jsx("div",{className:"flex items-center px-3 py-4",children:e.jsx(F,{className:"w-6 h-6",onClick:()=>u(-1)})}),e.jsxs("div",{className:"px-5",children:[e.jsx("div",{className:"flex-1 text-left text-[18px] mb-2 mt-4 font-[600]",children:"更换手机号"}),e.jsx("div",{className:"text-[13px] text-[#999999] mb-8",children:"为保障您的账号安全，请进行安全验证，以确保是您本人在操作"}),e.jsxs("div",{className:"flex items-center gap-2 mb-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#0363E0] text-white flex items-center justify-center text-[12px]",children:"1"}),e.jsx("span",{className:"ml-1 text-[14px]",children:"验证"})]}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 12L10 8L6 4",stroke:"#CCCCCC",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#0363E0] text-white flex items-center justify-center text-[12px]",children:"2"}),e.jsx("span",{className:"ml-1 text-[14px]",children:"绑定"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-[14px] text-[#333333] mb-1",children:"手机号"}),e.jsxs("div",{className:"flex items-center gap-4 border-b border-[#EEEEEE]",children:[e.jsxs("button",{className:"flex items-center text-[#9F9898]",onClick:()=>l(!0),children:[e.jsx("span",{className:"text-[13px]",children:y}),e.jsx(O,{className:"w-4 h-4 ml-1"})]}),e.jsx("input",{type:"tel",value:n,onChange:t=>b(t.target.value),placeholder:"请输入新手机号",maxLength:11,className:"flex-1 h-12 bg-white text-[14px] placeholder:text-[#999999] focus:outline-none"})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-[14px] text-[#333333] mb-1",children:"验证码"}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:o,onChange:t=>h(t.target.value),placeholder:"请输入验证码",maxLength:6,className:"w-full h-12 bg-white text-[14px] placeholder:text-[#999999] border-b border-[#EEEEEE] focus:border-[#0363E0] focus:outline-none transition-colors pr-8"}),o&&e.jsx(M,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-[#999999] cursor-pointer",onClick:()=>h("")})]}),e.jsx("button",{className:"h-[30px] px-3 text-[14px] text-[#333333] disabled:text-[#999999] whitespace-nowrap border border-[#EEEEEE] rounded",onClick:D,disabled:!n,children:f>0?`${f}s后重新获取`:"获取验证码"})]})]}),e.jsx("button",{className:"w-full h-[35px] bg-[#0D0D0D] text-white rounded-full text-[14px] font-medium disabled:opacity-50 disabled:cursor-not-allowed",onClick:I,disabled:!n||!o||N,children:"确定"})]}),w&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"bg-[#666666] text-white px-6 py-3 rounded-lg text-[14px]",children:E})}),e.jsx(A,{open:S,onClose:()=>{l(!1)},onSelect:t=>{c(t),l(!1)}})]})}export{Q as default};
