import{c as qe,r as R,j as y,X as dt,P as ue,n as ft,h as pe,l as ht,m as xe,o as it,y as gr,V as vr,k as ae,z as xr,f as pt,A as yr,D as Er,a as ye,B as Sr,s as _t,u as mt}from"./index-CBGP0-9V.js";import{B as Pe}from"./button-CiArJRhC.js";import{e as br,h as wr,g as Lr}from"./public-DIX_InEl.js";import{T as Ar,C as st,F as gt,a as Rr}from"./index-CEBml3j_.js";import{g as $e,p as vt}from"./request-CRuLXg2Q.js";import{C as Ve,F as Cr}from"./index-DCyT9wRJ.js";import{S as xt}from"./search-DxQ-bB_0.js";import{C as We}from"./check-4WT4jp_I.js";import{I as Tr}from"./input-CZNvtCT8.js";import{u as Or,C as yt,b as Ir,c as Mr,d as Pr,a as Dr}from"./index-BzXJQprt.js";import{S as jr,b as Fr,a as Nr,c as Br,d as kr,e as Ur,f as Vr}from"./sheet-DoL-zHHZ.js";import{u as et,h as Wr,a as Kr,R as Gr}from"./index-jn0p1ufw.js";import{u as zr,o as Hr,s as Yr,f as Xr,a as Zr,b as Jr,h as Qr,l as qr,c as $r}from"./floating-ui.react-dom-2nbOamx8.js";import{u as en}from"./index-D-Z7Lifn.js";import{u as tn}from"./index-S6Ml47UC.js";import{a as rn}from"./uiStore-BW39O6R7.js";import{B as nn}from"./BottomNavigation-BvwDsqnO.js";import"./publicFun-CiZ9vL8Y.js";import"./task-status-C8h5zVQz.js";import"./avatar-CZoOSk0v.js";import"./date-picker-Bebv3-qP.js";import"./chevron-left-BTOK750O.js";import"./chevron-right-Bag1OeAJ.js";import"./task-CaSVpYz-.js";import"./plus-CHP_XERv.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sn=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],on=qe("map-pin",sn);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const an=[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]],ln=qe("user-round",an);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["circle",{cx:"12",cy:"10",r:"8",key:"1gshiw"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 22h10",key:"10w4w3"}],["path",{d:"M12 22v-4",key:"1utk9m"}]],cn=qe("webcam",un),dn=[{id:"tasks",value:"rwQuantity",label:"任务",icon:"clipboard",num:0},{id:"gis",value:"gisQuantity",label:"地图",icon:"map",num:0},{id:"monitor",value:"jkQuantity",label:"现场",icon:"video",num:0},{id:"reports",value:"bbQuantity",label:"报表",icon:"chart",num:0}],fn=({activeTab:O,onTabChange:D,taskCount:A})=>{const j=R.useRef(!1),[N,V]=R.useState(dn);return R.useEffect(()=>{const v=async()=>{try{let g=localStorage.getItem("projectId");const h=await br({projectId:g});h&&V(x=>x.map(f=>({...f,num:h[f.value]||0})))}catch(g){console.error("获取工作台数量失败:",g)}};j.current||(v(),j.current=!0)},[]),y.jsx("div",{className:"flex justify-around items-center p-2 ",children:N.map(v=>{const g=v.id==="tasks"&&A!==void 0?A:v.num;return y.jsxs(Pe,{variant:"ghost",className:`rounded-full h-9 px-6 ${O===v.id?"bg-[#010a1a] text-white hover:bg-[#010a1a] hover:text-white":"bg-white text-gray-500 hover:bg-gray-100"}`,onClick:()=>D(v.id),children:[y.jsx("span",{children:v.label}),g&&g>0?y.jsx("span",{className:"flex items-center justify-center w-5 h-5 bg-[#3E4551] text-white rounded-full text-xs ml-2",children:g}):null]},v.id)})})},hn=({setShowBottomNavGlobal:O,updateTaskCount:D})=>y.jsx(Ar,{onScrollDirectionChange:A=>{O(A)},updateTaskCount:D});function Et(O){return new Promise((D,A)=>{if(window.T){D();return}const j=document.createElement("script");j.type="text/javascript",j.src=`https://api.tianditu.gov.cn/api?v=4.0&tk=${O}`,j.async=!0,j.defer=!0,j.onload=()=>D(),j.onerror=()=>A(new Error("加载天地图脚本失败")),document.head.appendChild(j)})}function pn(O){return new Promise((D,A)=>{if(window.google&&window.google.maps){D();return}const j=document.createElement("script");j.type="text/javascript",j.src=`https://maps.googleapis.com/maps/api/js?key=${O}&libraries=places`,j.async=!0,j.defer=!0,j.onload=()=>D(),j.onerror=()=>A(new Error("加载谷歌地图脚本失败")),document.head.appendChild(j)})}const St="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADMAAAAYCAYAAABXysXfAAAAAXNSR0IArs4c6QAACUpJREFUWEfdmFlzHNUVx3+9b7OPrNWyhWW8ERsnxMUW4CV5yDfMh0iVq0hCFRUCmKQKCBBSCRRmsSzLsvbZNEvv3al7Wz2SQCZUHnNepqfvvd3nf87/bK3wfyTK07AEoZ9PopFc1tCwTAdN08/cbujGU59THoiTOD/rcJzEGLpBmibEcYJh6Ge+56e84wdKCBDDuMvecJNOdIAWFls8vYmh2hiqNtXJyisoTobjOpi5g6oYZ4KN84A0OL0U53FhqBzSIy3SWC3uGZn8NU48z3bs6QM0XZMG+D7AKRhhuYk/ZOB3WTv8nP2DXQ5GPmnaJxjmmKl3ShtTMzFtB8cwWF5clWsV72jPyMK0LLI4I8li4ig9dVYzVNK4ULgUca+Uci2MQizTotzv2AUg27ap1xs0mo1TgCQYAaQf7PFV55/0wy12DjfY2+7S3R3g9wI01cS1NDBtsihHJSTDot5oyIc7tompFddWVKFaaVHLPdyag6aq6KYp10y1UAzNwERBNVQJWCgnJEojFAzSOMQPCldGWSjPCRHgoiQgi3Pm5+apelUWl5emgCSYwbCbf7H9Ed8e/oODfo8k8YkOM+5/9SX7OwOqjkdrro2t18iqSaG0epqhQS8ljXJsvc184wLtRovF2jyOWZVWNEwNy6pgHSleekGPE0zPJM50cn+C4riE/lAup2FEnGcSpPCWADMaDRkeFrG8srLChaULtM61JCCp0f7oSf7+F3fp6btMsgGRmhCsZXzy90/YXu/Qas+ycmGZ1VuXiJmgzhR8130LNTPpDPYYd2MU36VpLXBhaYF6Ps9Ms4VrV6U3BC2FB0w0qXApWTLBMk3CKJK3VN1F3IvjlDjNMVIIsnC6X3hMgCqlUatzfmkVr2owBXP3/u8kECETMyT5RuG9d+6xv3FIo9XgxnPXuPLiCkqr4HoYjtENHRuH3Z09on6OmdVoaktcbV3HaddoWU2519NtMhGwmoLlVKeKiAuhuABwEpy4VmKIOI61IAiwVesUsP7hQMZUs9Hg4spKAWaz/zB/b+339LId9JrGZG/C7nqfD9/5jMOdlFrL4ObPr3P1xUtMjP4pZcSfccdHwyEbK8yaq1xdvEFFaUxjRK1GtLI5Eh0M42yvnOWdEtQ4LagtRMSTEJFYsjyX9BOJ4eq1a8eeef/Rm4yUfZIkZHA4KMC89TmH3Zh6u8rzv7jK5TvnidwRiX5sMT3RSOKEoANeXueccpGV2jWqbl2+xFBUHMtBKFSp1Iq0mwt6+lNqlUqL39woslWUqNJrpUyCY0BqUtBceHs0LNh08+bPjsF8uPUWg+RALnQOeuyvj/jg7Y/Z3ewxd74pwVx5YwHMBN22sBWbIC8yTr/TJzsw8JhjzlphtrFI05ihYh7XHQFIKGrYdXlGyxJy4lOAxP0ys4nrk4AE7YRBBFWFiHgSUoK5fft2AWZrtJ5/uvVnIsWXxW9j7yHba/0pmMUlj9t3nufW6zcIqn0JpBQBaLTpk0UpXrRE217mWREzti05bpo6fuhjVxwZG5qIHbWIuyyLyTORpaJp4Au6aXqRik+ui//CO56mS1Curcu42u7uYFgW165eP+0ZccBqaqx/85iNB7sSTGdnwMJ8m5u/fJYbrz2DYmZoTtEFCIVHvbGkZTLKcP0VZrx5CaZSrctMJMBI+mgqhlvF0ouaEyaRpJqiqlNA8v2mKe+pauFVAehplBOA9vY7Uo9Ll1cLMN1gO//X5t+IvCK4Nrc2WPvuEffe/JThwZj2TJ3XXv81Ky84RITodYVZZ5EwD5gMfXqTA9TAIu960jPXFm/jGDb1RlsqLGqIqSqoulCy8GqWBWRJBmoRfyJbCc8ZaoJTcYmCFEPTCOOCymJd0isu9gualWDE/ynNvg9md3ubr7/9bgpmaW6BO6++wuqdBnF1iBE7mF5h8TSEvZ19kihF8+syZgSYGbuC5XkyLkRVL8WyT6TmPJgqK6wvxNQz6RUBRHowjOUzShGULGtQ2SmIOnbzuVsoopUZJgd89vhd8kpOpe6w9eQJ9+9/zQd//IS99UMWFud58aVXee5X5wnCkQSU+oWF0iyTVXmyleCqLVr2Ircu3WGufpGqU1BqKkexpmkaaZrCUQIprS/ip4wXCUaxiZOx9KAAVHYJZaoOhS5Repyay77sg7U/kTsB1UaFvf1dHj3Y5N5bf+VgM6BVa/LK66/y2m9fAiMiSkeSYkLyQGXt8bfsb/WoMc+scYnVZ66wWF/AtqvYtofnKogmORXpTFjfOAKpRmR5LCklDZOEUmHb1KaeidNU3g+DhDiNp1msBCLOtc/Nsby0cKLOfHGXbtrBbCrkvs7W1hP+8od3GXZ9HKvNG6+8zMu/eQmjivRet7tPNtHwrT6PHmywvbaHkdVw81munL/J7LkZWu4sjUoFz7EldYSFRdzoZgVdUUGNSKMY0emXgIIolXEjPCRjJoyJspxwcCirv+jThsOBZISp27TaTZaXLlCtVIverDvczz/cfpv13e8Y9ccYzYRJL+Ljex/R2wpwqx7XLt3m+gvPFpb1wD8sOoFAC+h3RnQ2OrK7dvJZLi9fYcadpVlv4NkuDa+OZhXecKutaUbTFGHp0+NB6R2xN4sC6Y0y+EX7Evg+vV4f29OYP7fMysWV6SggwUyCSf5w52vWoy8lID8cMumO2Xi4SXe3Q8VuYnsOrtMki1VUI+Mow6Kax92zrPpKkzlnAdeoUZm1sWMXrZ5h+C664eK6rix8imYgUohQVjXE7HPcPIpu2U9D2a6IBrUcB4aTgWz/BZiFxQUuXrxMu13DtV2pxHSeGfp9euEuj/tfsR8e8ODxv+UY0DvsMd5NCMY+wQRUpShonltYemHxHFdXL9OsLuPNmqQ9BwcbHVUWM1EwkyiStBBghaiagXI0jKlZgn5UU8pEIag0GfukWSS9LZpJMUJIbx0BrDfPSSAnJ85Tk6bIapMgYODvsT/ekNNmOI7IYxVdcdCVYpJUTZvK0RjruTbNapuqW0XnuIksFUuYoMQV4qRo8cMgmLYk0yx3dGEY2rRbPtldi4RwUsQIXbY9J0fnH3wDENlNfGQYDvqMtC7pREyCLlbuYrhFNhIfOCSooxn9ZD/1fQVP/i+5/2N7yrX/9syzPnD86NeZk19jfsrXkZ+ipNjztC815fn/9V3/AY7jxorMKO1sAAAAAElFTkSuQmCC",_n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAjCAYAAACHIWrsAAAAAXNSR0IArs4c6QAABwdJREFUWEe9l1tvG8cVx39LLvdCijdJpCxZt0qx5NitHStNUjct0qSFE6BA2xcXRYF+gr71W/UD9KFF0QINGjtu7Ea5yBdZsqToQokil9wl98a9FDtrSTBsOXIeeh7I3Z2d85v/mXNmZiX+zya9Ki8IBnEYDvD6PYLBgKFiiYyiIcu5M/k600vJoBKQ45rYbYNus0G70cDu96lNzTA+O0+ldu5M0G8FJiCzdYBrGezvNTD2dmgf7LG9+hg/cJmceY2Ft5aYmJpjZGoOVc2/1OdLG49g++srPFy+w8b9J7SaB3iuS2T3iUOXbHGEialprrz7Uy4uvcnQcJ3ScP1Uv6c2HMHWV+7y8O4t2o0DOi0Dq9sj9HykcIBldZBkVaTB+blZ5i4vcuXdD5lZvHQq9FSg1WvFWyvLrN67xaMv7wunsu/gWR1sP8a2upiWiRvJoq3TbjExVuMH79/gvV/+mrmr1yjky8/5fyEwUdfa3eTB3X+xvbZK97BD1D3EMtrCea/fw3UDcZ1AOz0H1/XF/cLiJa7/6jfcuPn7F6o8Fdi4f4vP/v0xuxvb4JromfTVvuMRujZWzxL32WyOzT2DOPAwew491+PDm7/ld3/8E6PjU2dT6Hl2vPnVPf7zz7+gOSam0aVULaPgCYjVT/9zsswgSJXuNTrsNi0ePV79bsDHy7dZ+fhvVAox5wsKUXbo2TWic0imqOEHWfHcHgTsbO3wxcomVz+4wQc3/8Dw2PmzK0yAu/f+ytjIKJPlKrIUnbooBXFGtDl+wCe3P6V25X2WfvHR2ecwCWnz0WfsLN9mslJClQJypEBJzkIm90K47/ts7reQx+b53vUbrw60t1YYJp2jI+AxKQohk4ZTDETRSIDbB4eMXniT+tLPUPLFs4fUXP+C7sqn6KoqFMaOjaLmnoGQQJ+a7w3wJAkXhcLk6wy/8ZMXLnOnloWxelcAE6toWQhdYv9kHhVdIwEO4pCclMXy00gcmn2hsPbWz88OTObQbe1y+N9/gNtFC11kJYGmcjKxLNS6vgMnUWUQ5rC9iOL8tVdX2D/YxFxbxjvYFrWY07Opc+tpUPIx2BLkY4IwxHF9XHmIaqmMMv8GpbkrZ1eYqEhUJvPor32OYXbRgp5QV5TyJxmaj7H6jriPVQUvVChPvUZp/iqF+swL98eX7hau0cB4cAejsU7eMY9BR1ArtikWdAH1JQi0EvWFH1K9+M6p++JL90OhcvNrkgTaX/8aVZLIZ9LtKDElkvEzAXbkkc2PiPqbvfYjtJGJ7w7st7bY3/yGx3//M3ImXVFKUXwSVqBNzMzFRXLTE0xMvfPqwKPzi2ntEh8aWPY37K5/JSDa3kloRcEPVRmqlukVAqoj02SGywwNzVAqTqBrpefm8bmQJmFsdDcwew1Mp0UYupj720xXa/QOmkR9Fy/wkTp9lNEqmYLGVHEBQzfYMpqUK3XqlTEGSomp3MRzao+BiSrLbtForLHjPklDFnSJVRXNllCKBfKDiNizBdjpmnizVaaGJlG0Ep2wx15zj6GCIvoklqdMrTLLeHmO4tCIYImfBJZk5IPOCjvdh9i2A3qAquSQJIVcJkNNrjPw+rihi+/1UTcMASzlR8ipBcywh+V0IBfh+QNCySEb69TUGaZHFpmtXhRrqwAm55eNg2XWdpZxNFuAulaHnJYRnWQFRvOTGG0DL9NPxbsuVTePX81Rz1VpShau1xcgOSMRRDGxIyFrmoBeOLfE+eELSIm6/eYDHuzdo2Fv4ZMWMhkPIhU9n8WxQ2qVc6hSHj2QaPRaDJQBupsnLkvkCypmr43tGsfZ6w0cchkNOcxT0MvMlC/z/en3UuDq+h2+3P6EXtzBjTz0Qswgco87Jx3LhTHGa1Pi2cFuk57bpVwpk9XS17pmE9NuQxjgByGKnE3/KVJQh0VIr81/lAI3Nm9zb/O2ADp+B2Two45wlJN1FFVFj4epT0xQ0its7KyL8FVKdbJauksYRgOrl/ZJ7AgoRSoV/RyLY29zaerHKfDAeMKTg2WM3cdsBts4UVprWTkiDNJi15US9foEw0NjbO2t4zg+tXqVLDlCBhjWLmY37ReF6Vk1sYKeZ7K6yOvj15kZvZxmqW9bcbO7wVrzc540Vuj4DWzPF0lz5CDpqGcq6KU8RsfA7ftoBUW0FzUd023Td2xxHw7SvnqmxPDoBAuVJRbG3xalcVyHScG3zG3adoNGd4tet4lFevA9siTjVEnFcR08L51jVdXQc0U8zyPKpIdhEZFckZI+yrnyNOerCxSTtVbOnQCTl5LwihGGA3qeIRLDG/TxPOt41clmNbH6+GlwhCVOjyyfLYnLcqkmpkGRn/12/Navp6MBiAGFA6IoIIgGFOQCXpQqyiaFKhLlacom3yGnfKD+D6X8t9Fgbp9dAAAAAElFTkSuQmCC",mn={person:{baseSize:[14,17.5],anchor:[16,32],img:_n},vehicle:{baseSize:[25.5,12],anchor:[16,32],img:St}};function gn({mapType:O,config:D,data:A,centerArea:j,showControls:N=!0}){const V=R.useRef(null),[v,g]=R.useState(null),[h,x]=R.useState([]),[f,l]=R.useState([]),[a,d]=R.useState([]),[r,n]=R.useState("vector"),[u,i]=R.useState([]),[e,s]=R.useState(!1);let o=R.useRef(null);const t=({active:C})=>y.jsx("svg",{t:"1749612818289",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"https://www.w3.org/2000/svg","p-id":"7537",width:"24",height:"24",children:y.jsx("path",{d:"M881 290.9h-45.2C818.3 178.7 721.5 92.7 604.3 92.7s-214 86-231.5 198.3H145c-44 0-80 36-80 80v480c0 44 36 80 80 80h736c44 0 80-36 80-80V371c0-44.1-36-80.1-80-80.1z m16 440.6l-122.5-56.1L897 434.1v297.4z m-1.1-365.9L745.4 662l-75.2-34.5c66.1-61.6 150.9-180.6 166.2-272.6H881c6.8 0 12.6 4.6 14.9 10.7zM260.2 866.9l150.7-323.1 82 37.6c43.5 51.3 87.5 87.2 111.4 87.2 9.5 0 23.1-6.7 38.8-18.3l87.8 40.3-89.5 176.3H260.2z m344.1-653.4c64.9 0 117.5 52.6 117.5 117.5s-52.6 117.5-117.5 117.5S486.8 395.9 486.8 331s52.6-117.5 117.5-117.5zM145 354.9h227.1c8.8 53.8 40.8 116.8 79.2 172.3L129 379.4v-8.5c0-8.6 7.3-16 16-16z m-16 496V414.6l252.8 115.9-156.9 336.4H145c-8.7 0-16-7.3-16-16z m752 16H677.3l82.7-163 137 62.8v84.2c0 8.7-7.3 16-16 16z","p-id":"7538"})}),c=({active:C})=>y.jsx("svg",{t:"1749612834660",className:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"7989",width:"24",height:"24",children:y.jsx("path",{d:"M587.6224 809.2672c-1.6384-7.8336-8.5504-12.0832-21.2992-8.704 10.1376-43.2128 15.104-67.3792 36.2496-85.76 30.6688-26.5728 3.6864-56.064-19.6096-52.5824-18.432 2.7136-6.7584-22.784-23.1936-24.2176-16.384-1.3824-37.8368-33.9968-61.44-45.2096-12.4928-5.9392-24.7808-21.8112-44.032-22.528-17.152-0.7168-42.1376 14.3872-42.1376 2.816 0-37.5808-3.7888-64.4096-4.608-75.1104-0.6144-8.6016-5.632-2.9184 17.5616-2.304 12.4928 0.3584 6.4-25.2928 18.8416-26.3168 12.2368-0.9216 41.3696 11.4688 48.8448 6.5536 6.8608-4.608 50.688 114.9952 50.688 19.7632 0-11.264-5.8368-30.9248 0-41.6768 23.1424-42.2912 44.8-76.7488 42.9056-81.8176-1.1264-2.7648-23.7056-5.12-41.7792 0.9216-6.0928 2.048 1.9456 11.52-6.8096 13.6192-32.8192 7.5264-61.7984-8.8576-51.6608-24.32 10.3936-15.8208 48.0768-6.8608 51.3536-38.6048a1679.36 1679.36 0 0 0 4.5056-54.8864c44.1856 6.9632 39.3216-57.2928-26.3168-64.1536a307.3024 307.3024 0 0 1 286.6176 206.336 12.544 12.544 0 0 0-7.3216-3.328c-19.8144-49.5616-68.0448-13.7216-51.712 30.0544-87.552 67.2768-65.1264 114.2272-36.352 141.1072 15.1552 14.1824 29.5936 35.328 38.9632 50.6368-10.24 29.8496 37.6832 17.92 61.2864-32.7168a307.6096 307.6096 0 0 1-219.5456 212.48M204.8 511.6928c0-21.7088 2.2528-42.9056 6.5536-63.2832 13.2608 14.1824 44.544 13.824 52.1216-7.3728 13.6704 8.192 32 9.5744 32 25.856 0 53.6576 1.9456 111.104 50.688 112.0256 1.3312 0 27.136 9.7792 39.424 41.6256 4.2496 11.008 21.0432 0 39.5264 0 9.1648 0 0 15.5136 0 48.9984 0 33.3824 71.936 84.736 71.936 84.736-0.3584 22.1184 0.512 39.9872 2.3552 54.272a120.5248 120.5248 0 0 0-40.6016 5.4784A307.0976 307.0976 0 0 1 204.8 511.6928m614.2976 5.12c-1.024-17.92-3.4304-35.328-6.9632-52.3776 0.3072-6.144 0.3584-11.8272 0.256-17.152 4.4032 20.7872 6.7584 42.2912 6.7584 64.4096l-0.0512 5.12m51.2512-5.12A358.2464 358.2464 0 0 0 512 153.6C314.0608 153.6 153.6 313.856 153.6 511.6928a358.1952 358.1952 0 0 0 313.856 355.328 175.8208 175.8208 0 0 0 48.2816 2.816A358.2976 358.2976 0 0 0 870.4 511.6928","p-id":"7990"})}),[p,_]=R.useState([]);R.useEffect(()=>{if(console.log("useEffect 1：",p),e&&p.length>0&&v){console.log("pendingLabels",p);const C=p.map(k=>S(k));i(k=>[...k,...C]),_([])}},[e,p,v]),R.useEffect(()=>{if(console.log("useEffect 2："),O!=="tianditu"||e)return;console.log("useEffect 2--");const C=()=>{var G;return(G=window.T)!=null&&G.Label?(console.log("useEffect 2 setIsLabelLoaded"),s(!0),!0):!1},k=setInterval(()=>{C()&&clearInterval(k)},200);return console.log("intervalId：",k),()=>clearInterval(k)},[O,e]),R.useEffect(()=>{if(console.log("useEffect 3:"),!D.apiKey)return;const C=new AbortController;let k=!0;return(async()=>{var M,Y;try{if((M=window.T)!=null&&M.Map){console.log("天地图库已预加载，直接初始化"),E();return}if(o.current&&O==="tianditu"&&((Y=window.T)!=null&&Y.Map))return;O==="tianditu"?(await Et(D.apiKey),k&&E()):(await pn(D.apiKey),L())}catch(X){console.error("加载地图失败:",X)}})(),()=>{k=!1,C.abort(),o.current&&(O==="tianditu"&&o.current.destroy?o.current.destroy():O==="google"&&o.current.unbindAll(),o.current=null),h.length&&h.forEach(M=>{M&&typeof M.setMap=="function"&&M.setMap(null)}),f.length&&f.forEach(M=>{M&&typeof M.setMap=="function"&&M.setMap(null)}),a.length&&a.forEach(M=>{M&&typeof M.setMap=="function"&&M.setMap(null)})}},[O,D.apiKey]),R.useEffect(()=>{var C;console.log("useEffect 4:"),D.apiKey&&v&&(console.log("useEffect 4 -- "),console.log("window.T",window.T),console.log("window.T.label",(C=window.T)==null?void 0:C.Label),b(),O==="tianditu"?w():P())},[v,A]);const E=()=>{var M,Y;if(!V.current||!window.T)return;o=new window.T.Map(V.current);let C=(M=A==null?void 0:A.areas[0])==null?void 0:M.centerLng,k=(Y=A==null?void 0:A.areas[0])==null?void 0:Y.centerLat;C||(C=121.587707),k||(k=37.346627);const G=new window.T.LngLat(C,k);o.centerAndZoom(G,D.zoom),g(o)},L=()=>{!V.current||!window.google||(o=new window.google.maps.Map(V.current,{center:{lat:D.center.lat,lng:D.center.lng},zoom:D.zoom}),g(o))},b=()=>{h.forEach(C=>{v.removeOverLay(h),C&&typeof C.setMap=="function"&&C.setMap(null)}),x([]),f.forEach(C=>{v.removeOverLay(C),C&&typeof C.setMap=="function"&&C.setMap(null)}),l([]),a.forEach(C=>{v.removeOverLay(a),C&&typeof C.setMap=="function"&&C.setMap(null)}),d([]),u.forEach(C=>v.removeOverLay(C)),i([])},m=(C,k)=>{const G=mn[C],M=k/6;return new window.T.Icon({iconUrl:G.img,iconSize:new window.T.Point(G.baseSize[0]*M,G.baseSize[1]*M)})},w=()=>{if(!v||!window.T)return;const C=[],k=[],G=[],M=[],Y=[];A!=null&&A.personnel&&(A==null||A.personnel.forEach(X=>{const J=m("person",v.getZoom()),K=new window.T.Marker(new window.T.LngLat(X.location.lng,X.location.lat),{icon:J});v.addOverLay(K),K.addEventListener("click",$=>{var re=$.lnglat;new T.Marker(re);var ee="<div>"+X.name+"</div><div>"+X.deviceTime+"</div><div>"+X.location.lng+","+X.location.lat+"</div>",te=new T.InfoWindow(ee,{offset:new T.Point(0,-30)});v.openInfoWindow(te,re)}),C.push(K)})),A!=null&&A.vehicles&&(A==null||A.vehicles.forEach(X=>{const J=m("vehicle",v.getZoom()),K=new window.T.Marker(new window.T.LngLat(X.location.lng,X.location.lat),{icon:J});v.addOverLay(K),K.addEventListener("click",$=>{var re=$.lnglat;new T.Marker(re);var ee="<div>"+X.name+"</div><div>"+X.deviceTime+"</div><div>"+X.location.lng+","+X.location.lat+"</div>",te=new T.InfoWindow(ee,{offset:new T.Point(0,-30)});v.openInfoWindow(te,re)}),C.push(K)})),A!=null&&A.areas&&(A==null||A.areas.forEach((X,J)=>{const K=X.coordinates.map(te=>new window.T.LngLat(te.lng,te.lat)),$=new window.T.Polygon(K,{color:X.color||"blue",weight:2,opacity:.6,fillColor:X.fillColor||"blue",fillOpacity:.2});v.addOverLay($);let re=X.centerLng,ee=X.centerLat;if(new window.T.LngLat(re,ee),B(X.coordinates),X.name)if(e){const te=S(X);M.push(te)}else Y.push(X);k.push($)})),Y&&_(Y),i(X=>[...X,...M]),x(C),l(k),d(G),console.log("地图数据:",f)},S=C=>{var X;const G=(J=>{const K=(J.match(/[\u4e00-\u9fa5]/g)||[]).length,$=J.length-K;return K*12+$*6+22+18})(C.name),M=new window.T.Label({text:C.name,position:new window.T.LngLat(C.centerLng,C.centerLat),offset:new window.T.Point(-G/2,0)});return M.setFontColor("#fff").setBackgroundColor("rgba(0,0,0,0.5)").setBorderColor("rgba(255,255,255,0)").setBoxShadow("none"),(X=M._container)==null||X.setAttribute("data-label-id",C.name),v.getZoom()>=10&&v.addOverLay(M),M},P=()=>{if(!v||!window.google)return;const C=[],k=[],G=[];A!=null&&A.personnel&&(A==null||A.personnel.forEach(M=>{const Y=new window.google.maps.Marker({position:{lat:M.location.lat,lng:M.location.lng},map:v,icon:{url:"/icons/person-marker.png",scaledSize:new window.google.maps.Size(32,32)},title:M.name});Y.addListener("click",()=>{console.log("人员信息:",M)}),C.push(Y)})),A!=null&&A.vehicles&&(A==null||A.vehicles.forEach(M=>{const Y=new window.google.maps.Marker({position:{lat:M.location.lat,lng:M.location.lng},map:v,icon:{url:"/icons/vehicle-marker.png",scaledSize:new window.google.maps.Size(32,32)},title:M.name});Y.addListener("click",()=>{console.log("车辆信息:",M)}),C.push(Y)})),A!=null&&A.areas&&(A==null||A.areas.forEach(M=>{if(M.type==="polygon"){const Y=M.coordinates.map(J=>({lat:J.lat,lng:J.lng})),X=new window.google.maps.Polygon({paths:Y,strokeColor:M.color||"#0000FF",strokeOpacity:.8,strokeWeight:2,fillColor:M.fillColor||"#0000FF",fillOpacity:.2,map:v});if(M.name){const J=U(M.coordinates);new window.google.maps.Marker({position:{lat:J.lat,lng:J.lng},map:v,label:M.name,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:0}})}k.push(X)}else if(M.type==="circle"){const Y=new window.google.maps.Circle({center:{lat:M.center.lat,lng:M.center.lng},radius:M.radius,strokeColor:M.color||"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:M.fillColor||"#FF0000",fillOpacity:.2,map:v});M.name&&new window.google.maps.Marker({position:{lat:M.center.lat,lng:M.center.lng},map:v,label:M.name,icon:{path:window.google.maps.SymbolPath.CIRCLE,scale:0}}),G.push(Y)}})),x(C),l(k),d(G)},I=C=>{if(v){if(O==="tianditu"){const G=v.getLayers();if(G.length>0){if(C==="vector"){const M=G.find(Y=>Y.FR.includes("t0.tianditu.gov.cn/img_w"));M&&v.removeLayer(M)}else if(!G.find(Y=>Y.FR.includes("t0.tianditu.gov.cn/img_w"))){var k="http://t0.tianditu.gov.cn/img_w/wmts?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER=img&STYLE=default&TILEMATRIXSET=w&FORMAT=tiles&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}&tk="+D.apiKey;v.addLayer(new window.T.TileLayer(k))}}}else v.setMapTypeId(C==="vector"?window.google.maps.MapTypeId.ROADMAP:window.google.maps.MapTypeId.SATELLITE);n(C)}},U=C=>{let k=0,G=0;return C.forEach(M=>{k+=M.lat,G+=M.lng}),{lat:k/C.length,lng:G/C.length}},B=C=>{for(var k=C[0].lng,G=C[0].lng,M=C[0].lat,Y=C[0].lat,X,J=C.length-1;J>=0;J--)X=C[J],X.lng>k&&(k=X.lng),X.lng<G&&(G=X.lng),X.lat>M&&(M=X.lat),X.lat<Y&&(Y=X.lat);for(var K=["50","100","200","500","1000","2000","5000","10000","20000","25000","50000","100000","200000","500000","1000000","2000000"],$=W(M,k,Y,G),J=0,re=K.length;J<re;J++)if(K[J]-$>0)return 18-J+3},W=(C,k,G,M)=>{const X=ee=>ee*Math.PI/180,J=X(G-C),K=X(M-k),$=Math.sin(J/2)**2+Math.cos(X(C))*Math.cos(X(G))*Math.sin(K/2)**2;return 6371*(2*Math.atan2(Math.sqrt($),Math.sqrt(1-$)))*1e3};return R.useEffect(()=>{if(console.log("useEffect 5:"),!v||O!=="tianditu")return;console.log("useEffect 5 --");const C=()=>{console.log("useEffect 5 zoomHandler markers");const k=v.getZoom();h.forEach(G=>{var X;const M=((X=G.getIcon())==null?void 0:X.options.iconUrl)===St,Y=m(M?"vehicle":"person",k);G.setIcon(Y)}),console.log("useEffect 5 zoomHandler labels"),u.forEach(G=>{const M=k>=10;M!==(()=>G._container?G._container.offsetParent!==null:v.getOverlays().includes(G))&&(M?v.getOverlays().includes(G)||v.addOverLay(G):v.getOverlays().includes(G)&&v.removeOverLay(G))})};return v.addEventListener("zoomend",C),()=>{v.removeEventListener("zoomend",C)}},[h,u,v,O]),R.useEffect(()=>{if(console.log("useEffect 6:"),console.log("centerArea Changed",j),v&&j&&window.T){console.log("centerArea Change");let C=j.centerLng,k=j.centerLat;const G=new window.T.LngLat(C,k);let M=B(j.coordinates);v.centerAndZoom(G,M)}},[h,u,j]),y.jsx("div",{ref:V,className:"w-full h-full relative",children:N&&y.jsx("div",{className:"absolute bottom-25 right-4 flex flex-col gap-3 z-[999]",children:y.jsx("div",{className:"bg-white rounded-lg shadow-sm flex flex-col gap-0.5 p-1 border border-gray-100",children:y.jsx("button",{onClick:()=>I(r==="vector"?"satellite":"vector"),className:"px-1 py-1 hover:bg-blue-50 rounded-md transition-colors flex items-center justify-center gap-1",children:r==="vector"?y.jsx(t,{active:!0}):y.jsx(c,{active:!1})})})})})}const bt=()=>$e("/admin-api/app/workbench/mapConfigList"),Ke=O=>$e("/admin-api/app/workbench/gisList",O);function vn({onClose:O,onApply:D,onReset:A,projects:j,locations:N,currentProject:V,currentLocation:v,selectedProject:g,selectedLocation:h}){const[x,f]=R.useState([]),[l,a]=R.useState(g),[d,r]=R.useState(h),[n,u]=R.useState(!1),[i,e]=R.useState(!1),[s,o]=R.useState(""),[t,c]=R.useState(!1),[p,_]=R.useState(null);R.useEffect(()=>{f(N||[]),a(g),r(h)},[]),R.useEffect(()=>{(async()=>{if(l)try{c(!0);const I=(await Ke({projectId:l==null?void 0:l.id})).electronicFenceList;let U=[];I.length>0&&I.forEach(B=>{B.polygonWkt=B.polygonWkt.replace("POLYGON((","").replace("))",""),B.coordinates=B.polygonWkt.split(", ").map(C=>({lat:parseFloat(C.split(" ")[1]),lng:parseFloat(C.split(" ")[0])}));let W={id:"area-"+B.id,name:B.name,type:B.polygonType,coordinates:B.coordinates,centerLng:B.centerLongitude,centerLat:B.centerLatitude,project:{id:localStorage.getItem("projectId"),name:localStorage.getItem("projectName")}};U.push(W)}),f(U),c(!1)}catch(P){console.error("加载位置失败:",P),c(!1)}})()},[l]);const E=j.filter(S=>S.name.toLowerCase().includes(s.toLowerCase())),L=async S=>{a(S),u(!1)},b=S=>{r(S),e(!1)},m=()=>{l?D(l,d):O()},w=()=>{A(),a(null),r(null)};return y.jsx("div",{className:"fixed inset-0 bg-black/50 bg-opacity-50 z-600 flex items-end",style:{zIndex:1e6,backgroundColor:"rgba(0, 0, 0, 0.5)"},children:y.jsxs("div",{className:"bg-white rounded-t-xl w-full min-h-[40vh] max-h-[90vh] overflow-auto",children:[y.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-[#E5E7EB]",children:[y.jsx("h2",{className:"text-lg font-medium text-[#2D3340]",children:"筛选"}),y.jsx("button",{onClick:O,children:y.jsx(dt,{className:"h-5 w-5 text-[#6B7280]"})})]}),y.jsxs("div",{className:"p-4",children:[y.jsxs("div",{className:"mb-6 relative",children:[y.jsxs("div",{className:"border border-[#E5E7EB] rounded-lg p-4 flex justify-between items-center mb-2",onClick:()=>{u(!n),n||e(!1)},children:[y.jsx("span",{className:"text-gray-700",children:(l==null?void 0:l.name)||"请选择项目"}),y.jsxs("div",{className:"flex flex-col",children:[y.jsx(st,{className:"h-4 w-4 text-gray-400"}),y.jsx(Ve,{className:"h-4 w-4 text-gray-400 -mt-1"})]})]}),n&&y.jsxs("div",{className:"absolute z-50 left-0 right-0 mt-1 border border-[#E5E7EB] rounded-lg overflow-hidden bg-white shadow-lg",children:[y.jsxs("div",{className:"p-3 border-b border-[#E5E7EB] flex items-center",children:[y.jsx(xt,{className:"h-5 w-5 text-gray-400 mr-2"}),y.jsx("input",{type:"text",placeholder:"请搜索你想要的内容",className:"w-full outline-none",value:s,onChange:S=>o(S.target.value)})]}),y.jsx("div",{className:"max-h-60 overflow-y-auto",children:E.length>0?E.map(S=>y.jsxs("div",{className:`p-3 flex justify-between items-center ${(l==null?void 0:l.id)===S.id?"bg-gray-100":""}`,onClick:()=>L(S),children:[y.jsx("span",{className:`${S.name.length>20?"line-clamp-2":""}`,children:S.name}),(l==null?void 0:l.id)===S.id&&y.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:y.jsx(We,{className:"h-4 w-4 text-white"})})]},S.id)):y.jsx("div",{className:"p-4 text-center text-gray-500",children:"没有找到相关结果"})})]})]}),y.jsxs("div",{className:"mb-6 relative",children:[y.jsxs("div",{className:"border border-[#E5E7EB] rounded-lg p-4 flex justify-between items-center mb-2",onClick:()=>{e(!i),i||u(!1)},children:[y.jsx("span",{className:"text-gray-700",children:(d==null?void 0:d.name)||"区域位置"}),y.jsxs("div",{className:"flex flex-col",children:[y.jsx(st,{className:"h-4 w-4 text-gray-400"}),y.jsx(Ve,{className:"h-4 w-4 text-gray-400 -mt-1"})]})]}),i&&y.jsx("div",{className:"absolute z-50 left-0 right-0 mt-1 border border-[#E5E7EB] rounded-lg overflow-hidden bg-white shadow-lg",children:y.jsx("div",{className:"max-h-60 overflow-y-auto",children:t?y.jsx("div",{className:"p-4 text-center text-gray-500",children:"加载中..."}):x.length>0?x.map(S=>y.jsxs("div",{className:`p-3 flex justify-between items-center ${(d==null?void 0:d.id)===S.id?"bg-gray-100":""}`,onClick:()=>b(S),children:[y.jsx("span",{children:S.name}),(d==null?void 0:d.id)===S.id&&y.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:y.jsx(We,{className:"h-4 w-4 text-white"})})]},S.id)):y.jsx("div",{className:"p-4 text-center text-gray-500",children:"没有可用的位置"})})})]}),y.jsxs("div",{className:"flex space-x-3",children:[y.jsx("button",{className:"flex-1 mr-4 p-4 border border-[#E5E7EB] rounded-lg text-center",onClick:w,children:"重置"}),y.jsx("button",{className:"flex-1 p-4 bg-[#001529] text-white rounded-lg text-center",onClick:m,children:"确定"})]})]})]})})}function xn(){const[O,D]=R.useState({coordinates:null,country:null,error:null});return R.useEffect(()=>{if(!navigator.geolocation){D(A=>({...A,error:"浏览器不支持地理定位"}));return}navigator.geolocation.getCurrentPosition(A=>{const{latitude:j,longitude:N}=A.coords;D({coordinates:{lat:j,lng:N},country:"国外",error:null})},A=>{switch(A.code){case A.PERMISSION_DENIED:break;case A.POSITION_UNAVAILABLE:break;case A.TIMEOUT:break}D(j=>({...j,error:JSON.stringify(A)}))},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0})},[]),O}function yn(){const[O,D]=R.useState([]),[A,j]=R.useState([]),N=R.useRef(!1),[V,v]=R.useState(!1),[g,h]=R.useState(null),[x,f]=R.useState(null),[l,a]=R.useState(null),[d,r]=R.useState(null),[n,u]=R.useState(null),[i,e]=R.useState(null),[s,o]=R.useState(!0),[t,c]=R.useState(null),{coordinates:p,country:_,error:E}=xn();R.useEffect(()=>{},[]),R.useEffect(()=>{N.current||(N.current=!0,b())},[p,_]);const L={personnel:[],vehicles:[],areas:[]},b=async()=>{try{o(!0),wr().then(async C=>{const k=C.map(G=>({id:G.id,name:G.projectName}));D(k)});let S=await bt();S.reverse();for(let C=0;C<S.length;C++)if(S[C].mapType==="1"){let k={apiKey:S[C].mapApiKey,center:{lat:S[C].defaultCenterLatitude,lng:S[C].defaultCenterLongitude},zoom:10};u(k);break}let P={id:localStorage.getItem("projectId"),name:localStorage.getItem("projectName")};h(P),a(P);let I=localStorage.getItem("projectId");const U=await Ke({projectId:I});U.vehicleInfoList.forEach(C=>{let k={id:"vehicle-"+C.id,name:C.deviceDisplayName,type:C.vehicleType,location:{lat:C.lat,lng:C.lng},deviceTime:C.deviceTime};L.vehicles.push(k)}),U.personnelInfoList.forEach(C=>{L.personnel.push({id:"person-"+C.id,name:C.deviceDisplayName,location:{lat:C.lat,lng:C.lng},deviceTime:C.deviceTime})});const B=U.electronicFenceList;let W=[];if(B.length>0){B.forEach(k=>{k.polygonWkt=k.polygonWkt.replace("POLYGON((","").replace("))",""),k.coordinates=k.polygonWkt.split(", ").map(M=>({lat:parseFloat(M.split(" ")[1]),lng:parseFloat(M.split(" ")[0])}));let G={id:"area-"+k.id,name:k.name,type:k.polygonType,coordinates:k.coordinates,centerLng:k.centerLongitude,centerLat:k.centerLatitude,project:{id:localStorage.getItem("projectId"),name:localStorage.getItem("projectName")}};W.push(G)}),j(W);let C=W[0];L.areas=W}e(L),o(!1)}catch(S){S.code=="ECONNABORTED"?c("初始化失败: 网络连接失败，请检查网络或稍后重试"):c(`初始化失败: ${S instanceof Error?S.message:String(S)}`),o(!1)}},m=async(S,P)=>{try{if(o(!0),a(S),r(P),(S==null?void 0:S.id)!=g.id){h(S);const I=await Ke({projectId:S==null?void 0:S.id});L.vehicles=[],I.vehicleInfoList.forEach(W=>{let C={id:"vehicle-"+W.id,name:W.deviceDisplayName,type:W.vehicleType,location:{lat:W.lat,lng:W.lng},deviceTime:W.deviceTime};L.vehicles.push(C)}),L.personnel=[],I.personnelInfoList.forEach(W=>{L.personnel.push({id:"person-"+W.id,name:W.deviceDisplayName,location:{lat:W.lat,lng:W.lng},deviceTime:W.deviceTime})});const U=I.electronicFenceList;let B=[];U.length>0&&U.forEach(W=>{W.polygonWkt=W.polygonWkt.replace("POLYGON((","").replace("))",""),W.coordinates=W.polygonWkt.split(", ").map(k=>({lat:parseFloat(k.split(" ")[1]),lng:parseFloat(k.split(" ")[0])}));let C={id:"area-"+W.id,name:W.name,type:W.polygonType,coordinates:W.coordinates,centerLng:W.centerLongitude,centerLat:W.centerLatitude,project:{id:localStorage.getItem("projectId"),name:localStorage.getItem("projectName")}};B.push(C)}),j(B),L.areas=B,console.log("data",L),e(L),P&&(console.log("location1",P),f(P))}else P&&(console.log("location2",P),f(P));o(!1),v(!1)}catch(I){I.code=="ECONNABORTED"?c("筛选失败: 网络连接失败，请检查网络或稍后重试"):c(`筛选失败: ${I instanceof Error?I.message:String(I)}`),o(!1)}},w=()=>{a(null),r(null)};return y.jsxs("div",{className:"flex flex-col h-screen bg-gray-100 relative",children:[y.jsxs("div",{className:"fixed top-18 right-4 z-[1000]",children:[y.jsx("div",{className:"text-lg font-medium"}),y.jsx("button",{className:"w-10 h-10 bg-white backdrop-blur-sm rounded-lg flex items-center justify-center shadow-lg hover:shadow-xl transition-shadow",onClick:()=>v(!0),children:y.jsx(gt,{className:"h-5 w-5 text-gray-600 hover:text-blue-600 transition-colors"})})]}),y.jsx("div",{className:"flex-1 relative ",children:s?y.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:y.jsxs("div",{className:"text-center",children:[y.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),y.jsx("p",{className:"text-gray-600",children:"加载地图中..."})]})}):t?y.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:y.jsxs("div",{className:"text-center text-red-500 p-4",children:[y.jsx("p",{children:t}),y.jsx("button",{className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg",onClick:b,children:"重试"})]})}):y.jsx(gn,{mapType:"tianditu",config:n,data:i,centerArea:x,showControls:!V})}),V&&y.jsx(vn,{onClose:()=>v(!1),onApply:m,onReset:w,projects:O,locations:A,currentProject:g,currentLocation:x,selectedProject:l,selectedLocation:null})]})}const En=()=>y.jsx(yn,{});function wt({...O}){return y.jsxs("div",{className:"relative flex-grow",children:[y.jsx(xt,{className:"absolute left-2.5 top-3 h-4 w-4 text-muted-foreground"}),y.jsx(Tr,{placeholder:"请输入搜索的内容",className:"pl-8 h-full shadow-sm focus:ring-1 focus-visible:ring-1 bg-white text-sm",...O})]})}function ot(O,[D,A]){return Math.min(A,Math.max(D,O))}var Sn="Arrow",Lt=R.forwardRef((O,D)=>{const{children:A,width:j=10,height:N=5,...V}=O;return y.jsx(ue.svg,{...V,ref:D,width:j,height:N,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:O.asChild?A:y.jsx("polygon",{points:"0,0 30,0 15,10"})})});Lt.displayName=Sn;var bn=Lt,tt="Popper",[At,Rt]=ft(tt),[wn,Ct]=At(tt),Tt=O=>{const{__scopePopper:D,children:A}=O,[j,N]=R.useState(null);return y.jsx(wn,{scope:D,anchor:j,onAnchorChange:N,children:A})};Tt.displayName=tt;var Ot="PopperAnchor",It=R.forwardRef((O,D)=>{const{__scopePopper:A,virtualRef:j,...N}=O,V=Ct(Ot,A),v=R.useRef(null),g=pe(D,v);return R.useEffect(()=>{V.onAnchorChange((j==null?void 0:j.current)||v.current)}),j?null:y.jsx(ue.div,{...N,ref:g})});It.displayName=Ot;var rt="PopperContent",[Ln,An]=At(rt),Mt=R.forwardRef((O,D)=>{var K,$,re,ee,te,q;const{__scopePopper:A,side:j="bottom",sideOffset:N=0,align:V="center",alignOffset:v=0,arrowPadding:g=0,avoidCollisions:h=!0,collisionBoundary:x=[],collisionPadding:f=0,sticky:l="partial",hideWhenDetached:a=!1,updatePositionStrategy:d="optimized",onPlaced:r,...n}=O,u=Ct(rt,A),[i,e]=R.useState(null),s=pe(D,Z=>e(Z)),[o,t]=R.useState(null),c=en(o),p=(c==null?void 0:c.width)??0,_=(c==null?void 0:c.height)??0,E=j+(V!=="center"?"-"+V:""),L=typeof f=="number"?f:{top:0,right:0,bottom:0,left:0,...f},b=Array.isArray(x)?x:[x],m=b.length>0,w={padding:L,boundary:b.filter(Cn),altBoundary:m},{refs:S,floatingStyles:P,placement:I,isPositioned:U,middlewareData:B}=zr({strategy:"fixed",placement:E,whileElementsMounted:(...Z)=>$r(...Z,{animationFrame:d==="always"}),elements:{reference:u.anchor},middleware:[Hr({mainAxis:N+_,alignmentAxis:v}),h&&Yr({mainAxis:!0,crossAxis:!1,limiter:l==="partial"?qr():void 0,...w}),h&&Xr({...w}),Zr({...w,apply:({elements:Z,rects:se,availableWidth:le,availableHeight:fe})=>{const{width:ce,height:ge}=se.reference,_e=Z.floating.style;_e.setProperty("--radix-popper-available-width",`${le}px`),_e.setProperty("--radix-popper-available-height",`${fe}px`),_e.setProperty("--radix-popper-anchor-width",`${ce}px`),_e.setProperty("--radix-popper-anchor-height",`${ge}px`)}}),o&&Jr({element:o,padding:g}),Tn({arrowWidth:p,arrowHeight:_}),a&&Qr({strategy:"referenceHidden",...w})]}),[W,C]=jt(I),k=ht(r);xe(()=>{U&&(k==null||k())},[U,k]);const G=(K=B.arrow)==null?void 0:K.x,M=($=B.arrow)==null?void 0:$.y,Y=((re=B.arrow)==null?void 0:re.centerOffset)!==0,[X,J]=R.useState();return xe(()=>{i&&J(window.getComputedStyle(i).zIndex)},[i]),y.jsx("div",{ref:S.setFloating,"data-radix-popper-content-wrapper":"",style:{...P,transform:U?P.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:X,"--radix-popper-transform-origin":[(ee=B.transformOrigin)==null?void 0:ee.x,(te=B.transformOrigin)==null?void 0:te.y].join(" "),...((q=B.hide)==null?void 0:q.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:O.dir,children:y.jsx(Ln,{scope:A,placedSide:W,onArrowChange:t,arrowX:G,arrowY:M,shouldHideArrow:Y,children:y.jsx(ue.div,{"data-side":W,"data-align":C,...n,ref:s,style:{...n.style,animation:U?void 0:"none"}})})})});Mt.displayName=rt;var Pt="PopperArrow",Rn={top:"bottom",right:"left",bottom:"top",left:"right"},Dt=R.forwardRef(function(D,A){const{__scopePopper:j,...N}=D,V=An(Pt,j),v=Rn[V.placedSide];return y.jsx("span",{ref:V.onArrowChange,style:{position:"absolute",left:V.arrowX,top:V.arrowY,[v]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[V.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[V.placedSide],visibility:V.shouldHideArrow?"hidden":void 0},children:y.jsx(bn,{...N,ref:A,style:{...N.style,display:"block"}})})});Dt.displayName=Pt;function Cn(O){return O!==null}var Tn=O=>({name:"transformOrigin",options:O,fn(D){var u,i,e;const{placement:A,rects:j,middlewareData:N}=D,v=((u=N.arrow)==null?void 0:u.centerOffset)!==0,g=v?0:O.arrowWidth,h=v?0:O.arrowHeight,[x,f]=jt(A),l={start:"0%",center:"50%",end:"100%"}[f],a=(((i=N.arrow)==null?void 0:i.x)??0)+g/2,d=(((e=N.arrow)==null?void 0:e.y)??0)+h/2;let r="",n="";return x==="bottom"?(r=v?l:`${a}px`,n=`${-h}px`):x==="top"?(r=v?l:`${a}px`,n=`${j.floating.height+h}px`):x==="right"?(r=`${-h}px`,n=v?l:`${d}px`):x==="left"&&(r=`${j.floating.width+h}px`,n=v?l:`${d}px`),{data:{x:r,y:n}}}});function jt(O){const[D,A="center"]=O.split("-");return[D,A]}var On=Tt,In=It,Mn=Mt,Pn=Dt,Dn=[" ","Enter","ArrowUp","ArrowDown"],jn=[" ","Enter"],be="Select",[je,Fe,Fn]=gr(be),[Re,Yi]=ft(be,[Fn,Rt]),Ne=Rt(),[Nn,Ee]=Re(be),[Bn,kn]=Re(be),Ft=O=>{const{__scopeSelect:D,children:A,open:j,defaultOpen:N,onOpenChange:V,value:v,defaultValue:g,onValueChange:h,dir:x,name:f,autoComplete:l,disabled:a,required:d,form:r}=O,n=Ne(D),[u,i]=R.useState(null),[e,s]=R.useState(null),[o,t]=R.useState(!1),c=Or(x),[p,_]=it({prop:j,defaultProp:N??!1,onChange:V,caller:be}),[E,L]=it({prop:v,defaultProp:g,onChange:h,caller:be}),b=R.useRef(null),m=u?r||!!u.closest("form"):!0,[w,S]=R.useState(new Set),P=Array.from(w).map(I=>I.props.value).join(";");return y.jsx(On,{...n,children:y.jsxs(Nn,{required:d,scope:D,trigger:u,onTriggerChange:i,valueNode:e,onValueNodeChange:s,valueNodeHasChildren:o,onValueNodeHasChildrenChange:t,contentId:et(),value:E,onValueChange:L,open:p,onOpenChange:_,dir:c,triggerPointerDownPosRef:b,disabled:a,children:[y.jsx(je.Provider,{scope:D,children:y.jsx(Bn,{scope:O.__scopeSelect,onNativeOptionAdd:R.useCallback(I=>{S(U=>new Set(U).add(I))},[]),onNativeOptionRemove:R.useCallback(I=>{S(U=>{const B=new Set(U);return B.delete(I),B})},[]),children:A})}),m?y.jsxs(ir,{"aria-hidden":!0,required:d,tabIndex:-1,name:f,autoComplete:l,value:E,onChange:I=>L(I.target.value),disabled:a,form:r,children:[E===void 0?y.jsx("option",{value:""}):null,Array.from(w)]},P):null]})})};Ft.displayName=be;var Nt="SelectTrigger",Bt=R.forwardRef((O,D)=>{const{__scopeSelect:A,disabled:j=!1,...N}=O,V=Ne(A),v=Ee(Nt,A),g=v.disabled||j,h=pe(D,v.onTriggerChange),x=Fe(A),f=R.useRef("touch"),[l,a,d]=or(n=>{const u=x().filter(s=>!s.disabled),i=u.find(s=>s.value===v.value),e=ar(u,n,i);e!==void 0&&v.onValueChange(e.value)}),r=n=>{g||(v.onOpenChange(!0),d()),n&&(v.triggerPointerDownPosRef.current={x:Math.round(n.pageX),y:Math.round(n.pageY)})};return y.jsx(In,{asChild:!0,...V,children:y.jsx(ue.button,{type:"button",role:"combobox","aria-controls":v.contentId,"aria-expanded":v.open,"aria-required":v.required,"aria-autocomplete":"none",dir:v.dir,"data-state":v.open?"open":"closed",disabled:g,"data-disabled":g?"":void 0,"data-placeholder":sr(v.value)?"":void 0,...N,ref:h,onClick:ae(N.onClick,n=>{n.currentTarget.focus(),f.current!=="mouse"&&r(n)}),onPointerDown:ae(N.onPointerDown,n=>{f.current=n.pointerType;const u=n.target;u.hasPointerCapture(n.pointerId)&&u.releasePointerCapture(n.pointerId),n.button===0&&n.ctrlKey===!1&&n.pointerType==="mouse"&&(r(n),n.preventDefault())}),onKeyDown:ae(N.onKeyDown,n=>{const u=l.current!=="";!(n.ctrlKey||n.altKey||n.metaKey)&&n.key.length===1&&a(n.key),!(u&&n.key===" ")&&Dn.includes(n.key)&&(r(),n.preventDefault())})})})});Bt.displayName=Nt;var kt="SelectValue",Ut=R.forwardRef((O,D)=>{const{__scopeSelect:A,className:j,style:N,children:V,placeholder:v="",...g}=O,h=Ee(kt,A),{onValueNodeHasChildrenChange:x}=h,f=V!==void 0,l=pe(D,h.onValueNodeChange);return xe(()=>{x(f)},[x,f]),y.jsx(ue.span,{...g,ref:l,style:{pointerEvents:"none"},children:sr(h.value)?y.jsx(y.Fragment,{children:v}):V})});Ut.displayName=kt;var Un="SelectIcon",Vt=R.forwardRef((O,D)=>{const{__scopeSelect:A,children:j,...N}=O;return y.jsx(ue.span,{"aria-hidden":!0,...N,ref:D,children:j||"▼"})});Vt.displayName=Un;var Vn="SelectPortal",Wt=O=>y.jsx(xr,{asChild:!0,...O});Wt.displayName=Vn;var we="SelectContent",Kt=R.forwardRef((O,D)=>{const A=Ee(we,O.__scopeSelect),[j,N]=R.useState();if(xe(()=>{N(new DocumentFragment)},[]),!A.open){const V=j;return V?pt.createPortal(y.jsx(Gt,{scope:O.__scopeSelect,children:y.jsx(je.Slot,{scope:O.__scopeSelect,children:y.jsx("div",{children:O.children})})}),V):null}return y.jsx(zt,{...O,ref:D})});Kt.displayName=we;var me=10,[Gt,Se]=Re(we),Wn="SelectContentImpl",Kn=yr("SelectContent.RemoveScroll"),zt=R.forwardRef((O,D)=>{const{__scopeSelect:A,position:j="item-aligned",onCloseAutoFocus:N,onEscapeKeyDown:V,onPointerDownOutside:v,side:g,sideOffset:h,align:x,alignOffset:f,arrowPadding:l,collisionBoundary:a,collisionPadding:d,sticky:r,hideWhenDetached:n,avoidCollisions:u,...i}=O,e=Ee(we,A),[s,o]=R.useState(null),[t,c]=R.useState(null),p=pe(D,K=>o(K)),[_,E]=R.useState(null),[L,b]=R.useState(null),m=Fe(A),[w,S]=R.useState(!1),P=R.useRef(!1);R.useEffect(()=>{if(s)return Wr(s)},[s]),Kr();const I=R.useCallback(K=>{const[$,...re]=m().map(q=>q.ref.current),[ee]=re.slice(-1),te=document.activeElement;for(const q of K)if(q===te||(q==null||q.scrollIntoView({block:"nearest"}),q===$&&t&&(t.scrollTop=0),q===ee&&t&&(t.scrollTop=t.scrollHeight),q==null||q.focus(),document.activeElement!==te))return},[m,t]),U=R.useCallback(()=>I([_,s]),[I,_,s]);R.useEffect(()=>{w&&U()},[w,U]);const{onOpenChange:B,triggerPointerDownPosRef:W}=e;R.useEffect(()=>{if(s){let K={x:0,y:0};const $=ee=>{var te,q;K={x:Math.abs(Math.round(ee.pageX)-(((te=W.current)==null?void 0:te.x)??0)),y:Math.abs(Math.round(ee.pageY)-(((q=W.current)==null?void 0:q.y)??0))}},re=ee=>{K.x<=10&&K.y<=10?ee.preventDefault():s.contains(ee.target)||B(!1),document.removeEventListener("pointermove",$),W.current=null};return W.current!==null&&(document.addEventListener("pointermove",$),document.addEventListener("pointerup",re,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",$),document.removeEventListener("pointerup",re,{capture:!0})}}},[s,B,W]),R.useEffect(()=>{const K=()=>B(!1);return window.addEventListener("blur",K),window.addEventListener("resize",K),()=>{window.removeEventListener("blur",K),window.removeEventListener("resize",K)}},[B]);const[C,k]=or(K=>{const $=m().filter(te=>!te.disabled),re=$.find(te=>te.ref.current===document.activeElement),ee=ar($,K,re);ee&&setTimeout(()=>ee.ref.current.focus())}),G=R.useCallback((K,$,re)=>{const ee=!P.current&&!re;(e.value!==void 0&&e.value===$||ee)&&(E(K),ee&&(P.current=!0))},[e.value]),M=R.useCallback(()=>s==null?void 0:s.focus(),[s]),Y=R.useCallback((K,$,re)=>{const ee=!P.current&&!re;(e.value!==void 0&&e.value===$||ee)&&b(K)},[e.value]),X=j==="popper"?Ge:Ht,J=X===Ge?{side:g,sideOffset:h,align:x,alignOffset:f,arrowPadding:l,collisionBoundary:a,collisionPadding:d,sticky:r,hideWhenDetached:n,avoidCollisions:u}:{};return y.jsx(Gt,{scope:A,content:s,viewport:t,onViewportChange:c,itemRefCallback:G,selectedItem:_,onItemLeave:M,itemTextRefCallback:Y,focusSelectedItem:U,selectedItemText:L,position:j,isPositioned:w,searchRef:C,children:y.jsx(Gr,{as:Kn,allowPinchZoom:!0,children:y.jsx(Cr,{asChild:!0,trapped:e.open,onMountAutoFocus:K=>{K.preventDefault()},onUnmountAutoFocus:ae(N,K=>{var $;($=e.trigger)==null||$.focus({preventScroll:!0}),K.preventDefault()}),children:y.jsx(Er,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:V,onPointerDownOutside:v,onFocusOutside:K=>K.preventDefault(),onDismiss:()=>e.onOpenChange(!1),children:y.jsx(X,{role:"listbox",id:e.contentId,"data-state":e.open?"open":"closed",dir:e.dir,onContextMenu:K=>K.preventDefault(),...i,...J,onPlaced:()=>S(!0),ref:p,style:{display:"flex",flexDirection:"column",outline:"none",...i.style},onKeyDown:ae(i.onKeyDown,K=>{const $=K.ctrlKey||K.altKey||K.metaKey;if(K.key==="Tab"&&K.preventDefault(),!$&&K.key.length===1&&k(K.key),["ArrowUp","ArrowDown","Home","End"].includes(K.key)){let ee=m().filter(te=>!te.disabled).map(te=>te.ref.current);if(["ArrowUp","End"].includes(K.key)&&(ee=ee.slice().reverse()),["ArrowUp","ArrowDown"].includes(K.key)){const te=K.target,q=ee.indexOf(te);ee=ee.slice(q+1)}setTimeout(()=>I(ee)),K.preventDefault()}})})})})})})});zt.displayName=Wn;var Gn="SelectItemAlignedPosition",Ht=R.forwardRef((O,D)=>{const{__scopeSelect:A,onPlaced:j,...N}=O,V=Ee(we,A),v=Se(we,A),[g,h]=R.useState(null),[x,f]=R.useState(null),l=pe(D,p=>f(p)),a=Fe(A),d=R.useRef(!1),r=R.useRef(!0),{viewport:n,selectedItem:u,selectedItemText:i,focusSelectedItem:e}=v,s=R.useCallback(()=>{if(V.trigger&&V.valueNode&&g&&x&&n&&u&&i){const p=V.trigger.getBoundingClientRect(),_=x.getBoundingClientRect(),E=V.valueNode.getBoundingClientRect(),L=i.getBoundingClientRect();if(V.dir!=="rtl"){const te=L.left-_.left,q=E.left-te,Z=p.left-q,se=p.width+Z,le=Math.max(se,_.width),fe=window.innerWidth-me,ce=ot(q,[me,Math.max(me,fe-le)]);g.style.minWidth=se+"px",g.style.left=ce+"px"}else{const te=_.right-L.right,q=window.innerWidth-E.right-te,Z=window.innerWidth-p.right-q,se=p.width+Z,le=Math.max(se,_.width),fe=window.innerWidth-me,ce=ot(q,[me,Math.max(me,fe-le)]);g.style.minWidth=se+"px",g.style.right=ce+"px"}const b=a(),m=window.innerHeight-me*2,w=n.scrollHeight,S=window.getComputedStyle(x),P=parseInt(S.borderTopWidth,10),I=parseInt(S.paddingTop,10),U=parseInt(S.borderBottomWidth,10),B=parseInt(S.paddingBottom,10),W=P+I+w+B+U,C=Math.min(u.offsetHeight*5,W),k=window.getComputedStyle(n),G=parseInt(k.paddingTop,10),M=parseInt(k.paddingBottom,10),Y=p.top+p.height/2-me,X=m-Y,J=u.offsetHeight/2,K=u.offsetTop+J,$=P+I+K,re=W-$;if($<=Y){const te=b.length>0&&u===b[b.length-1].ref.current;g.style.bottom="0px";const q=x.clientHeight-n.offsetTop-n.offsetHeight,Z=Math.max(X,J+(te?M:0)+q+U),se=$+Z;g.style.height=se+"px"}else{const te=b.length>0&&u===b[0].ref.current;g.style.top="0px";const Z=Math.max(Y,P+n.offsetTop+(te?G:0)+J)+re;g.style.height=Z+"px",n.scrollTop=$-Y+n.offsetTop}g.style.margin=`${me}px 0`,g.style.minHeight=C+"px",g.style.maxHeight=m+"px",j==null||j(),requestAnimationFrame(()=>d.current=!0)}},[a,V.trigger,V.valueNode,g,x,n,u,i,V.dir,j]);xe(()=>s(),[s]);const[o,t]=R.useState();xe(()=>{x&&t(window.getComputedStyle(x).zIndex)},[x]);const c=R.useCallback(p=>{p&&r.current===!0&&(s(),e==null||e(),r.current=!1)},[s,e]);return y.jsx(Hn,{scope:A,contentWrapper:g,shouldExpandOnScrollRef:d,onScrollButtonChange:c,children:y.jsx("div",{ref:h,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:o},children:y.jsx(ue.div,{...N,ref:l,style:{boxSizing:"border-box",maxHeight:"100%",...N.style}})})})});Ht.displayName=Gn;var zn="SelectPopperPosition",Ge=R.forwardRef((O,D)=>{const{__scopeSelect:A,align:j="start",collisionPadding:N=me,...V}=O,v=Ne(A);return y.jsx(Mn,{...v,...V,ref:D,align:j,collisionPadding:N,style:{boxSizing:"border-box",...V.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Ge.displayName=zn;var[Hn,nt]=Re(we,{}),ze="SelectViewport",Yt=R.forwardRef((O,D)=>{const{__scopeSelect:A,nonce:j,...N}=O,V=Se(ze,A),v=nt(ze,A),g=pe(D,V.onViewportChange),h=R.useRef(0);return y.jsxs(y.Fragment,{children:[y.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:j}),y.jsx(je.Slot,{scope:A,children:y.jsx(ue.div,{"data-radix-select-viewport":"",role:"presentation",...N,ref:g,style:{position:"relative",flex:1,overflow:"hidden auto",...N.style},onScroll:ae(N.onScroll,x=>{const f=x.currentTarget,{contentWrapper:l,shouldExpandOnScrollRef:a}=v;if(a!=null&&a.current&&l){const d=Math.abs(h.current-f.scrollTop);if(d>0){const r=window.innerHeight-me*2,n=parseFloat(l.style.minHeight),u=parseFloat(l.style.height),i=Math.max(n,u);if(i<r){const e=i+d,s=Math.min(r,e),o=e-s;l.style.height=s+"px",l.style.bottom==="0px"&&(f.scrollTop=o>0?o:0,l.style.justifyContent="flex-end")}}}h.current=f.scrollTop})})})]})});Yt.displayName=ze;var Xt="SelectGroup",[Yn,Xn]=Re(Xt),Zn=R.forwardRef((O,D)=>{const{__scopeSelect:A,...j}=O,N=et();return y.jsx(Yn,{scope:A,id:N,children:y.jsx(ue.div,{role:"group","aria-labelledby":N,...j,ref:D})})});Zn.displayName=Xt;var Zt="SelectLabel",Jt=R.forwardRef((O,D)=>{const{__scopeSelect:A,...j}=O,N=Xn(Zt,A);return y.jsx(ue.div,{id:N.id,...j,ref:D})});Jt.displayName=Zt;var De="SelectItem",[Jn,Qt]=Re(De),qt=R.forwardRef((O,D)=>{const{__scopeSelect:A,value:j,disabled:N=!1,textValue:V,...v}=O,g=Ee(De,A),h=Se(De,A),x=g.value===j,[f,l]=R.useState(V??""),[a,d]=R.useState(!1),r=pe(D,e=>{var s;return(s=h.itemRefCallback)==null?void 0:s.call(h,e,j,N)}),n=et(),u=R.useRef("touch"),i=()=>{N||(g.onValueChange(j),g.onOpenChange(!1))};if(j==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return y.jsx(Jn,{scope:A,value:j,disabled:N,textId:n,isSelected:x,onItemTextChange:R.useCallback(e=>{l(s=>s||((e==null?void 0:e.textContent)??"").trim())},[]),children:y.jsx(je.ItemSlot,{scope:A,value:j,disabled:N,textValue:f,children:y.jsx(ue.div,{role:"option","aria-labelledby":n,"data-highlighted":a?"":void 0,"aria-selected":x&&a,"data-state":x?"checked":"unchecked","aria-disabled":N||void 0,"data-disabled":N?"":void 0,tabIndex:N?void 0:-1,...v,ref:r,onFocus:ae(v.onFocus,()=>d(!0)),onBlur:ae(v.onBlur,()=>d(!1)),onClick:ae(v.onClick,()=>{u.current!=="mouse"&&i()}),onPointerUp:ae(v.onPointerUp,()=>{u.current==="mouse"&&i()}),onPointerDown:ae(v.onPointerDown,e=>{u.current=e.pointerType}),onPointerMove:ae(v.onPointerMove,e=>{var s;u.current=e.pointerType,N?(s=h.onItemLeave)==null||s.call(h):u.current==="mouse"&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:ae(v.onPointerLeave,e=>{var s;e.currentTarget===document.activeElement&&((s=h.onItemLeave)==null||s.call(h))}),onKeyDown:ae(v.onKeyDown,e=>{var o;((o=h.searchRef)==null?void 0:o.current)!==""&&e.key===" "||(jn.includes(e.key)&&i(),e.key===" "&&e.preventDefault())})})})})});qt.displayName=De;var Te="SelectItemText",$t=R.forwardRef((O,D)=>{const{__scopeSelect:A,className:j,style:N,...V}=O,v=Ee(Te,A),g=Se(Te,A),h=Qt(Te,A),x=kn(Te,A),[f,l]=R.useState(null),a=pe(D,i=>l(i),h.onItemTextChange,i=>{var e;return(e=g.itemTextRefCallback)==null?void 0:e.call(g,i,h.value,h.disabled)}),d=f==null?void 0:f.textContent,r=R.useMemo(()=>y.jsx("option",{value:h.value,disabled:h.disabled,children:d},h.value),[h.disabled,h.value,d]),{onNativeOptionAdd:n,onNativeOptionRemove:u}=x;return xe(()=>(n(r),()=>u(r)),[n,u,r]),y.jsxs(y.Fragment,{children:[y.jsx(ue.span,{id:h.textId,...V,ref:a}),h.isSelected&&v.valueNode&&!v.valueNodeHasChildren?pt.createPortal(V.children,v.valueNode):null]})});$t.displayName=Te;var er="SelectItemIndicator",tr=R.forwardRef((O,D)=>{const{__scopeSelect:A,...j}=O;return Qt(er,A).isSelected?y.jsx(ue.span,{"aria-hidden":!0,...j,ref:D}):null});tr.displayName=er;var He="SelectScrollUpButton",Qn=R.forwardRef((O,D)=>{const A=Se(He,O.__scopeSelect),j=nt(He,O.__scopeSelect),[N,V]=R.useState(!1),v=pe(D,j.onScrollButtonChange);return xe(()=>{if(A.viewport&&A.isPositioned){let g=function(){const x=h.scrollTop>0;V(x)};const h=A.viewport;return g(),h.addEventListener("scroll",g),()=>h.removeEventListener("scroll",g)}},[A.viewport,A.isPositioned]),N?y.jsx(rr,{...O,ref:v,onAutoScroll:()=>{const{viewport:g,selectedItem:h}=A;g&&h&&(g.scrollTop=g.scrollTop-h.offsetHeight)}}):null});Qn.displayName=He;var Ye="SelectScrollDownButton",qn=R.forwardRef((O,D)=>{const A=Se(Ye,O.__scopeSelect),j=nt(Ye,O.__scopeSelect),[N,V]=R.useState(!1),v=pe(D,j.onScrollButtonChange);return xe(()=>{if(A.viewport&&A.isPositioned){let g=function(){const x=h.scrollHeight-h.clientHeight,f=Math.ceil(h.scrollTop)<x;V(f)};const h=A.viewport;return g(),h.addEventListener("scroll",g),()=>h.removeEventListener("scroll",g)}},[A.viewport,A.isPositioned]),N?y.jsx(rr,{...O,ref:v,onAutoScroll:()=>{const{viewport:g,selectedItem:h}=A;g&&h&&(g.scrollTop=g.scrollTop+h.offsetHeight)}}):null});qn.displayName=Ye;var rr=R.forwardRef((O,D)=>{const{__scopeSelect:A,onAutoScroll:j,...N}=O,V=Se("SelectScrollButton",A),v=R.useRef(null),g=Fe(A),h=R.useCallback(()=>{v.current!==null&&(window.clearInterval(v.current),v.current=null)},[]);return R.useEffect(()=>()=>h(),[h]),xe(()=>{var f;const x=g().find(l=>l.ref.current===document.activeElement);(f=x==null?void 0:x.ref.current)==null||f.scrollIntoView({block:"nearest"})},[g]),y.jsx(ue.div,{"aria-hidden":!0,...N,ref:D,style:{flexShrink:0,...N.style},onPointerDown:ae(N.onPointerDown,()=>{v.current===null&&(v.current=window.setInterval(j,50))}),onPointerMove:ae(N.onPointerMove,()=>{var x;(x=V.onItemLeave)==null||x.call(V),v.current===null&&(v.current=window.setInterval(j,50))}),onPointerLeave:ae(N.onPointerLeave,()=>{h()})})}),$n="SelectSeparator",nr=R.forwardRef((O,D)=>{const{__scopeSelect:A,...j}=O;return y.jsx(ue.div,{"aria-hidden":!0,...j,ref:D})});nr.displayName=$n;var Xe="SelectArrow",ei=R.forwardRef((O,D)=>{const{__scopeSelect:A,...j}=O,N=Ne(A),V=Ee(Xe,A),v=Se(Xe,A);return V.open&&v.position==="popper"?y.jsx(Pn,{...N,...j,ref:D}):null});ei.displayName=Xe;var ti="SelectBubbleInput",ir=R.forwardRef(({__scopeSelect:O,value:D,...A},j)=>{const N=R.useRef(null),V=pe(j,N),v=tn(D);return R.useEffect(()=>{const g=N.current;if(!g)return;const h=window.HTMLSelectElement.prototype,f=Object.getOwnPropertyDescriptor(h,"value").set;if(v!==D&&f){const l=new Event("change",{bubbles:!0});f.call(g,D),g.dispatchEvent(l)}},[v,D]),y.jsx(ue.select,{...A,style:{...vr,...A.style},ref:V,defaultValue:D})});ir.displayName=ti;function sr(O){return O===""||O===void 0}function or(O){const D=ht(O),A=R.useRef(""),j=R.useRef(0),N=R.useCallback(v=>{const g=A.current+v;D(g),function h(x){A.current=x,window.clearTimeout(j.current),x!==""&&(j.current=window.setTimeout(()=>h(""),1e3))}(g)},[D]),V=R.useCallback(()=>{A.current="",window.clearTimeout(j.current)},[]);return R.useEffect(()=>()=>window.clearTimeout(j.current),[]),[A,N,V]}function ar(O,D,A){const N=D.length>1&&Array.from(D).every(x=>x===D[0])?D[0]:D,V=A?O.indexOf(A):-1;let v=ri(O,Math.max(V,0));N.length===1&&(v=v.filter(x=>x!==A));const h=v.find(x=>x.textValue.toLowerCase().startsWith(N.toLowerCase()));return h!==A?h:void 0}function ri(O,D){return O.map((A,j)=>O[(D+j)%O.length])}var ni=Ft,lr=Bt,ii=Ut,si=Vt,oi=Wt,ur=Kt,ai=Yt,cr=Jt,dr=qt,li=$t,ui=tr,fr=nr;const at=ni,lt=ii,Ze=R.forwardRef(({className:O,children:D,...A},j)=>y.jsxs(lr,{ref:j,className:ye("flex items-center justify-between text-sm outline-none disabled:cursor-not-allowed disabled:opacity-50",O),...A,children:[D,y.jsx(si,{asChild:!0,children:y.jsx(Ve,{className:"h-4 w-4 opacity-50"})})]}));Ze.displayName=lr.displayName;const Je=R.forwardRef(({className:O,children:D,position:A="popper",...j},N)=>y.jsx(oi,{children:y.jsx(ur,{ref:N,className:ye("relative z-50 min-w-[8rem] overflow-hidden rounded-lg border bg-white text-gray-900 shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",A==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",O),position:A,...j,children:y.jsx(ai,{className:ye("p-1",A==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:D})})}));Je.displayName=ur.displayName;const ci=R.forwardRef(({className:O,...D},A)=>y.jsx(cr,{ref:A,className:ye("py-1.5 pl-8 pr-2 text-sm font-semibold",O),...D}));ci.displayName=cr.displayName;const Qe=R.forwardRef(({className:O,children:D,...A},j)=>y.jsxs(dr,{ref:j,className:ye("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-gray-100",O),...A,children:[y.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:y.jsx(ui,{children:y.jsx(We,{className:"h-4 w-4"})})}),y.jsx(li,{children:D})]}));Qe.displayName=dr.displayName;const di=R.forwardRef(({className:O,...D},A)=>y.jsx(fr,{ref:A,className:ye("-mx-1 my-1 h-px bg-gray-200",O),...D}));di.displayName=fr.displayName;const ut={selectTrigger:"rounded-md h-9 w-full border border-input bg-transparent px-3 py-2 shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring [&>span]:line-clamp-1"},fi=({initFormData:O={},regions:D,projects:A,onSubmit:j,onReset:N})=>{const[V,v]=R.useState(!1),[g,h]=R.useState(O);R.useRef(!1);const{setBottomNavVisible:x}=rn(),f=(r,n)=>{console.log("handleChange",r,n),console.log("handleChange",r,n),console.log("handleChange",r,n),h(u=>({...u,[r]:n})),console.log("formData",g)},l=()=>{j(g),v(!1)},a=()=>{h({}),N==null||N()};R.useEffect(()=>{x(!V)},[V]);const d=(r=[],n=0)=>r.map(u=>y.jsxs("div",{children:[y.jsxs(Qe,{value:u.id,className:n>0?`pl-${n*4}`:"",children:["└─".repeat(n),u.regionName]}),d(u.childCameraRegionRespVO||[],n+1)]},u.id+"_"+n));return y.jsxs(jr,{open:V,onOpenChange:v,children:[y.jsx(Fr,{asChild:!0,children:y.jsx(Pe,{variant:"outline",size:"icon",className:"p-2.5",children:y.jsx(gt,{})})}),y.jsxs(Nr,{side:"bottom",className:"rounded-t-xl max-w-md mx-auto transition-all duration-300",hideClose:!0,children:[y.jsxs(Br,{className:"items-center",children:[y.jsx(kr,{children:"筛选"}),y.jsx(Ur,{}),y.jsx(Vr,{className:"absolute right-4 top-4 rounded-full bg-gray-100 p-1 w-6 h-6 hover:bg-gray-200",children:y.jsx(dt,{className:"h-4 w-4 text-gray-800"})})]}),y.jsxs("div",{className:"flex flex-col gap-6 py-1 px-4",children:[y.jsxs(at,{value:g.project||"",onValueChange:r=>f("project",r),children:[y.jsx(Ze,{className:ut.selectTrigger,children:y.jsx(lt,{placeholder:"项目"})}),y.jsx(Je,{children:A.map(r=>y.jsx(Qe,{value:r.id,children:r.name},r.id))})]}),y.jsxs(at,{value:g.id||"",onValueChange:r=>f("id",r),children:[y.jsx(Ze,{className:ut.selectTrigger,children:y.jsx(lt,{placeholder:"区域"})}),y.jsx(Je,{children:D.length===0?y.jsx("div",{className:"text-sm text-muted-foreground px-2 py-1.5",children:"加载中..."}):d(D)})]})]}),y.jsxs("div",{className:"flex justify-between gap-2 px-4 pb-10 py-4 border-t",children:[y.jsx("div",{className:"w-1/2",children:y.jsx(Pe,{variant:"outline",onClick:a,className:"rounded-4xl bg-white border-gray-300 hover:bg-gray-50 w-full",children:"重置"})}),y.jsx("div",{className:"w-1/2",children:y.jsx(Pe,{onClick:l,className:"rounded-4xl bg-gray-900 hover:bg-gray-800 w-full",children:"确定"})})]})]})]})},hi=O=>$e("/admin-api/app/workbench/cameraRegionTree",O),pi=O=>vt("/admin-api/c3mais/camera/largeScreen/camera/list",O),_i=O=>vt("/admin-api/c3mais/camera/largeScreen/available/camera",O);var Ue={exports:{}},ct;function mi(){return ct||(ct=1,function(O,D){(function(j,N){O.exports=N()})(self,function(){return function(){var A={"./node_modules/es6-promise/dist/es6-promise.js":function(v,g,h){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(x,f){v.exports=f()})(this,function(){function x(F){var z=typeof F;return F!==null&&(z==="object"||z==="function")}function f(F){return typeof F=="function"}var l=void 0;Array.isArray?l=Array.isArray:l=function(F){return Object.prototype.toString.call(F)==="[object Array]"};var a=l,d=0,r=void 0,n=void 0,u=function(z,H){w[d]=z,w[d+1]=H,d+=2,d===2&&(n?n(S):I())};function i(F){n=F}function e(F){u=F}var s=typeof window<"u"?window:void 0,o=s||{},t=o.MutationObserver||o.WebKitMutationObserver,c=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",p=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function _(){return function(){return process.nextTick(S)}}function E(){return typeof r<"u"?function(){r(S)}:m()}function L(){var F=0,z=new t(S),H=document.createTextNode("");return z.observe(H,{characterData:!0}),function(){H.data=F=++F%2}}function b(){var F=new MessageChannel;return F.port1.onmessage=S,function(){return F.port2.postMessage(0)}}function m(){var F=setTimeout;return function(){return F(S,1)}}var w=new Array(1e3);function S(){for(var F=0;F<d;F+=2){var z=w[F],H=w[F+1];z(H),w[F]=void 0,w[F+1]=void 0}d=0}function P(){try{var F=Function("return this")().require("vertx");return r=F.runOnLoop||F.runOnContext,E()}catch{return m()}}var I=void 0;c?I=_():t?I=L():p?I=b():s===void 0?I=P():I=m();function U(F,z){var H=this,Q=new this.constructor(C);Q[W]===void 0&&Le(Q);var ne=H._state;if(ne){var ie=arguments[ne-1];u(function(){return fe(ne,Q,ie,H._result)})}else se(H,Q,F,z);return Q}function B(F){var z=this;if(F&&typeof F=="object"&&F.constructor===z)return F;var H=new z(C);return ee(H,F),H}var W=Math.random().toString(36).substring(2);function C(){}var k=void 0,G=1,M=2;function Y(){return new TypeError("You cannot resolve a promise with itself")}function X(){return new TypeError("A promises callback cannot return that same promise.")}function J(F,z,H,Q){try{F.call(z,H,Q)}catch(ne){return ne}}function K(F,z,H){u(function(Q){var ne=!1,ie=J(H,z,function(oe){ne||(ne=!0,z!==oe?ee(Q,oe):q(Q,oe))},function(oe){ne||(ne=!0,Z(Q,oe))},"Settle: "+(Q._label||" unknown promise"));!ne&&ie&&(ne=!0,Z(Q,ie))},F)}function $(F,z){z._state===G?q(F,z._result):z._state===M?Z(F,z._result):se(z,void 0,function(H){return ee(F,H)},function(H){return Z(F,H)})}function re(F,z,H){z.constructor===F.constructor&&H===U&&z.constructor.resolve===B?$(F,z):H===void 0?q(F,z):f(H)?K(F,z,H):q(F,z)}function ee(F,z){if(F===z)Z(F,Y());else if(x(z)){var H=void 0;try{H=z.then}catch(Q){Z(F,Q);return}re(F,z,H)}else q(F,z)}function te(F){F._onerror&&F._onerror(F._result),le(F)}function q(F,z){F._state===k&&(F._result=z,F._state=G,F._subscribers.length!==0&&u(le,F))}function Z(F,z){F._state===k&&(F._state=M,F._result=z,u(te,F))}function se(F,z,H,Q){var ne=F._subscribers,ie=ne.length;F._onerror=null,ne[ie]=z,ne[ie+G]=H,ne[ie+M]=Q,ie===0&&F._state&&u(le,F)}function le(F){var z=F._subscribers,H=F._state;if(z.length!==0){for(var Q=void 0,ne=void 0,ie=F._result,oe=0;oe<z.length;oe+=3)Q=z[oe],ne=z[oe+H],Q?fe(H,Q,ne,ie):ne(ie);F._subscribers.length=0}}function fe(F,z,H,Q){var ne=f(H),ie=void 0,oe=void 0,Ae=!0;if(ne){try{ie=H(Q)}catch(Ie){Ae=!1,oe=Ie}if(z===ie){Z(z,X());return}}else ie=Q;z._state!==k||(ne&&Ae?ee(z,ie):Ae===!1?Z(z,oe):F===G?q(z,ie):F===M&&Z(z,ie))}function ce(F,z){try{z(function(Q){ee(F,Q)},function(Q){Z(F,Q)})}catch(H){Z(F,H)}}var ge=0;function _e(){return ge++}function Le(F){F[W]=ge++,F._state=void 0,F._result=void 0,F._subscribers=[]}function ve(){return new Error("Array Methods must be provided an Array")}var he=function(){function F(z,H){this._instanceConstructor=z,this.promise=new z(C),this.promise[W]||Le(this.promise),a(H)?(this.length=H.length,this._remaining=H.length,this._result=new Array(this.length),this.length===0?q(this.promise,this._result):(this.length=this.length||0,this._enumerate(H),this._remaining===0&&q(this.promise,this._result))):Z(this.promise,ve())}return F.prototype._enumerate=function(H){for(var Q=0;this._state===k&&Q<H.length;Q++)this._eachEntry(H[Q],Q)},F.prototype._eachEntry=function(H,Q){var ne=this._instanceConstructor,ie=ne.resolve;if(ie===B){var oe=void 0,Ae=void 0,Ie=!1;try{oe=H.then}catch(ke){Ie=!0,Ae=ke}if(oe===U&&H._state!==k)this._settledAt(H._state,Q,H._result);else if(typeof oe!="function")this._remaining--,this._result[Q]=H;else if(ne===de){var Be=new ne(C);Ie?Z(Be,Ae):re(Be,H,oe),this._willSettleAt(Be,Q)}else this._willSettleAt(new ne(function(ke){return ke(H)}),Q)}else this._willSettleAt(ie(H),Q)},F.prototype._settledAt=function(H,Q,ne){var ie=this.promise;ie._state===k&&(this._remaining--,H===M?Z(ie,ne):this._result[Q]=ne),this._remaining===0&&q(ie,this._result)},F.prototype._willSettleAt=function(H,Q){var ne=this;se(H,void 0,function(ie){return ne._settledAt(G,Q,ie)},function(ie){return ne._settledAt(M,Q,ie)})},F}();function Ce(F){return new he(this,F).promise}function Oe(F){var z=this;return a(F)?new z(function(H,Q){for(var ne=F.length,ie=0;ie<ne;ie++)z.resolve(F[ie]).then(H,Q)}):new z(function(H,Q){return Q(new TypeError("You must pass an array to race."))})}function hr(F){var z=this,H=new z(C);return Z(H,F),H}function pr(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function _r(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var de=function(){function F(z){this[W]=_e(),this._result=this._state=void 0,this._subscribers=[],C!==z&&(typeof z!="function"&&pr(),this instanceof F?ce(this,z):_r())}return F.prototype.catch=function(H){return this.then(null,H)},F.prototype.finally=function(H){var Q=this,ne=Q.constructor;return f(H)?Q.then(function(ie){return ne.resolve(H()).then(function(){return ie})},function(ie){return ne.resolve(H()).then(function(){throw ie})}):Q.then(H,H)},F}();de.prototype.then=U,de.all=Ce,de.race=Oe,de.resolve=B,de.reject=hr,de._setScheduler=i,de._setAsap=e,de._asap=u;function mr(){var F=void 0;if(typeof h.g<"u")F=h.g;else if(typeof self<"u")F=self;else try{F=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var z=F.Promise;if(z){var H=null;try{H=Object.prototype.toString.call(z.resolve())}catch{}if(H==="[object Promise]"&&!z.cast)return}F.Promise=de}return de.polyfill=mr,de.Promise=de,de})},"./node_modules/events/events.js":function(v){var g=typeof Reflect=="object"?Reflect:null,h=g&&typeof g.apply=="function"?g.apply:function(m,w,S){return Function.prototype.apply.call(m,w,S)},x;g&&typeof g.ownKeys=="function"?x=g.ownKeys:Object.getOwnPropertySymbols?x=function(m){return Object.getOwnPropertyNames(m).concat(Object.getOwnPropertySymbols(m))}:x=function(m){return Object.getOwnPropertyNames(m)};function f(b){console&&console.warn&&console.warn(b)}var l=Number.isNaN||function(m){return m!==m};function a(){a.init.call(this)}v.exports=a,v.exports.once=_,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var d=10;function r(b){if(typeof b!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof b)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return d},set:function(b){if(typeof b!="number"||b<0||l(b))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+b+".");d=b}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(m){if(typeof m!="number"||m<0||l(m))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+m+".");return this._maxListeners=m,this};function n(b){return b._maxListeners===void 0?a.defaultMaxListeners:b._maxListeners}a.prototype.getMaxListeners=function(){return n(this)},a.prototype.emit=function(m){for(var w=[],S=1;S<arguments.length;S++)w.push(arguments[S]);var P=m==="error",I=this._events;if(I!==void 0)P=P&&I.error===void 0;else if(!P)return!1;if(P){var U;if(w.length>0&&(U=w[0]),U instanceof Error)throw U;var B=new Error("Unhandled error."+(U?" ("+U.message+")":""));throw B.context=U,B}var W=I[m];if(W===void 0)return!1;if(typeof W=="function")h(W,this,w);else for(var C=W.length,k=t(W,C),S=0;S<C;++S)h(k[S],this,w);return!0};function u(b,m,w,S){var P,I,U;if(r(w),I=b._events,I===void 0?(I=b._events=Object.create(null),b._eventsCount=0):(I.newListener!==void 0&&(b.emit("newListener",m,w.listener?w.listener:w),I=b._events),U=I[m]),U===void 0)U=I[m]=w,++b._eventsCount;else if(typeof U=="function"?U=I[m]=S?[w,U]:[U,w]:S?U.unshift(w):U.push(w),P=n(b),P>0&&U.length>P&&!U.warned){U.warned=!0;var B=new Error("Possible EventEmitter memory leak detected. "+U.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");B.name="MaxListenersExceededWarning",B.emitter=b,B.type=m,B.count=U.length,f(B)}return b}a.prototype.addListener=function(m,w){return u(this,m,w,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(m,w){return u(this,m,w,!0)};function i(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function e(b,m,w){var S={fired:!1,wrapFn:void 0,target:b,type:m,listener:w},P=i.bind(S);return P.listener=w,S.wrapFn=P,P}a.prototype.once=function(m,w){return r(w),this.on(m,e(this,m,w)),this},a.prototype.prependOnceListener=function(m,w){return r(w),this.prependListener(m,e(this,m,w)),this},a.prototype.removeListener=function(m,w){var S,P,I,U,B;if(r(w),P=this._events,P===void 0)return this;if(S=P[m],S===void 0)return this;if(S===w||S.listener===w)--this._eventsCount===0?this._events=Object.create(null):(delete P[m],P.removeListener&&this.emit("removeListener",m,S.listener||w));else if(typeof S!="function"){for(I=-1,U=S.length-1;U>=0;U--)if(S[U]===w||S[U].listener===w){B=S[U].listener,I=U;break}if(I<0)return this;I===0?S.shift():c(S,I),S.length===1&&(P[m]=S[0]),P.removeListener!==void 0&&this.emit("removeListener",m,B||w)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(m){var w,S,P;if(S=this._events,S===void 0)return this;if(S.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):S[m]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete S[m]),this;if(arguments.length===0){var I=Object.keys(S),U;for(P=0;P<I.length;++P)U=I[P],U!=="removeListener"&&this.removeAllListeners(U);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(w=S[m],typeof w=="function")this.removeListener(m,w);else if(w!==void 0)for(P=w.length-1;P>=0;P--)this.removeListener(m,w[P]);return this};function s(b,m,w){var S=b._events;if(S===void 0)return[];var P=S[m];return P===void 0?[]:typeof P=="function"?w?[P.listener||P]:[P]:w?p(P):t(P,P.length)}a.prototype.listeners=function(m){return s(this,m,!0)},a.prototype.rawListeners=function(m){return s(this,m,!1)},a.listenerCount=function(b,m){return typeof b.listenerCount=="function"?b.listenerCount(m):o.call(b,m)},a.prototype.listenerCount=o;function o(b){var m=this._events;if(m!==void 0){var w=m[b];if(typeof w=="function")return 1;if(w!==void 0)return w.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?x(this._events):[]};function t(b,m){for(var w=new Array(m),S=0;S<m;++S)w[S]=b[S];return w}function c(b,m){for(;m+1<b.length;m++)b[m]=b[m+1];b.pop()}function p(b){for(var m=new Array(b.length),w=0;w<m.length;++w)m[w]=b[w].listener||b[w];return m}function _(b,m){return new Promise(function(w,S){function P(U){b.removeListener(m,I),S(U)}function I(){typeof b.removeListener=="function"&&b.removeListener("error",P),w([].slice.call(arguments))}L(b,m,I,{once:!0}),m!=="error"&&E(b,P,{once:!0})})}function E(b,m,w){typeof b.on=="function"&&L(b,"error",m,w)}function L(b,m,w,S){if(typeof b.on=="function")S.once?b.once(m,w):b.on(m,w);else if(typeof b.addEventListener=="function")b.addEventListener(m,function P(I){S.once&&b.removeEventListener(m,P),w(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof b)}},"./node_modules/webworkify-webpack/index.js":function(v,g,h){function x(i){var e={};function s(t){if(e[t])return e[t].exports;var c=e[t]={i:t,l:!1,exports:{}};return i[t].call(c.exports,c,c.exports,s),c.l=!0,c.exports}s.m=i,s.c=e,s.i=function(t){return t},s.d=function(t,c,p){s.o(t,c)||Object.defineProperty(t,c,{configurable:!1,enumerable:!0,get:p})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var c=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(c,"a",c),c},s.o=function(t,c){return Object.prototype.hasOwnProperty.call(t,c)},s.p="/",s.oe=function(t){throw console.error(t),t};var o=s(s.s=ENTRY_MODULE);return o.default||o}var f="[\\.|\\-|\\+|\\w|/|@]+",l="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+f+").*?\\)";function a(i){return(i+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function d(i){return!isNaN(1*i)}function r(i,e,s){var o={};o[s]=[];var t=e.toString(),c=t.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!c)return o;for(var p=c[1],_=new RegExp("(\\\\n|\\W)"+a(p)+l,"g"),E;E=_.exec(t);)E[3]!=="dll-reference"&&o[s].push(E[3]);for(_=new RegExp("\\("+a(p)+'\\("(dll-reference\\s('+f+'))"\\)\\)'+l,"g");E=_.exec(t);)i[E[2]]||(o[s].push(E[1]),i[E[2]]=h(E[1]).m),o[E[2]]=o[E[2]]||[],o[E[2]].push(E[4]);for(var L=Object.keys(o),b=0;b<L.length;b++)for(var m=0;m<o[L[b]].length;m++)d(o[L[b]][m])&&(o[L[b]][m]=1*o[L[b]][m]);return o}function n(i){var e=Object.keys(i);return e.reduce(function(s,o){return s||i[o].length>0},!1)}function u(i,e){for(var s={main:[e]},o={main:[]},t={main:{}};n(s);)for(var c=Object.keys(s),p=0;p<c.length;p++){var _=c[p],E=s[_],L=E.pop();if(t[_]=t[_]||{},!(t[_][L]||!i[_][L])){t[_][L]=!0,o[_]=o[_]||[],o[_].push(L);for(var b=r(i,i[_][L],_),m=Object.keys(b),w=0;w<m.length;w++)s[m[w]]=s[m[w]]||[],s[m[w]]=s[m[w]].concat(b[m[w]])}}return o}v.exports=function(i,e){e=e||{};var s={main:h.m},o=e.all?{main:Object.keys(s.main)}:u(s,i),t="";Object.keys(o).filter(function(L){return L!=="main"}).forEach(function(L){for(var b=0;o[L][b];)b++;o[L].push(b),s[L][b]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",t=t+"var "+L+" = ("+x.toString().replace("ENTRY_MODULE",JSON.stringify(b))+")({"+o[L].map(function(m){return""+JSON.stringify(m)+": "+s[L][m].toString()}).join(",")+`});
`}),t=t+"new (("+x.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+o.main.map(function(L){return""+JSON.stringify(L)+": "+s.main[L].toString()}).join(",")+"}))(self);";var c=new window.Blob([t],{type:"text/javascript"});if(e.bare)return c;var p=window.URL||window.webkitURL||window.mozURL||window.msURL,_=p.createObjectURL(c),E=new window.Worker(_);return E.objectURL=_,E}},"./src/config.js":function(v,g,h){h.r(g),h.d(g,{defaultConfig:function(){return x},createDefaultConfig:function(){return f}});var x={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function f(){return Object.assign({},x)}},"./src/core/features.js":function(v,g,h){h.r(g);var x=h("./src/io/io-controller.js"),f=h("./src/config.js"),l=function(){function a(){}return a.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},a.supportNetworkStreamIO=function(){var d=new x.default({},(0,f.createDefaultConfig)()),r=d.loaderType;return d.destroy(),r=="fetch-stream-loader"||r=="xhr-moz-chunked-loader"},a.getNetworkLoaderTypeName=function(){var d=new x.default({},(0,f.createDefaultConfig)()),r=d.loaderType;return d.destroy(),r},a.supportNativeMediaPlayback=function(d){a.videoElement==null&&(a.videoElement=window.document.createElement("video"));var r=a.videoElement.canPlayType(d);return r==="probably"||r=="maybe"},a.getFeatureList=function(){var d={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return d.mseFlvPlayback=a.supportMSEH264Playback(),d.networkStreamIO=a.supportNetworkStreamIO(),d.networkLoaderName=a.getNetworkLoaderTypeName(),d.mseLiveFlvPlayback=d.mseFlvPlayback&&d.networkStreamIO,d.nativeMP4H264Playback=a.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),d.nativeWebmVP8Playback=a.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),d.nativeWebmVP9Playback=a.supportNativeMediaPlayback('video/webm; codecs="vp9"'),d},a}();g.default=l},"./src/core/media-info.js":function(v,g,h){h.r(g);var x=function(){function f(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return f.prototype.isComplete=function(){var l=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,a=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&l&&a},f.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},f.prototype.getNearestKeyframe=function(l){if(this.keyframesIndex==null)return null;var a=this.keyframesIndex,d=this._search(a.times,l);return{index:d,milliseconds:a.times[d],fileposition:a.filepositions[d]}},f.prototype._search=function(l,a){var d=0,r=l.length-1,n=0,u=0,i=r;for(a<l[0]&&(d=0,u=i+1);u<=i;)if(n=u+Math.floor((i-u)/2),n===r||a>=l[n]&&a<l[n+1]){d=n;break}else l[n]<a?u=n+1:i=n-1;return d},f}();g.default=x},"./src/core/media-segment-info.js":function(v,g,h){h.r(g),h.d(g,{SampleInfo:function(){return x},MediaSegmentInfo:function(){return f},IDRSampleList:function(){return l},MediaSegmentInfoList:function(){return a}});var x=function(){function d(r,n,u,i,e){this.dts=r,this.pts=n,this.duration=u,this.originalDts=i,this.isSyncPoint=e,this.fileposition=null}return d}(),f=function(){function d(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return d.prototype.appendSyncPoint=function(r){r.isSyncPoint=!0,this.syncPoints.push(r)},d}(),l=function(){function d(){this._list=[]}return d.prototype.clear=function(){this._list=[]},d.prototype.appendArray=function(r){var n=this._list;r.length!==0&&(n.length>0&&r[0].originalDts<n[n.length-1].originalDts&&this.clear(),Array.prototype.push.apply(n,r))},d.prototype.getLastSyncPointBeforeDts=function(r){if(this._list.length==0)return null;var n=this._list,u=0,i=n.length-1,e=0,s=0,o=i;for(r<n[0].dts&&(u=0,s=o+1);s<=o;)if(e=s+Math.floor((o-s)/2),e===i||r>=n[e].dts&&r<n[e+1].dts){u=e;break}else n[e].dts<r?s=e+1:o=e-1;return this._list[u]},d}(),a=function(){function d(r){this._type=r,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),d.prototype.isEmpty=function(){return this._list.length===0},d.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},d.prototype._searchNearestSegmentBefore=function(r){var n=this._list;if(n.length===0)return-2;var u=n.length-1,i=0,e=0,s=u,o=0;if(r<n[0].originalBeginDts)return o=-1,o;for(;e<=s;)if(i=e+Math.floor((s-e)/2),i===u||r>n[i].lastSample.originalDts&&r<n[i+1].originalBeginDts){o=i;break}else n[i].originalBeginDts<r?e=i+1:s=i-1;return o},d.prototype._searchNearestSegmentAfter=function(r){return this._searchNearestSegmentBefore(r)+1},d.prototype.append=function(r){var n=this._list,u=r,i=this._lastAppendLocation,e=0;i!==-1&&i<n.length&&u.originalBeginDts>=n[i].lastSample.originalDts&&(i===n.length-1||i<n.length-1&&u.originalBeginDts<n[i+1].originalBeginDts)?e=i+1:n.length>0&&(e=this._searchNearestSegmentBefore(u.originalBeginDts)+1),this._lastAppendLocation=e,this._list.splice(e,0,u)},d.prototype.getLastSegmentBefore=function(r){var n=this._searchNearestSegmentBefore(r);return n>=0?this._list[n]:null},d.prototype.getLastSampleBefore=function(r){var n=this.getLastSegmentBefore(r);return n!=null?n.lastSample:null},d.prototype.getLastSyncPointBefore=function(r){for(var n=this._searchNearestSegmentBefore(r),u=this._list[n].syncPoints;u.length===0&&n>0;)n--,u=this._list[n].syncPoints;return u.length>0?u[u.length-1]:null},d}()},"./src/core/mse-controller.js":function(v,g,h){h.r(g);var x=h("./node_modules/events/events.js"),f=h.n(x),l=h("./src/utils/logger.js"),a=h("./src/utils/browser.js"),d=h("./src/core/mse-events.js"),r=h("./src/core/media-segment-info.js"),n=h("./src/utils/exception.js"),u=function(){function i(e){this.TAG="MSEController",this._config=e,this._emitter=new(f()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new r.IDRSampleList}return i.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},i.prototype.on=function(e,s){this._emitter.addListener(e,s)},i.prototype.off=function(e,s){this._emitter.removeListener(e,s)},i.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new n.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var s=this._mediaSource=new window.MediaSource;s.addEventListener("sourceopen",this.e.onSourceOpen),s.addEventListener("sourceended",this.e.onSourceEnded),s.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL},i.prototype.detachMediaElement=function(){if(this._mediaSource){var e=this._mediaSource;for(var s in this._sourceBuffers){var o=this._pendingSegments[s];o.splice(0,o.length),this._pendingSegments[s]=null,this._pendingRemoveRanges[s]=null,this._lastInitSegments[s]=null;var t=this._sourceBuffers[s];if(t){if(e.readyState!=="closed"){try{e.removeSourceBuffer(t)}catch(c){l.default.e(this.TAG,c.message)}t.removeEventListener("error",this.e.onSourceBufferError),t.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[s]=null,this._sourceBuffers[s]=null}}if(e.readyState==="open")try{e.endOfStream()}catch(c){l.default.e(this.TAG,c.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},i.prototype.appendInitSegment=function(e,s){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(e),this._pendingSegments[e.type].push(e);return}var o=e,t=""+o.container;o.codec&&o.codec.length>0&&(t+=";codecs="+o.codec);var c=!1;if(l.default.v(this.TAG,"Received Initialization Segment, mimeType: "+t),this._lastInitSegments[o.type]=o,t!==this._mimeTypes[o.type]){if(this._mimeTypes[o.type])l.default.v(this.TAG,"Notice: "+o.type+" mimeType changed, origin: "+this._mimeTypes[o.type]+", target: "+t);else{c=!0;try{var p=this._sourceBuffers[o.type]=this._mediaSource.addSourceBuffer(t);p.addEventListener("error",this.e.onSourceBufferError),p.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(_){l.default.e(this.TAG,_.message),this._emitter.emit(d.default.ERROR,{code:_.code,msg:_.message});return}}this._mimeTypes[o.type]=t}s||this._pendingSegments[o.type].push(o),c||this._sourceBuffers[o.type]&&!this._sourceBuffers[o.type].updating&&this._doAppendSegments(),a.default.safari&&o.container==="audio/mpeg"&&o.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=o.mediaDuration/1e3,this._updateMediaSourceDuration())},i.prototype.appendMediaSegment=function(e){var s=e;this._pendingSegments[s.type].push(s),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var o=this._sourceBuffers[s.type];o&&!o.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},i.prototype.seek=function(e){for(var s in this._sourceBuffers)if(this._sourceBuffers[s]){var o=this._sourceBuffers[s];if(this._mediaSource.readyState==="open")try{o.abort()}catch(L){l.default.e(this.TAG,L.message)}this._idrList.clear();var t=this._pendingSegments[s];if(t.splice(0,t.length),this._mediaSource.readyState!=="closed"){for(var c=0;c<o.buffered.length;c++){var p=o.buffered.start(c),_=o.buffered.end(c);this._pendingRemoveRanges[s].push({start:p,end:_})}if(o.updating||this._doRemoveRanges(),a.default.safari){var E=this._lastInitSegments[s];E&&(this._pendingSegments[s].push(E),o.updating||this._doAppendSegments())}}}},i.prototype.endOfStream=function(){var e=this._mediaSource,s=this._sourceBuffers;if(!e||e.readyState!=="open"){e&&e.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}s.video&&s.video.updating||s.audio&&s.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream())},i.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},i.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var s in this._sourceBuffers){var o=this._sourceBuffers[s];if(o){var t=o.buffered;if(t.length>=1&&e-t.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},i.prototype._doCleanupSourceBuffer=function(){var e=this._mediaElement.currentTime;for(var s in this._sourceBuffers){var o=this._sourceBuffers[s];if(o){for(var t=o.buffered,c=!1,p=0;p<t.length;p++){var _=t.start(p),E=t.end(p);if(_<=e&&e<E+3){if(e-_>=this._config.autoCleanupMaxBackwardDuration){c=!0;var L=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[s].push({start:_,end:L})}}else E<e&&(c=!0,this._pendingRemoveRanges[s].push({start:_,end:E}))}c&&!o.updating&&this._doRemoveRanges()}}},i.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var s=this._mediaSource.duration,o=this._pendingMediaDuration;o>0&&(isNaN(s)||o>s)&&(l.default.v(this.TAG,"Update MediaSource duration from "+s+" to "+o),this._mediaSource.duration=o),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},i.prototype._doRemoveRanges=function(){for(var e in this._pendingRemoveRanges)if(!(!this._sourceBuffers[e]||this._sourceBuffers[e].updating))for(var s=this._sourceBuffers[e],o=this._pendingRemoveRanges[e];o.length&&!s.updating;){var t=o.shift();s.remove(t.start,t.end)}},i.prototype._doAppendSegments=function(){var e=this._pendingSegments;for(var s in e)if(!(!this._sourceBuffers[s]||this._sourceBuffers[s].updating)&&e[s].length>0){var o=e[s].shift();if(o.timestampOffset){var t=this._sourceBuffers[s].timestampOffset,c=o.timestampOffset/1e3,p=Math.abs(t-c);p>.1&&(l.default.v(this.TAG,"Update MPEG audio timestampOffset from "+t+" to "+c),this._sourceBuffers[s].timestampOffset=c),delete o.timestampOffset}if(!o.data||o.data.byteLength===0)continue;try{this._sourceBuffers[s].appendBuffer(o.data),this._isBufferFull=!1,s==="video"&&o.hasOwnProperty("info")&&this._idrList.appendArray(o.info.syncPoints)}catch(_){this._pendingSegments[s].unshift(o),_.code===22?(this._isBufferFull||this._emitter.emit(d.default.BUFFER_FULL),this._isBufferFull=!0):(l.default.e(this.TAG,_.message),this._emitter.emit(d.default.ERROR,{code:_.code,msg:_.message}))}}},i.prototype._onSourceOpen=function(){if(l.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var s=e.shift();this.appendInitSegment(s,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(d.default.SOURCE_OPEN)},i.prototype._onSourceEnded=function(){l.default.v(this.TAG,"MediaSource onSourceEnded")},i.prototype._onSourceClose=function(){l.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},i.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0},i.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0},i.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(d.default.UPDATE_END)},i.prototype._onSourceBufferError=function(e){l.default.e(this.TAG,"SourceBuffer Error: "+e)},i}();g.default=u},"./src/core/mse-events.js":function(v,g,h){h.r(g);var x={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};g.default=x},"./src/core/transmuxer.js":function(v,g,h){h.r(g);var x=h("./node_modules/events/events.js"),f=h.n(x),l=h("./node_modules/webworkify-webpack/index.js"),a=h.n(l),d=h("./src/utils/logger.js"),r=h("./src/utils/logging-control.js"),n=h("./src/core/transmuxing-controller.js"),u=h("./src/core/transmuxing-events.js"),i=h("./src/core/media-info.js"),e=function(){function s(o,t){if(this.TAG="Transmuxer",this._emitter=new(f()),t.enableWorker&&typeof Worker<"u")try{this._worker=a()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[o,t]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},r.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:r.default.getConfig()})}catch{d.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new n.default(o,t)}else this._controller=new n.default(o,t);if(this._controller){var c=this._controller;c.on(u.default.IO_ERROR,this._onIOError.bind(this)),c.on(u.default.DEMUX_ERROR,this._onDemuxError.bind(this)),c.on(u.default.INIT_SEGMENT,this._onInitSegment.bind(this)),c.on(u.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),c.on(u.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),c.on(u.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),c.on(u.default.MEDIA_INFO,this._onMediaInfo.bind(this)),c.on(u.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),c.on(u.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),c.on(u.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),c.on(u.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return s.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),r.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},s.prototype.on=function(o,t){this._emitter.addListener(o,t)},s.prototype.off=function(o,t){this._emitter.removeListener(o,t)},s.prototype.hasWorker=function(){return this._worker!=null},s.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},s.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},s.prototype.seek=function(o){this._worker?this._worker.postMessage({cmd:"seek",param:o}):this._controller.seek(o)},s.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},s.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},s.prototype._onInitSegment=function(o,t){var c=this;Promise.resolve().then(function(){c._emitter.emit(u.default.INIT_SEGMENT,o,t)})},s.prototype._onMediaSegment=function(o,t){var c=this;Promise.resolve().then(function(){c._emitter.emit(u.default.MEDIA_SEGMENT,o,t)})},s.prototype._onLoadingComplete=function(){var o=this;Promise.resolve().then(function(){o._emitter.emit(u.default.LOADING_COMPLETE)})},s.prototype._onRecoveredEarlyEof=function(){var o=this;Promise.resolve().then(function(){o._emitter.emit(u.default.RECOVERED_EARLY_EOF)})},s.prototype._onMediaInfo=function(o){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.MEDIA_INFO,o)})},s.prototype._onMetaDataArrived=function(o){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.METADATA_ARRIVED,o)})},s.prototype._onScriptDataArrived=function(o){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.SCRIPTDATA_ARRIVED,o)})},s.prototype._onStatisticsInfo=function(o){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.STATISTICS_INFO,o)})},s.prototype._onIOError=function(o,t){var c=this;Promise.resolve().then(function(){c._emitter.emit(u.default.IO_ERROR,o,t)})},s.prototype._onDemuxError=function(o,t){var c=this;Promise.resolve().then(function(){c._emitter.emit(u.default.DEMUX_ERROR,o,t)})},s.prototype._onRecommendSeekpoint=function(o){var t=this;Promise.resolve().then(function(){t._emitter.emit(u.default.RECOMMEND_SEEKPOINT,o)})},s.prototype._onLoggingConfigChanged=function(o){this._worker&&this._worker.postMessage({cmd:"logging_config",param:o})},s.prototype._onWorkerMessage=function(o){var t=o.data,c=t.data;if(t.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(t.msg){case u.default.INIT_SEGMENT:case u.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,c.type,c.data);break;case u.default.LOADING_COMPLETE:case u.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case u.default.MEDIA_INFO:Object.setPrototypeOf(c,i.default.prototype),this._emitter.emit(t.msg,c);break;case u.default.METADATA_ARRIVED:case u.default.SCRIPTDATA_ARRIVED:case u.default.STATISTICS_INFO:this._emitter.emit(t.msg,c);break;case u.default.IO_ERROR:case u.default.DEMUX_ERROR:this._emitter.emit(t.msg,c.type,c.info);break;case u.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,c);break;case"logcat_callback":d.default.emitter.emit("log",c.type,c.logcat);break}},s}();g.default=e},"./src/core/transmuxing-controller.js":function(v,g,h){h.r(g);var x=h("./node_modules/events/events.js"),f=h.n(x),l=h("./src/utils/logger.js"),a=h("./src/utils/browser.js"),d=h("./src/core/media-info.js"),r=h("./src/demux/flv-demuxer.js"),n=h("./src/remux/mp4-remuxer.js"),u=h("./src/demux/demux-errors.js"),i=h("./src/io/io-controller.js"),e=h("./src/core/transmuxing-events.js"),s=function(){function o(t,c){this.TAG="TransmuxingController",this._emitter=new(f()),this._config=c,t.segments||(t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]),typeof t.cors!="boolean"&&(t.cors=!0),typeof t.withCredentials!="boolean"&&(t.withCredentials=!1),this._mediaDataSource=t,this._currentSegmentIndex=0;var p=0;this._mediaDataSource.segments.forEach(function(_){_.timestampBase=p,p+=_.duration,_.cors=t.cors,_.withCredentials=t.withCredentials,c.referrerPolicy&&(_.referrerPolicy=c.referrerPolicy)}),!isNaN(p)&&this._mediaDataSource.duration!==p&&(this._mediaDataSource.duration=p),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return o.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},o.prototype.on=function(t,c){this._emitter.addListener(t,c)},o.prototype.off=function(t,c){this._emitter.removeListener(t,c)},o.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},o.prototype._loadSegment=function(t,c){this._currentSegmentIndex=t;var p=this._mediaDataSource.segments[t],_=this._ioctl=new i.default(p,this._config,t);_.onError=this._onIOException.bind(this),_.onSeeked=this._onIOSeeked.bind(this),_.onComplete=this._onIOComplete.bind(this),_.onRedirect=this._onIORedirect.bind(this),_.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),c?this._demuxer.bindDataSource(this._ioctl):_.onDataArrival=this._onInitChunkArrival.bind(this),_.open(c)},o.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},o.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},o.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},o.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},o.prototype.seek=function(t){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var c=this._searchSegmentIndexContains(t);if(c===this._currentSegmentIndex){var p=this._mediaInfo.segments[c];if(p==null)this._pendingSeekTime=t;else{var _=p.getNearestKeyframe(t);this._remuxer.seek(_.milliseconds),this._ioctl.seek(_.fileposition),this._pendingResolveSeekPoint=_.milliseconds}}else{var E=this._mediaInfo.segments[c];if(E==null)this._pendingSeekTime=t,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(c);else{var _=E.getNearestKeyframe(t);this._internalAbort(),this._remuxer.seek(t),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[c].timestampBase,this._loadSegment(c,_.fileposition),this._pendingResolveSeekPoint=_.milliseconds,this._reportSegmentMediaInfo(c)}}this._enableStatisticsReporter()}},o.prototype._searchSegmentIndexContains=function(t){for(var c=this._mediaDataSource.segments,p=c.length-1,_=0;_<c.length;_++)if(t<c[_].timestampBase){p=_-1;break}return p},o.prototype._onInitChunkArrival=function(t,c){var p=this,_=null,E=0;if(c>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,E=this._demuxer.parseChunks(t,c);else if((_=r.default.probe(t)).match){this._demuxer=new r.default(_,this._config),this._remuxer||(this._remuxer=new n.default(this._config));var L=this._mediaDataSource;L.duration!=null&&!isNaN(L.duration)&&(this._demuxer.overridedDuration=L.duration),typeof L.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=L.hasAudio),typeof L.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=L.hasVideo),this._demuxer.timestampBase=L.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),E=this._demuxer.parseChunks(t,c)}else _=null,l.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){p._internalAbort()}),this._emitter.emit(e.default.DEMUX_ERROR,u.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),E=0;return E},o.prototype._onMediaInfo=function(t){var c=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},t),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,d.default.prototype));var p=Object.assign({},t);Object.setPrototypeOf(p,d.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=p,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var _=c._pendingSeekTime;c._pendingSeekTime=null,c.seek(_)})},o.prototype._onMetaDataArrived=function(t){this._emitter.emit(e.default.METADATA_ARRIVED,t)},o.prototype._onScriptDataArrived=function(t){this._emitter.emit(e.default.SCRIPTDATA_ARRIVED,t)},o.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},o.prototype._onIOComplete=function(t){var c=t,p=c+1;p<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(p)):(this._remuxer.flushStashedSamples(),this._emitter.emit(e.default.LOADING_COMPLETE),this._disableStatisticsReporter())},o.prototype._onIORedirect=function(t){var c=this._ioctl.extraData;this._mediaDataSource.segments[c].redirectedURL=t},o.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(e.default.RECOVERED_EARLY_EOF)},o.prototype._onIOException=function(t,c){l.default.e(this.TAG,"IOException: type = "+t+", code = "+c.code+", msg = "+c.msg),this._emitter.emit(e.default.IO_ERROR,t,c),this._disableStatisticsReporter()},o.prototype._onDemuxException=function(t,c){l.default.e(this.TAG,"DemuxException: type = "+t+", info = "+c),this._emitter.emit(e.default.DEMUX_ERROR,t,c)},o.prototype._onRemuxerInitSegmentArrival=function(t,c){this._emitter.emit(e.default.INIT_SEGMENT,t,c)},o.prototype._onRemuxerMediaSegmentArrival=function(t,c){if(this._pendingSeekTime==null&&(this._emitter.emit(e.default.MEDIA_SEGMENT,t,c),this._pendingResolveSeekPoint!=null&&t==="video")){var p=c.info.syncPoints,_=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,a.default.safari&&p.length>0&&p[0].originalDts===_&&(_=p[0].pts),this._emitter.emit(e.default.RECOMMEND_SEEKPOINT,_)}},o.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},o.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},o.prototype._reportSegmentMediaInfo=function(t){var c=this._mediaInfo.segments[t],p=Object.assign({},c);p.duration=this._mediaInfo.duration,p.segmentCount=this._mediaInfo.segmentCount,delete p.segments,delete p.keyframesIndex,this._emitter.emit(e.default.MEDIA_INFO,p)},o.prototype._reportStatisticsInfo=function(){var t={};t.url=this._ioctl.currentURL,t.hasRedirect=this._ioctl.hasRedirect,t.hasRedirect&&(t.redirectedURL=this._ioctl.currentRedirectedURL),t.speed=this._ioctl.currentSpeed,t.loaderType=this._ioctl.loaderType,t.currentSegmentIndex=this._currentSegmentIndex,t.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(e.default.STATISTICS_INFO,t)},o}();g.default=s},"./src/core/transmuxing-events.js":function(v,g,h){h.r(g);var x={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};g.default=x},"./src/core/transmuxing-worker.js":function(v,g,h){h.r(g);var x=h("./src/utils/logging-control.js"),f=h("./src/utils/polyfill.js"),l=h("./src/core/transmuxing-controller.js"),a=h("./src/core/transmuxing-events.js"),d=function(r){var n=null,u=m.bind(this);f.default.install(),r.addEventListener("message",function(w){switch(w.data.cmd){case"init":n=new l.default(w.data.param[0],w.data.param[1]),n.on(a.default.IO_ERROR,E.bind(this)),n.on(a.default.DEMUX_ERROR,L.bind(this)),n.on(a.default.INIT_SEGMENT,i.bind(this)),n.on(a.default.MEDIA_SEGMENT,e.bind(this)),n.on(a.default.LOADING_COMPLETE,s.bind(this)),n.on(a.default.RECOVERED_EARLY_EOF,o.bind(this)),n.on(a.default.MEDIA_INFO,t.bind(this)),n.on(a.default.METADATA_ARRIVED,c.bind(this)),n.on(a.default.SCRIPTDATA_ARRIVED,p.bind(this)),n.on(a.default.STATISTICS_INFO,_.bind(this)),n.on(a.default.RECOMMEND_SEEKPOINT,b.bind(this));break;case"destroy":n&&(n.destroy(),n=null),r.postMessage({msg:"destroyed"});break;case"start":n.start();break;case"stop":n.stop();break;case"seek":n.seek(w.data.param);break;case"pause":n.pause();break;case"resume":n.resume();break;case"logging_config":{var S=w.data.param;x.default.applyConfig(S),S.enableCallback===!0?x.default.addLogListener(u):x.default.removeLogListener(u);break}}});function i(w,S){var P={msg:a.default.INIT_SEGMENT,data:{type:w,data:S}};r.postMessage(P,[S.data])}function e(w,S){var P={msg:a.default.MEDIA_SEGMENT,data:{type:w,data:S}};r.postMessage(P,[S.data])}function s(){var w={msg:a.default.LOADING_COMPLETE};r.postMessage(w)}function o(){var w={msg:a.default.RECOVERED_EARLY_EOF};r.postMessage(w)}function t(w){var S={msg:a.default.MEDIA_INFO,data:w};r.postMessage(S)}function c(w){var S={msg:a.default.METADATA_ARRIVED,data:w};r.postMessage(S)}function p(w){var S={msg:a.default.SCRIPTDATA_ARRIVED,data:w};r.postMessage(S)}function _(w){var S={msg:a.default.STATISTICS_INFO,data:w};r.postMessage(S)}function E(w,S){r.postMessage({msg:a.default.IO_ERROR,data:{type:w,info:S}})}function L(w,S){r.postMessage({msg:a.default.DEMUX_ERROR,data:{type:w,info:S}})}function b(w){r.postMessage({msg:a.default.RECOMMEND_SEEKPOINT,data:w})}function m(w,S){r.postMessage({msg:"logcat_callback",data:{type:w,logcat:S}})}};g.default=d},"./src/demux/amf-parser.js":function(v,g,h){h.r(g);var x=h("./src/utils/logger.js"),f=h("./src/utils/utf8-conv.js"),l=h("./src/utils/exception.js"),a=function(){var r=new ArrayBuffer(2);return new DataView(r).setInt16(0,256,!0),new Int16Array(r)[0]===256}(),d=function(){function r(){}return r.parseScriptData=function(n,u,i){var e={};try{var s=r.parseValue(n,u,i),o=r.parseValue(n,u+s.size,i-s.size);e[s.data]=o.data}catch(t){x.default.e("AMF",t.toString())}return e},r.parseObject=function(n,u,i){if(i<3)throw new l.IllegalStateException("Data not enough when parse ScriptDataObject");var e=r.parseString(n,u,i),s=r.parseValue(n,u+e.size,i-e.size),o=s.objectEnd;return{data:{name:e.data,value:s.data},size:e.size+s.size,objectEnd:o}},r.parseVariable=function(n,u,i){return r.parseObject(n,u,i)},r.parseString=function(n,u,i){if(i<2)throw new l.IllegalStateException("Data not enough when parse String");var e=new DataView(n,u,i),s=e.getUint16(0,!a),o;return s>0?o=(0,f.default)(new Uint8Array(n,u+2,s)):o="",{data:o,size:2+s}},r.parseLongString=function(n,u,i){if(i<4)throw new l.IllegalStateException("Data not enough when parse LongString");var e=new DataView(n,u,i),s=e.getUint32(0,!a),o;return s>0?o=(0,f.default)(new Uint8Array(n,u+4,s)):o="",{data:o,size:4+s}},r.parseDate=function(n,u,i){if(i<10)throw new l.IllegalStateException("Data size invalid when parse Date");var e=new DataView(n,u,i),s=e.getFloat64(0,!a),o=e.getInt16(8,!a);return s+=o*60*1e3,{data:new Date(s),size:10}},r.parseValue=function(n,u,i){if(i<1)throw new l.IllegalStateException("Data not enough when parse Value");var e=new DataView(n,u,i),s=1,o=e.getUint8(0),t,c=!1;try{switch(o){case 0:t=e.getFloat64(1,!a),s+=8;break;case 1:{var p=e.getUint8(1);t=!!p,s+=1;break}case 2:{var _=r.parseString(n,u+1,i-1);t=_.data,s+=_.size;break}case 3:{t={};var E=0;for((e.getUint32(i-4,!a)&16777215)===9&&(E=3);s<i-4;){var L=r.parseObject(n,u+s,i-s-E);if(L.objectEnd)break;t[L.data.name]=L.data.value,s+=L.size}if(s<=i-3){var b=e.getUint32(s-1,!a)&16777215;b===9&&(s+=3)}break}case 8:{t={},s+=4;var E=0;for((e.getUint32(i-4,!a)&16777215)===9&&(E=3);s<i-8;){var m=r.parseVariable(n,u+s,i-s-E);if(m.objectEnd)break;t[m.data.name]=m.data.value,s+=m.size}if(s<=i-3){var b=e.getUint32(s-1,!a)&16777215;b===9&&(s+=3)}break}case 9:t=void 0,s=1,c=!0;break;case 10:{t=[];var w=e.getUint32(1,!a);s+=4;for(var S=0;S<w;S++){var P=r.parseValue(n,u+s,i-s);t.push(P.data),s+=P.size}break}case 11:{var I=r.parseDate(n,u+1,i-1);t=I.data,s+=I.size;break}case 12:{var U=r.parseString(n,u+1,i-1);t=U.data,s+=U.size;break}default:s=i,x.default.w("AMF","Unsupported AMF value type "+o)}}catch(B){x.default.e("AMF",B.toString())}return{data:t,size:s,objectEnd:c}},r}();g.default=d},"./src/demux/demux-errors.js":function(v,g,h){h.r(g);var x={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};g.default=x},"./src/demux/exp-golomb.js":function(v,g,h){h.r(g);var x=h("./src/utils/exception.js"),f=function(){function l(a){this.TAG="ExpGolomb",this._buffer=a,this._buffer_index=0,this._total_bytes=a.byteLength,this._total_bits=a.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return l.prototype.destroy=function(){this._buffer=null},l.prototype._fillCurrentWord=function(){var a=this._total_bytes-this._buffer_index;if(a<=0)throw new x.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var d=Math.min(4,a),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+d)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=d,this._current_word_bits_left=d*8},l.prototype.readBits=function(a){if(a>32)throw new x.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(a<=this._current_word_bits_left){var d=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,d}var r=this._current_word_bits_left?this._current_word:0;r=r>>>32-this._current_word_bits_left;var n=a-this._current_word_bits_left;this._fillCurrentWord();var u=Math.min(n,this._current_word_bits_left),i=this._current_word>>>32-u;return this._current_word<<=u,this._current_word_bits_left-=u,r=r<<u|i,r},l.prototype.readBool=function(){return this.readBits(1)===1},l.prototype.readByte=function(){return this.readBits(8)},l.prototype._skipLeadingZero=function(){var a;for(a=0;a<this._current_word_bits_left;a++)if((this._current_word&2147483648>>>a)!==0)return this._current_word<<=a,this._current_word_bits_left-=a,a;return this._fillCurrentWord(),a+this._skipLeadingZero()},l.prototype.readUEG=function(){var a=this._skipLeadingZero();return this.readBits(a+1)-1},l.prototype.readSEG=function(){var a=this.readUEG();return a&1?a+1>>>1:-1*(a>>>1)},l}();g.default=f},"./src/demux/flv-demuxer.js":function(v,g,h){h.r(g);var x=h("./src/utils/logger.js"),f=h("./src/demux/amf-parser.js"),l=h("./src/demux/sps-parser.js"),a=h("./src/demux/demux-errors.js"),d=h("./src/core/media-info.js"),r=h("./src/utils/exception.js");function n(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}var u=function(){function i(e,s){this.TAG="FLVDemuxer",this._config=s,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new d.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var o=new ArrayBuffer(2);return new DataView(o).setInt16(0,256,!0),new Int16Array(o)[0]===256}()}return i.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},i.probe=function(e){var s=new Uint8Array(e),o={match:!1};if(s[0]!==70||s[1]!==76||s[2]!==86||s[3]!==1)return o;var t=(s[4]&4)>>>2!==0,c=(s[4]&1)!==0,p=n(s,5);return p<9?o:{match:!0,consumed:p,dataOffset:p,hasAudioTrack:t,hasVideoTrack:c}},i.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(i.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),i.prototype.resetMediaInfo=function(){this._mediaInfo=new d.default},i.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},i.prototype.parseChunks=function(e,s){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new r.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var o=0,t=this._littleEndian;if(s===0)if(e.byteLength>13){var c=i.probe(e);o=c.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,s+o!==this._dataOffset&&x.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var p=new DataView(e,o),_=p.getUint32(0,!t);_!==0&&x.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),o+=4}for(;o<e.byteLength;){this._dispatch=!0;var p=new DataView(e,o);if(o+11+4>e.byteLength)break;var E=p.getUint8(0),L=p.getUint32(0,!t)&16777215;if(o+11+L+4>e.byteLength)break;if(E!==8&&E!==9&&E!==18){x.default.w(this.TAG,"Unsupported tag type "+E+", skipped"),o+=11+L+4;continue}var b=p.getUint8(4),m=p.getUint8(5),w=p.getUint8(6),S=p.getUint8(7),P=w|m<<8|b<<16|S<<24,I=p.getUint32(7,!t)&16777215;I!==0&&x.default.w(this.TAG,"Meet tag which has StreamID != 0!");var U=o+11;switch(E){case 8:this._parseAudioData(e,U,L,P);break;case 9:this._parseVideoData(e,U,L,P,s+o);break;case 18:this._parseScriptData(e,U,L);break}var B=p.getUint32(11+L,!t);B!==11+L&&x.default.w(this.TAG,"Invalid PrevTagSize "+B),o+=11+L+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),o},i.prototype._parseScriptData=function(e,s,o){var t=f.default.parseScriptData(e,s,o);if(t.hasOwnProperty("onMetaData")){if(t.onMetaData==null||typeof t.onMetaData!="object"){x.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&x.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=t;var c=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},c)),typeof c.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=c.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof c.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=c.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof c.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=c.audiodatarate),typeof c.videodatarate=="number"&&(this._mediaInfo.videoDataRate=c.videodatarate),typeof c.width=="number"&&(this._mediaInfo.width=c.width),typeof c.height=="number"&&(this._mediaInfo.height=c.height),typeof c.duration=="number"){if(!this._durationOverrided){var p=Math.floor(c.duration*this._timescale);this._duration=p,this._mediaInfo.duration=p}}else this._mediaInfo.duration=0;if(typeof c.framerate=="number"){var _=Math.floor(c.framerate*1e3);if(_>0){var E=_/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=E,this._referenceFrameRate.fps_num=_,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=E}}if(typeof c.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var L=c.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(L),c.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=c,x.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(t).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},t))},i.prototype._parseKeyframesIndex=function(e){for(var s=[],o=[],t=1;t<e.times.length;t++){var c=this._timestampBase+Math.floor(e.times[t]*1e3);s.push(c),o.push(e.filepositions[t])}return{times:s,filepositions:o}},i.prototype._parseAudioData=function(e,s,o,t){if(o<=1){x.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var c=new DataView(e,s,o),p=c.getUint8(0),_=p>>>4;if(_!==2&&_!==10){this._onError(a.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+_);return}var E=0,L=(p&12)>>>2;if(L>=0&&L<=4)E=this._flvSoundRateTable[L];else{this._onError(a.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+L);return}var b=p&1,m=this._audioMetadata,w=this._audioTrack;if(m||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),m=this._audioMetadata={},m.type="audio",m.id=w.id,m.timescale=this._timescale,m.duration=this._duration,m.audioSampleRate=E,m.channelCount=b===0?1:2),_===10){var S=this._parseAACAudioData(e,s+1,o-1);if(S==null)return;if(S.packetType===0){m.config&&x.default.w(this.TAG,"Found another AudioSpecificConfig!");var P=S.data;m.audioSampleRate=P.samplingRate,m.channelCount=P.channelCount,m.codec=P.codec,m.originalCodec=P.originalCodec,m.config=P.config,m.refSampleDuration=1024/m.audioSampleRate*m.timescale,x.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",m);var I=this._mediaInfo;I.audioCodec=m.originalCodec,I.audioSampleRate=m.audioSampleRate,I.audioChannelCount=m.channelCount,I.hasVideo?I.videoCodec!=null&&(I.mimeType='video/x-flv; codecs="'+I.videoCodec+","+I.audioCodec+'"'):I.mimeType='video/x-flv; codecs="'+I.audioCodec+'"',I.isComplete()&&this._onMediaInfo(I)}else if(S.packetType===1){var U=this._timestampBase+t,B={unit:S.data,length:S.data.byteLength,dts:U,pts:U};w.samples.push(B),w.length+=S.data.length}else x.default.e(this.TAG,"Flv: Unsupported AAC data type "+S.packetType)}else if(_===2){if(!m.codec){var P=this._parseMP3AudioData(e,s+1,o-1,!0);if(P==null)return;m.audioSampleRate=P.samplingRate,m.channelCount=P.channelCount,m.codec=P.codec,m.originalCodec=P.originalCodec,m.refSampleDuration=1152/m.audioSampleRate*m.timescale,x.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",m);var I=this._mediaInfo;I.audioCodec=m.codec,I.audioSampleRate=m.audioSampleRate,I.audioChannelCount=m.channelCount,I.audioDataRate=P.bitRate,I.hasVideo?I.videoCodec!=null&&(I.mimeType='video/x-flv; codecs="'+I.videoCodec+","+I.audioCodec+'"'):I.mimeType='video/x-flv; codecs="'+I.audioCodec+'"',I.isComplete()&&this._onMediaInfo(I)}var W=this._parseMP3AudioData(e,s+1,o-1,!1);if(W==null)return;var U=this._timestampBase+t,C={unit:W,length:W.byteLength,dts:U,pts:U};w.samples.push(C),w.length+=W.length}}},i.prototype._parseAACAudioData=function(e,s,o){if(o<=1){x.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var t={},c=new Uint8Array(e,s,o);return t.packetType=c[0],c[0]===0?t.data=this._parseAACAudioSpecificConfig(e,s+1,o-1):t.data=c.subarray(1),t},i.prototype._parseAACAudioSpecificConfig=function(e,s,o){var t=new Uint8Array(e,s,o),c=null,p=0,_=0,E=0,L=null;if(p=_=t[0]>>>3,E=(t[0]&7)<<1|t[1]>>>7,E<0||E>=this._mpegSamplingRates.length){this._onError(a.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var b=this._mpegSamplingRates[E],m=(t[1]&120)>>>3;if(m<0||m>=8){this._onError(a.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}p===5&&(L=(t[1]&7)<<1|t[2]>>>7,(t[2]&124)>>>2);var w=self.navigator.userAgent.toLowerCase();return w.indexOf("firefox")!==-1?E>=6?(p=5,c=new Array(4),L=E-3):(p=2,c=new Array(2),L=E):w.indexOf("android")!==-1?(p=2,c=new Array(2),L=E):(p=5,L=E,c=new Array(4),E>=6?L=E-3:m===1&&(p=2,c=new Array(2),L=E)),c[0]=p<<3,c[0]|=(E&15)>>>1,c[1]=(E&15)<<7,c[1]|=(m&15)<<3,p===5&&(c[1]|=(L&15)>>>1,c[2]=(L&1)<<7,c[2]|=8,c[3]=0),{config:c,samplingRate:b,channelCount:m,codec:"mp4a.40."+p,originalCodec:"mp4a.40."+_}},i.prototype._parseMP3AudioData=function(e,s,o,t){if(o<4){x.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var c=new Uint8Array(e,s,o),p=null;if(t){if(c[0]!==255)return;var _=c[1]>>>3&3,E=(c[1]&6)>>1,L=(c[2]&240)>>>4,b=(c[2]&12)>>>2,m=c[3]>>>6&3,w=m!==3?2:1,S=0,P=0,I="mp3";switch(_){case 0:S=this._mpegAudioV25SampleRateTable[b];break;case 2:S=this._mpegAudioV20SampleRateTable[b];break;case 3:S=this._mpegAudioV10SampleRateTable[b];break}switch(E){case 1:L<this._mpegAudioL3BitRateTable.length&&(P=this._mpegAudioL3BitRateTable[L]);break;case 2:L<this._mpegAudioL2BitRateTable.length&&(P=this._mpegAudioL2BitRateTable[L]);break;case 3:L<this._mpegAudioL1BitRateTable.length&&(P=this._mpegAudioL1BitRateTable[L]);break}p={bitRate:P,samplingRate:S,channelCount:w,codec:I,originalCodec:I}}else p=c;return p},i.prototype._parseVideoData=function(e,s,o,t,c){if(o<=1){x.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var p=new Uint8Array(e,s,o)[0],_=(p&240)>>>4,E=p&15;if(E!==7){this._onError(a.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+E);return}this._parseAVCVideoPacket(e,s+1,o-1,t,c,_)}},i.prototype._parseAVCVideoPacket=function(e,s,o,t,c,p){if(o<4){x.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var _=this._littleEndian,E=new DataView(e,s,o),L=E.getUint8(0),b=E.getUint32(0,!_)&16777215,m=b<<8>>8;if(L===0)this._parseAVCDecoderConfigurationRecord(e,s+4,o-4);else if(L===1)this._parseAVCVideoData(e,s+4,o-4,t,c,p,m);else if(L!==2){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid video packet type "+L);return}},i.prototype._parseAVCDecoderConfigurationRecord=function(e,s,o){if(o<7){x.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var t=this._videoMetadata,c=this._videoTrack,p=this._littleEndian,_=new DataView(e,s,o);t?typeof t.avcc<"u"&&x.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),t=this._videoMetadata={},t.type="video",t.id=c.id,t.timescale=this._timescale,t.duration=this._duration);var E=_.getUint8(0),L=_.getUint8(1);if(_.getUint8(2),_.getUint8(3),E!==1||L===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(_.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(a.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var b=_.getUint8(5)&31;if(b===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else b>1&&x.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+b);for(var m=6,w=0;w<b;w++){var S=_.getUint16(m,!p);if(m+=2,S!==0){var P=new Uint8Array(e,s+m,S);m+=S;var I=l.default.parseSPS(P);if(w===0){t.codecWidth=I.codec_size.width,t.codecHeight=I.codec_size.height,t.presentWidth=I.present_size.width,t.presentHeight=I.present_size.height,t.profile=I.profile_string,t.level=I.level_string,t.bitDepth=I.bit_depth,t.chromaFormat=I.chroma_format,t.sarRatio=I.sar_ratio,t.frameRate=I.frame_rate,(I.frame_rate.fixed===!1||I.frame_rate.fps_num===0||I.frame_rate.fps_den===0)&&(t.frameRate=this._referenceFrameRate);var U=t.frameRate.fps_den,B=t.frameRate.fps_num;t.refSampleDuration=t.timescale*(U/B);for(var W=P.subarray(1,4),C="avc1.",k=0;k<3;k++){var G=W[k].toString(16);G.length<2&&(G="0"+G),C+=G}t.codec=C;var M=this._mediaInfo;M.width=t.codecWidth,M.height=t.codecHeight,M.fps=t.frameRate.fps,M.profile=t.profile,M.level=t.level,M.refFrames=I.ref_frames,M.chromaFormat=I.chroma_format_string,M.sarNum=t.sarRatio.width,M.sarDen=t.sarRatio.height,M.videoCodec=C,M.hasAudio?M.audioCodec!=null&&(M.mimeType='video/x-flv; codecs="'+M.videoCodec+","+M.audioCodec+'"'):M.mimeType='video/x-flv; codecs="'+M.videoCodec+'"',M.isComplete()&&this._onMediaInfo(M)}}}var Y=_.getUint8(m);if(Y===0){this._onError(a.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else Y>1&&x.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+Y);m++;for(var w=0;w<Y;w++){var S=_.getUint16(m,!p);m+=2,S!==0&&(m+=S)}t.avcc=new Uint8Array(o),t.avcc.set(new Uint8Array(e,s,o),0),x.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",t)},i.prototype._parseAVCVideoData=function(e,s,o,t,c,p,_){for(var E=this._littleEndian,L=new DataView(e,s,o),b=[],m=0,w=0,S=this._naluLengthSize,P=this._timestampBase+t,I=p===1;w<o;){if(w+4>=o){x.default.w(this.TAG,"Malformed Nalu near timestamp "+P+", offset = "+w+", dataSize = "+o);break}var U=L.getUint32(w,!E);if(S===3&&(U>>>=8),U>o-S){x.default.w(this.TAG,"Malformed Nalus near timestamp "+P+", NaluSize > DataSize!");return}var B=L.getUint8(w+S)&31;B===5&&(I=!0);var W=new Uint8Array(e,s+w,S+U),C={type:B,data:W};b.push(C),m+=W.byteLength,w+=S+U}if(b.length){var k=this._videoTrack,G={units:b,length:m,isKeyframe:I,dts:P,cts:_,pts:P+_};I&&(G.fileposition=c),k.samples.push(G),k.length+=m}},i}();g.default=u},"./src/demux/sps-parser.js":function(v,g,h){h.r(g);var x=h("./src/demux/exp-golomb.js"),f=function(){function l(){}return l._ebsp2rbsp=function(a){for(var d=a,r=d.byteLength,n=new Uint8Array(r),u=0,i=0;i<r;i++)i>=2&&d[i]===3&&d[i-1]===0&&d[i-2]===0||(n[u]=d[i],u++);return new Uint8Array(n.buffer,0,u)},l.parseSPS=function(a){var d=l._ebsp2rbsp(a),r=new x.default(d);r.readByte();var n=r.readByte();r.readByte();var u=r.readByte();r.readUEG();var i=l.getProfileString(n),e=l.getLevelString(u),s=1,o=420,t=[0,420,422,444],c=8;if((n===100||n===110||n===122||n===244||n===44||n===83||n===86||n===118||n===128||n===138||n===144)&&(s=r.readUEG(),s===3&&r.readBits(1),s<=3&&(o=t[s]),c=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var p=s!==3?8:12,_=0;_<p;_++)r.readBool()&&(_<6?l._skipScalingList(r,16):l._skipScalingList(r,64));r.readUEG();var E=r.readUEG();if(E===0)r.readUEG();else if(E===1){r.readBits(1),r.readSEG(),r.readSEG();for(var L=r.readUEG(),_=0;_<L;_++)r.readSEG()}var b=r.readUEG();r.readBits(1);var m=r.readUEG(),w=r.readUEG(),S=r.readBits(1);S===0&&r.readBits(1),r.readBits(1);var P=0,I=0,U=0,B=0,W=r.readBool();W&&(P=r.readUEG(),I=r.readUEG(),U=r.readUEG(),B=r.readUEG());var C=1,k=1,G=0,M=!0,Y=0,X=0,J=r.readBool();if(J){if(r.readBool()){var K=r.readByte(),$=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],re=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];K>0&&K<16?(C=$[K-1],k=re[K-1]):K===255&&(C=r.readByte()<<8|r.readByte(),k=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var ee=r.readBits(32),te=r.readBits(32);M=r.readBool(),Y=te,X=ee*2,G=Y/X}}var q=1;(C!==1||k!==1)&&(q=C/k);var Z=0,se=0;if(s===0)Z=1,se=2-S;else{var le=s===3?1:2,fe=s===1?2:1;Z=le,se=fe*(2-S)}var ce=(m+1)*16,ge=(2-S)*((w+1)*16);ce-=(P+I)*Z,ge-=(U+B)*se;var _e=Math.ceil(ce*q);return r.destroy(),r=null,{profile_string:i,level_string:e,bit_depth:c,ref_frames:b,chroma_format:o,chroma_format_string:l.getChromaFormatString(o),frame_rate:{fixed:M,fps:G,fps_den:X,fps_num:Y},sar_ratio:{width:C,height:k},codec_size:{width:ce,height:ge},present_size:{width:_e,height:ge}}},l._skipScalingList=function(a,d){for(var r=8,n=8,u=0,i=0;i<d;i++)n!==0&&(u=a.readSEG(),n=(r+u+256)%256),r=n===0?r:n},l.getProfileString=function(a){switch(a){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},l.getLevelString=function(a){return(a/10).toFixed(1)},l.getChromaFormatString=function(a){switch(a){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},l}();g.default=f},"./src/flv.js":function(v,g,h){h.r(g);var x=h("./src/utils/polyfill.js"),f=h("./src/core/features.js"),l=h("./src/io/loader.js"),a=h("./src/player/flv-player.js"),d=h("./src/player/native-player.js"),r=h("./src/player/player-events.js"),n=h("./src/player/player-errors.js"),u=h("./src/utils/logging-control.js"),i=h("./src/utils/exception.js");x.default.install();function e(c,p){var _=c;if(_==null||typeof _!="object")throw new i.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!_.hasOwnProperty("type"))throw new i.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(_.type){case"flv":return new a.default(_,p);default:return new d.default(_,p)}}function s(){return f.default.supportMSEH264Playback()}function o(){return f.default.getFeatureList()}var t={};t.createPlayer=e,t.isSupported=s,t.getFeatureList=o,t.BaseLoader=l.BaseLoader,t.LoaderStatus=l.LoaderStatus,t.LoaderErrors=l.LoaderErrors,t.Events=r.default,t.ErrorTypes=n.ErrorTypes,t.ErrorDetails=n.ErrorDetails,t.FlvPlayer=a.default,t.NativePlayer=d.default,t.LoggingControl=u.default,Object.defineProperty(t,"version",{enumerable:!0,get:function(){return"1.6.2"}}),g.default=t},"./src/index.js":function(v,g,h){v.exports=h("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(v,g,h){h.r(g);var x=h("./src/utils/browser.js"),f=h("./src/io/loader.js"),l=h("./src/utils/exception.js"),a=function(){var r=function(n,u){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])},r(n,u)};return function(n,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");r(n,u);function i(){this.constructor=n}n.prototype=u===null?Object.create(u):(i.prototype=u.prototype,new i)}}(),d=function(r){a(n,r);function n(u,i){var e=r.call(this,"fetch-stream-loader")||this;return e.TAG="FetchStreamLoader",e._seekHandler=u,e._config=i,e._needStash=!0,e._requestAbort=!1,e._contentLength=null,e._receivedLength=0,e}return n.isSupported=function(){try{var u=x.default.msedge&&x.default.version.minor>=15048,i=x.default.msedge?u:!0;return self.fetch&&self.ReadableStream&&i}catch{return!1}},n.prototype.destroy=function(){this.isWorking()&&this.abort(),r.prototype.destroy.call(this)},n.prototype.open=function(u,i){var e=this;this._dataSource=u,this._range=i;var s=u.url;this._config.reuseRedirectedURL&&u.redirectedURL!=null&&(s=u.redirectedURL);var o=this._seekHandler.getConfig(s,i),t=new self.Headers;if(typeof o.headers=="object"){var c=o.headers;for(var p in c)c.hasOwnProperty(p)&&t.append(p,c[p])}var _={method:"GET",headers:t,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var p in this._config.headers)t.append(p,this._config.headers[p]);u.cors===!1&&(_.mode="same-origin"),u.withCredentials&&(_.credentials="include"),u.referrerPolicy&&(_.referrerPolicy=u.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,_.signal=this._abortController.signal),this._status=f.LoaderStatus.kConnecting,self.fetch(o.url,_).then(function(E){if(e._requestAbort){e._status=f.LoaderStatus.kIdle,E.body.cancel();return}if(E.ok&&E.status>=200&&E.status<=299){if(E.url!==o.url&&e._onURLRedirect){var L=e._seekHandler.removeURLParameters(E.url);e._onURLRedirect(L)}var b=E.headers.get("Content-Length");return b!=null&&(e._contentLength=parseInt(b),e._contentLength!==0&&e._onContentLengthKnown&&e._onContentLengthKnown(e._contentLength)),e._pump.call(e,E.body.getReader())}else if(e._status=f.LoaderStatus.kError,e._onError)e._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:E.status,msg:E.statusText});else throw new l.RuntimeException("FetchStreamLoader: Http code invalid, "+E.status+" "+E.statusText)}).catch(function(E){if(!(e._abortController&&e._abortController.signal.aborted))if(e._status=f.LoaderStatus.kError,e._onError)e._onError(f.LoaderErrors.EXCEPTION,{code:-1,msg:E.message});else throw E})},n.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==f.LoaderStatus.kBuffering||!x.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},n.prototype._pump=function(u){var i=this;return u.read().then(function(e){if(e.done)if(i._contentLength!==null&&i._receivedLength<i._contentLength){i._status=f.LoaderStatus.kError;var s=f.LoaderErrors.EARLY_EOF,o={code:-1,msg:"Fetch stream meet Early-EOF"};if(i._onError)i._onError(s,o);else throw new l.RuntimeException(o.msg)}else i._status=f.LoaderStatus.kComplete,i._onComplete&&i._onComplete(i._range.from,i._range.from+i._receivedLength-1);else{if(i._abortController&&i._abortController.signal.aborted){i._status=f.LoaderStatus.kComplete;return}else if(i._requestAbort===!0)return i._status=f.LoaderStatus.kComplete,u.cancel();i._status=f.LoaderStatus.kBuffering;var t=e.value.buffer,c=i._range.from+i._receivedLength;i._receivedLength+=t.byteLength,i._onDataArrival&&i._onDataArrival(t,c,i._receivedLength),i._pump(u)}}).catch(function(e){if(i._abortController&&i._abortController.signal.aborted){i._status=f.LoaderStatus.kComplete;return}if(!(e.code===11&&x.default.msedge)){i._status=f.LoaderStatus.kError;var s=0,o=null;if((e.code===19||e.message==="network error")&&(i._contentLength===null||i._contentLength!==null&&i._receivedLength<i._contentLength)?(s=f.LoaderErrors.EARLY_EOF,o={code:e.code,msg:"Fetch stream meet Early-EOF"}):(s=f.LoaderErrors.EXCEPTION,o={code:e.code,msg:e.message}),i._onError)i._onError(s,o);else throw new l.RuntimeException(o.msg)}})},n}(f.BaseLoader);g.default=d},"./src/io/io-controller.js":function(v,g,h){h.r(g);var x=h("./src/utils/logger.js"),f=h("./src/io/speed-sampler.js"),l=h("./src/io/loader.js"),a=h("./src/io/fetch-stream-loader.js"),d=h("./src/io/xhr-moz-chunked-loader.js"),r=h("./src/io/xhr-range-loader.js"),n=h("./src/io/websocket-loader.js"),u=h("./src/io/range-seek-handler.js"),i=h("./src/io/param-seek-handler.js"),e=h("./src/utils/exception.js"),s=function(){function o(t,c,p){this.TAG="IOController",this._config=c,this._extraData=p,this._stashInitialSize=1024*384,c.stashInitialSize!=null&&c.stashInitialSize>0&&(this._stashInitialSize=c.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,c.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=t,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(t.url),this._refTotalLength=t.filesize?t.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new f.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return o.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},o.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},o.prototype.isPaused=function(){return this._paused},Object.defineProperty(o.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"extraData",{get:function(){return this._extraData},set:function(t){this._extraData=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(t){this._onDataArrival=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(t){this._onSeeked=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onComplete",{get:function(){return this._onComplete},set:function(t){this._onComplete=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(t){this._onRedirect=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(t){this._onRecoveredEarlyEof=t},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentSpeed",{get:function(){return this._loaderClass===r.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),o.prototype._selectSeekHandler=function(){var t=this._config;if(t.seekType==="range")this._seekHandler=new u.default(this._config.rangeLoadZeroStart);else if(t.seekType==="param"){var c=t.seekParamStart||"bstart",p=t.seekParamEnd||"bend";this._seekHandler=new i.default(c,p)}else if(t.seekType==="custom"){if(typeof t.customSeekHandler!="function")throw new e.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new t.customSeekHandler}else throw new e.InvalidArgumentException("Invalid seekType in config: "+t.seekType)},o.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=n.default;else if(a.default.isSupported())this._loaderClass=a.default;else if(d.default.isSupported())this._loaderClass=d.default;else if(r.default.isSupported())this._loaderClass=r.default;else throw new e.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},o.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},o.prototype.open=function(t){this._currentRange={from:0,to:-1},t&&(this._currentRange.from=t),this._speedSampler.reset(),t||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},o.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},o.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},o.prototype.resume=function(){if(this._paused){this._paused=!1;var t=this._resumeFrom;this._resumeFrom=0,this._internalSeek(t,!0)}},o.prototype.seek=function(t){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(t,!0)},o.prototype._internalSeek=function(t,c){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(c),this._loader.destroy(),this._loader=null;var p={from:t,to:-1};this._currentRange={from:p.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,p),this._onSeeked&&this._onSeeked()},o.prototype.updateUrl=function(t){if(!t||typeof t!="string"||t.length===0)throw new e.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=t},o.prototype._expandBuffer=function(t){for(var c=this._stashSize;c+1024*1024*1<t;)c*=2;if(c+=1024*1024*1,c!==this._bufferSize){var p=new ArrayBuffer(c);if(this._stashUsed>0){var _=new Uint8Array(this._stashBuffer,0,this._stashUsed),E=new Uint8Array(p,0,c);E.set(_,0)}this._stashBuffer=p,this._bufferSize=c}},o.prototype._normalizeSpeed=function(t){var c=this._speedNormalizeList,p=c.length-1,_=0,E=0,L=p;if(t<c[0])return c[0];for(;E<=L;){if(_=E+Math.floor((L-E)/2),_===p||t>=c[_]&&t<c[_+1])return c[_];c[_]<t?E=_+1:L=_-1}},o.prototype._adjustStashSize=function(t){var c=0;this._config.isLive||t<512?c=t:t>=512&&t<=1024?c=Math.floor(t*1.5):c=t*2,c>8192&&(c=8192);var p=c*1024+1024*1024*1;this._bufferSize<p&&this._expandBuffer(p),this._stashSize=c*1024},o.prototype._dispatchChunks=function(t,c){return this._currentRange.to=c+t.byteLength-1,this._onDataArrival(t,c)},o.prototype._onURLRedirect=function(t){this._redirectedURL=t,this._onRedirect&&this._onRedirect(t)},o.prototype._onContentLengthKnown=function(t){t&&this._fullRequestFlag&&(this._totalLength=t,this._fullRequestFlag=!1)},o.prototype._onLoaderChunkArrival=function(t,c,p){if(!this._onDataArrival)throw new e.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(t.byteLength);var _=this._speedSampler.lastSecondKBps;if(_!==0){var E=this._normalizeSpeed(_);this._speedNormalized!==E&&(this._speedNormalized=E,this._adjustStashSize(E))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=c),this._stashUsed+t.byteLength<=this._stashSize){var m=new Uint8Array(this._stashBuffer,0,this._stashSize);m.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength}else{var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var S=this._stashBuffer.slice(0,this._stashUsed),L=this._dispatchChunks(S,this._stashByteStart);if(L<S.byteLength){if(L>0){var w=new Uint8Array(S,L);m.set(w,0),this._stashUsed=w.byteLength,this._stashByteStart+=L}}else this._stashUsed=0,this._stashByteStart+=L;this._stashUsed+t.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+t.byteLength),m=new Uint8Array(this._stashBuffer,0,this._bufferSize)),m.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength}else{var L=this._dispatchChunks(t,c);if(L<t.byteLength){var b=t.byteLength-L;b>this._bufferSize&&(this._expandBuffer(b),m=new Uint8Array(this._stashBuffer,0,this._bufferSize)),m.set(new Uint8Array(t,L),0),this._stashUsed+=b,this._stashByteStart=c+L}}}else if(this._stashUsed===0){var L=this._dispatchChunks(t,c);if(L<t.byteLength){var b=t.byteLength-L;b>this._bufferSize&&this._expandBuffer(b);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(t,L),0),this._stashUsed+=b,this._stashByteStart=c+L}}else{this._stashUsed+t.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+t.byteLength);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(t),this._stashUsed),this._stashUsed+=t.byteLength;var L=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(L<this._stashUsed&&L>0){var w=new Uint8Array(this._stashBuffer,L);m.set(w,0)}this._stashUsed-=L,this._stashByteStart+=L}}},o.prototype._flushStashBuffer=function(t){if(this._stashUsed>0){var c=this._stashBuffer.slice(0,this._stashUsed),p=this._dispatchChunks(c,this._stashByteStart),_=c.byteLength-p;if(p<c.byteLength)if(t)x.default.w(this.TAG,_+" bytes unconsumed data remain when flush buffer, dropped");else{if(p>0){var E=new Uint8Array(this._stashBuffer,0,this._bufferSize),L=new Uint8Array(c,p);E.set(L,0),this._stashUsed=L.byteLength,this._stashByteStart+=p}return 0}return this._stashUsed=0,this._stashByteStart=0,_}return 0},o.prototype._onLoaderComplete=function(t,c){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},o.prototype._onLoaderError=function(t,c){switch(x.default.e(this.TAG,"Loader error, code = "+c.code+", msg = "+c.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,t=l.LoaderErrors.UNRECOVERABLE_EARLY_EOF),t){case l.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var p=this._currentRange.to+1;p<this._totalLength&&(x.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(p,!1));return}t=l.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case l.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case l.LoaderErrors.CONNECTING_TIMEOUT:case l.LoaderErrors.HTTP_STATUS_CODE_INVALID:case l.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(t,c);else throw new e.RuntimeException("IOException: "+c.msg)},o}();g.default=s},"./src/io/loader.js":function(v,g,h){h.r(g),h.d(g,{LoaderStatus:function(){return f},LoaderErrors:function(){return l},BaseLoader:function(){return a}});var x=h("./src/utils/exception.js"),f={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},l={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},a=function(){function d(r){this._type=r||"undefined",this._status=f.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return d.prototype.destroy=function(){this._status=f.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},d.prototype.isWorking=function(){return this._status===f.kConnecting||this._status===f.kBuffering},Object.defineProperty(d.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(r){this._onContentLengthKnown=r},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(r){this._onURLRedirect=r},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(r){this._onDataArrival=r},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onError",{get:function(){return this._onError},set:function(r){this._onError=r},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"onComplete",{get:function(){return this._onComplete},set:function(r){this._onComplete=r},enumerable:!1,configurable:!0}),d.prototype.open=function(r,n){throw new x.NotImplementedException("Unimplemented abstract function!")},d.prototype.abort=function(){throw new x.NotImplementedException("Unimplemented abstract function!")},d}()},"./src/io/param-seek-handler.js":function(v,g,h){h.r(g);var x=function(){function f(l,a){this._startName=l,this._endName=a}return f.prototype.getConfig=function(l,a){var d=l;if(a.from!==0||a.to!==-1){var r=!0;d.indexOf("?")===-1&&(d+="?",r=!1),r&&(d+="&"),d+=this._startName+"="+a.from.toString(),a.to!==-1&&(d+="&"+this._endName+"="+a.to.toString())}return{url:d,headers:{}}},f.prototype.removeURLParameters=function(l){var a=l.split("?")[0],d=void 0,r=l.indexOf("?");r!==-1&&(d=l.substring(r+1));var n="";if(d!=null&&d.length>0)for(var u=d.split("&"),i=0;i<u.length;i++){var e=u[i].split("="),s=i>0;e[0]!==this._startName&&e[0]!==this._endName&&(s&&(n+="&"),n+=u[i])}return n.length===0?a:a+"?"+n},f}();g.default=x},"./src/io/range-seek-handler.js":function(v,g,h){h.r(g);var x=function(){function f(l){this._zeroStart=l||!1}return f.prototype.getConfig=function(l,a){var d={};if(a.from!==0||a.to!==-1){var r=void 0;a.to!==-1?r="bytes="+a.from.toString()+"-"+a.to.toString():r="bytes="+a.from.toString()+"-",d.Range=r}else this._zeroStart&&(d.Range="bytes=0-");return{url:l,headers:d}},f.prototype.removeURLParameters=function(l){return l},f}();g.default=x},"./src/io/speed-sampler.js":function(v,g,h){h.r(g);var x=function(){function f(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return f.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},f.prototype.addBytes=function(l){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=l,this._totalBytes+=l):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=l,this._totalBytes+=l):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=l,this._totalBytes+=l,this._lastCheckpoint=this._now())},Object.defineProperty(f.prototype,"currentKBps",{get:function(){this.addBytes(0);var l=(this._now()-this._lastCheckpoint)/1e3;return l==0&&(l=1),this._intervalBytes/l/1024},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"averageKBps",{get:function(){var l=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/l/1024},enumerable:!1,configurable:!0}),f}();g.default=x},"./src/io/websocket-loader.js":function(v,g,h){h.r(g);var x=h("./src/io/loader.js"),f=h("./src/utils/exception.js"),l=function(){var d=function(r,n){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,i){u.__proto__=i}||function(u,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(u[e]=i[e])},d(r,n)};return function(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");d(r,n);function u(){this.constructor=r}r.prototype=n===null?Object.create(n):(u.prototype=n.prototype,new u)}}(),a=function(d){l(r,d);function r(){var n=d.call(this,"websocket-loader")||this;return n.TAG="WebSocketLoader",n._needStash=!0,n._ws=null,n._requestAbort=!1,n._receivedLength=0,n}return r.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},r.prototype.destroy=function(){this._ws&&this.abort(),d.prototype.destroy.call(this)},r.prototype.open=function(n){try{var u=this._ws=new self.WebSocket(n.url);u.binaryType="arraybuffer",u.onopen=this._onWebSocketOpen.bind(this),u.onclose=this._onWebSocketClose.bind(this),u.onmessage=this._onWebSocketMessage.bind(this),u.onerror=this._onWebSocketError.bind(this),this._status=x.LoaderStatus.kConnecting}catch(e){this._status=x.LoaderStatus.kError;var i={code:e.code,msg:e.message};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,i);else throw new f.RuntimeException(i.msg)}},r.prototype.abort=function(){var n=this._ws;n&&(n.readyState===0||n.readyState===1)&&(this._requestAbort=!0,n.close()),this._ws=null,this._status=x.LoaderStatus.kComplete},r.prototype._onWebSocketOpen=function(n){this._status=x.LoaderStatus.kBuffering},r.prototype._onWebSocketClose=function(n){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=x.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},r.prototype._onWebSocketMessage=function(n){var u=this;if(n.data instanceof ArrayBuffer)this._dispatchArrayBuffer(n.data);else if(n.data instanceof Blob){var i=new FileReader;i.onload=function(){u._dispatchArrayBuffer(i.result)},i.readAsArrayBuffer(n.data)}else{this._status=x.LoaderStatus.kError;var e={code:-1,msg:"Unsupported WebSocket message type: "+n.data.constructor.name};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,e);else throw new f.RuntimeException(e.msg)}},r.prototype._dispatchArrayBuffer=function(n){var u=n,i=this._receivedLength;this._receivedLength+=u.byteLength,this._onDataArrival&&this._onDataArrival(u,i,this._receivedLength)},r.prototype._onWebSocketError=function(n){this._status=x.LoaderStatus.kError;var u={code:n.code,msg:n.message};if(this._onError)this._onError(x.LoaderErrors.EXCEPTION,u);else throw new f.RuntimeException(u.msg)},r}(x.BaseLoader);g.default=a},"./src/io/xhr-moz-chunked-loader.js":function(v,g,h){h.r(g);var x=h("./src/utils/logger.js"),f=h("./src/io/loader.js"),l=h("./src/utils/exception.js"),a=function(){var r=function(n,u){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])},r(n,u)};return function(n,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");r(n,u);function i(){this.constructor=n}n.prototype=u===null?Object.create(u):(i.prototype=u.prototype,new i)}}(),d=function(r){a(n,r);function n(u,i){var e=r.call(this,"xhr-moz-chunked-loader")||this;return e.TAG="MozChunkedLoader",e._seekHandler=u,e._config=i,e._needStash=!0,e._xhr=null,e._requestAbort=!1,e._contentLength=null,e._receivedLength=0,e}return n.isSupported=function(){try{var u=new XMLHttpRequest;return u.open("GET","https://example.com",!0),u.responseType="moz-chunked-arraybuffer",u.responseType==="moz-chunked-arraybuffer"}catch(i){return x.default.w("MozChunkedLoader",i.message),!1}},n.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),r.prototype.destroy.call(this)},n.prototype.open=function(u,i){this._dataSource=u,this._range=i;var e=u.url;this._config.reuseRedirectedURL&&u.redirectedURL!=null&&(e=u.redirectedURL);var s=this._seekHandler.getConfig(e,i);this._requestURL=s.url;var o=this._xhr=new XMLHttpRequest;if(o.open("GET",s.url,!0),o.responseType="moz-chunked-arraybuffer",o.onreadystatechange=this._onReadyStateChange.bind(this),o.onprogress=this._onProgress.bind(this),o.onloadend=this._onLoadEnd.bind(this),o.onerror=this._onXhrError.bind(this),u.withCredentials&&(o.withCredentials=!0),typeof s.headers=="object"){var t=s.headers;for(var c in t)t.hasOwnProperty(c)&&o.setRequestHeader(c,t[c])}if(typeof this._config.headers=="object"){var t=this._config.headers;for(var c in t)t.hasOwnProperty(c)&&o.setRequestHeader(c,t[c])}this._status=f.LoaderStatus.kConnecting,o.send()},n.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=f.LoaderStatus.kComplete},n.prototype._onReadyStateChange=function(u){var i=u.target;if(i.readyState===2){if(i.responseURL!=null&&i.responseURL!==this._requestURL&&this._onURLRedirect){var e=this._seekHandler.removeURLParameters(i.responseURL);this._onURLRedirect(e)}if(i.status!==0&&(i.status<200||i.status>299))if(this._status=f.LoaderStatus.kError,this._onError)this._onError(f.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:i.status,msg:i.statusText});else throw new l.RuntimeException("MozChunkedLoader: Http code invalid, "+i.status+" "+i.statusText);else this._status=f.LoaderStatus.kBuffering}},n.prototype._onProgress=function(u){if(this._status!==f.LoaderStatus.kError){this._contentLength===null&&u.total!==null&&u.total!==0&&(this._contentLength=u.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var i=u.target.response,e=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength,this._onDataArrival&&this._onDataArrival(i,e,this._receivedLength)}},n.prototype._onLoadEnd=function(u){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===f.LoaderStatus.kError)return;this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},n.prototype._onXhrError=function(u){this._status=f.LoaderStatus.kError;var i=0,e=null;if(this._contentLength&&u.loaded<this._contentLength?(i=f.LoaderErrors.EARLY_EOF,e={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(i=f.LoaderErrors.EXCEPTION,e={code:-1,msg:u.constructor.name+" "+u.type}),this._onError)this._onError(i,e);else throw new l.RuntimeException(e.msg)},n}(f.BaseLoader);g.default=d},"./src/io/xhr-range-loader.js":function(v,g,h){h.r(g);var x=h("./src/utils/logger.js"),f=h("./src/io/speed-sampler.js"),l=h("./src/io/loader.js"),a=h("./src/utils/exception.js"),d=function(){var n=function(u,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,s){e.__proto__=s}||function(e,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o])},n(u,i)};return function(u,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(u,i);function e(){this.constructor=u}u.prototype=i===null?Object.create(i):(e.prototype=i.prototype,new e)}}(),r=function(n){d(u,n);function u(i,e){var s=n.call(this,"xhr-range-loader")||this;return s.TAG="RangeLoader",s._seekHandler=i,s._config=e,s._needStash=!1,s._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],s._currentChunkSizeKB=384,s._currentSpeedNormalized=0,s._zeroSpeedChunkCount=0,s._xhr=null,s._speedSampler=new f.default,s._requestAbort=!1,s._waitForTotalLength=!1,s._totalLengthReceived=!1,s._currentRequestURL=null,s._currentRedirectedURL=null,s._currentRequestRange=null,s._totalLength=null,s._contentLength=null,s._receivedLength=0,s._lastTimeLoaded=0,s}return u.isSupported=function(){try{var i=new XMLHttpRequest;return i.open("GET","https://example.com",!0),i.responseType="arraybuffer",i.responseType==="arraybuffer"}catch(e){return x.default.w("RangeLoader",e.message),!1}},u.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),n.prototype.destroy.call(this)},Object.defineProperty(u.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),u.prototype.open=function(i,e){this._dataSource=i,this._range=e,this._status=l.LoaderStatus.kConnecting;var s=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(s=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!s?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},u.prototype._openSubRange=function(){var i=this._currentChunkSizeKB*1024,e=this._range.from+this._receivedLength,s=e+i;this._contentLength!=null&&s-this._range.from>=this._contentLength&&(s=this._range.from+this._contentLength-1),this._currentRequestRange={from:e,to:s},this._internalOpen(this._dataSource,this._currentRequestRange)},u.prototype._internalOpen=function(i,e){this._lastTimeLoaded=0;var s=i.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?s=this._currentRedirectedURL:i.redirectedURL!=null&&(s=i.redirectedURL));var o=this._seekHandler.getConfig(s,e);this._currentRequestURL=o.url;var t=this._xhr=new XMLHttpRequest;if(t.open("GET",o.url,!0),t.responseType="arraybuffer",t.onreadystatechange=this._onReadyStateChange.bind(this),t.onprogress=this._onProgress.bind(this),t.onload=this._onLoad.bind(this),t.onerror=this._onXhrError.bind(this),i.withCredentials&&(t.withCredentials=!0),typeof o.headers=="object"){var c=o.headers;for(var p in c)c.hasOwnProperty(p)&&t.setRequestHeader(p,c[p])}if(typeof this._config.headers=="object"){var c=this._config.headers;for(var p in c)c.hasOwnProperty(p)&&t.setRequestHeader(p,c[p])}t.send()},u.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=l.LoaderStatus.kComplete},u.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},u.prototype._onReadyStateChange=function(i){var e=i.target;if(e.readyState===2){if(e.responseURL!=null){var s=this._seekHandler.removeURLParameters(e.responseURL);e.responseURL!==this._currentRequestURL&&s!==this._currentRedirectedURL&&(this._currentRedirectedURL=s,this._onURLRedirect&&this._onURLRedirect(s))}if(e.status>=200&&e.status<=299){if(this._waitForTotalLength)return;this._status=l.LoaderStatus.kBuffering}else if(this._status=l.LoaderStatus.kError,this._onError)this._onError(l.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText});else throw new a.RuntimeException("RangeLoader: Http code invalid, "+e.status+" "+e.statusText)}},u.prototype._onProgress=function(i){if(this._status!==l.LoaderStatus.kError){if(this._contentLength===null){var e=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,e=!0;var s=i.total;this._internalAbort(),s!=null&s!==0&&(this._totalLength=s)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,e){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var o=i.loaded-this._lastTimeLoaded;this._lastTimeLoaded=i.loaded,this._speedSampler.addBytes(o)}},u.prototype._normalizeSpeed=function(i){var e=this._chunkSizeKBList,s=e.length-1,o=0,t=0,c=s;if(i<e[0])return e[0];for(;t<=c;){if(o=t+Math.floor((c-t)/2),o===s||i>=e[o]&&i<e[o+1])return e[o];e[o]<i?t=o+1:c=o-1}},u.prototype._onLoad=function(i){if(this._status!==l.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var e=this._speedSampler.lastSecondKBps;if(e===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(e=this._speedSampler.currentKBps)),e!==0){var s=this._normalizeSpeed(e);this._currentSpeedNormalized!==s&&(this._currentSpeedNormalized=s,this._currentChunkSizeKB=s)}var o=i.target.response,t=this._range.from+this._receivedLength;this._receivedLength+=o.byteLength;var c=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():c=!0,this._onDataArrival&&this._onDataArrival(o,t,this._receivedLength),c&&(this._status=l.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},u.prototype._onXhrError=function(i){this._status=l.LoaderStatus.kError;var e=0,s=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(e=l.LoaderErrors.EARLY_EOF,s={code:-1,msg:"RangeLoader meet Early-Eof"}):(e=l.LoaderErrors.EXCEPTION,s={code:-1,msg:i.constructor.name+" "+i.type}),this._onError)this._onError(e,s);else throw new a.RuntimeException(s.msg)},u}(l.BaseLoader);g.default=r},"./src/player/flv-player.js":function(v,g,h){h.r(g);var x=h("./node_modules/events/events.js"),f=h.n(x),l=h("./src/utils/logger.js"),a=h("./src/utils/browser.js"),d=h("./src/player/player-events.js"),r=h("./src/core/transmuxer.js"),n=h("./src/core/transmuxing-events.js"),u=h("./src/core/mse-controller.js"),i=h("./src/core/mse-events.js"),e=h("./src/player/player-errors.js"),s=h("./src/config.js"),o=h("./src/utils/exception.js"),t=function(){function c(p,_){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(f()),this._config=(0,s.createDefaultConfig)(),typeof _=="object"&&Object.assign(this._config,_),p.type.toLowerCase()!=="flv")throw new o.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");p.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=p,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var E=a.default.chrome&&(a.default.version.major<50||a.default.version.major===50&&a.default.version.build<2661);this._alwaysSeekKeyframe=!!(E||a.default.msedge||a.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return c.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},c.prototype.on=function(p,_){var E=this;p===d.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){E._emitter.emit(d.default.MEDIA_INFO,E.mediaInfo)}):p===d.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){E._emitter.emit(d.default.STATISTICS_INFO,E.statisticsInfo)}),this._emitter.addListener(p,_)},c.prototype.off=function(p,_){this._emitter.removeListener(p,_)},c.prototype.attachMediaElement=function(p){var _=this;if(this._mediaElement=p,p.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),p.addEventListener("seeking",this.e.onvSeeking),p.addEventListener("canplay",this.e.onvCanPlay),p.addEventListener("stalled",this.e.onvStalled),p.addEventListener("progress",this.e.onvProgress),this._msectl=new u.default(this._config),this._msectl.on(i.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(i.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(i.default.SOURCE_OPEN,function(){_._mseSourceOpened=!0,_._hasPendingLoad&&(_._hasPendingLoad=!1,_.load())}),this._msectl.on(i.default.ERROR,function(E){_._emitter.emit(d.default.ERROR,e.ErrorTypes.MEDIA_ERROR,e.ErrorDetails.MEDIA_MSE_ERROR,E)}),this._msectl.attachMediaElement(p),this._pendingSeekTime!=null)try{p.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},c.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},c.prototype.load=function(){var p=this;if(!this._mediaElement)throw new o.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new o.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new r.default(this._mediaDataSource,this._config),this._transmuxer.on(n.default.INIT_SEGMENT,function(_,E){p._msectl.appendInitSegment(E)}),this._transmuxer.on(n.default.MEDIA_SEGMENT,function(_,E){if(p._msectl.appendMediaSegment(E),p._config.lazyLoad&&!p._config.isLive){var L=p._mediaElement.currentTime;E.info.endDts>=(L+p._config.lazyLoadMaxDuration)*1e3&&p._progressChecker==null&&(l.default.v(p.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),p._suspendTransmuxer())}}),this._transmuxer.on(n.default.LOADING_COMPLETE,function(){p._msectl.endOfStream(),p._emitter.emit(d.default.LOADING_COMPLETE)}),this._transmuxer.on(n.default.RECOVERED_EARLY_EOF,function(){p._emitter.emit(d.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(n.default.IO_ERROR,function(_,E){p._emitter.emit(d.default.ERROR,e.ErrorTypes.NETWORK_ERROR,_,E)}),this._transmuxer.on(n.default.DEMUX_ERROR,function(_,E){p._emitter.emit(d.default.ERROR,e.ErrorTypes.MEDIA_ERROR,_,{code:-1,msg:E})}),this._transmuxer.on(n.default.MEDIA_INFO,function(_){p._mediaInfo=_,p._emitter.emit(d.default.MEDIA_INFO,Object.assign({},_))}),this._transmuxer.on(n.default.METADATA_ARRIVED,function(_){p._emitter.emit(d.default.METADATA_ARRIVED,_)}),this._transmuxer.on(n.default.SCRIPTDATA_ARRIVED,function(_){p._emitter.emit(d.default.SCRIPTDATA_ARRIVED,_)}),this._transmuxer.on(n.default.STATISTICS_INFO,function(_){p._statisticsInfo=p._fillStatisticsInfo(_),p._emitter.emit(d.default.STATISTICS_INFO,Object.assign({},p._statisticsInfo))}),this._transmuxer.on(n.default.RECOMMEND_SEEKPOINT,function(_){p._mediaElement&&!p._config.accurateSeek&&(p._requestSetTime=!0,p._mediaElement.currentTime=_/1e3)}),this._transmuxer.open()}},c.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},c.prototype.play=function(){return this._mediaElement.play()},c.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(c.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(p){this._mediaElement.volume=p},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(p){this._mediaElement.muted=p},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(p){this._mediaElement?this._internalSeek(p):this._pendingSeekTime=p},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),c.prototype._fillStatisticsInfo=function(p){if(p.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return p;var _=!0,E=0,L=0;if(this._mediaElement.getVideoPlaybackQuality){var b=this._mediaElement.getVideoPlaybackQuality();E=b.totalVideoFrames,L=b.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(E=this._mediaElement.webkitDecodedFrameCount,L=this._mediaElement.webkitDroppedFrameCount):_=!1;return _&&(p.decodedFrames=E,p.droppedFrames=L),p},c.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var p=this._mediaElement.buffered,_=this._mediaElement.currentTime,E=0,L=0;L<p.length;L++){var b=p.start(L),m=p.end(L);if(b<=_&&_<m){E=m;break}}E>=_+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(l.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},c.prototype._onmseBufferFull=function(){l.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},c.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},c.prototype._checkProgressAndResume=function(){for(var p=this._mediaElement.currentTime,_=this._mediaElement.buffered,E=!1,L=0;L<_.length;L++){var b=_.start(L),m=_.end(L);if(p>=b&&p<m){p>=m-this._config.lazyLoadRecoverDuration&&(E=!0);break}}E&&(window.clearInterval(this._progressChecker),this._progressChecker=null,E&&(l.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},c.prototype._isTimepointBuffered=function(p){for(var _=this._mediaElement.buffered,E=0;E<_.length;E++){var L=_.start(E),b=_.end(E);if(p>=L&&p<b)return!0}return!1},c.prototype._internalSeek=function(p){var _=this._isTimepointBuffered(p),E=!1,L=0;if(p<1&&this._mediaElement.buffered.length>0){var b=this._mediaElement.buffered.start(0);(b<1&&p<b||a.default.safari)&&(E=!0,L=a.default.safari?.1:b)}if(E)this._requestSetTime=!0,this._mediaElement.currentTime=L;else if(_){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=p;else{var m=this._msectl.getNearestKeyframe(Math.floor(p*1e3));this._requestSetTime=!0,m!=null?this._mediaElement.currentTime=m.dts/1e3:this._mediaElement.currentTime=p}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(p),this._transmuxer.seek(Math.floor(p*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=p)},c.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var p=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(p)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(p),this._transmuxer.seek(Math.floor(p*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=p))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},c.prototype._checkAndResumeStuckPlayback=function(p){var _=this._mediaElement;if(p||!this._receivedCanPlay||_.readyState<2){var E=_.buffered;E.length>0&&_.currentTime<E.start(0)&&(l.default.w(this.TAG,"Playback seems stuck at "+_.currentTime+", seek to "+E.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=E.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},c.prototype._onvLoadedMetadata=function(p){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},c.prototype._onvSeeking=function(p){var _=this._mediaElement.currentTime,E=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(_<1&&E.length>0){var L=E.start(0);if(L<1&&_<L||a.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=a.default.safari?.1:L;return}}if(this._isTimepointBuffered(_)){if(this._alwaysSeekKeyframe){var b=this._msectl.getNearestKeyframe(Math.floor(_*1e3));b!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=b.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:_,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},c.prototype._onvCanPlay=function(p){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},c.prototype._onvStalled=function(p){this._checkAndResumeStuckPlayback(!0)},c.prototype._onvProgress=function(p){this._checkAndResumeStuckPlayback()},c}();g.default=t},"./src/player/native-player.js":function(v,g,h){h.r(g);var x=h("./node_modules/events/events.js"),f=h.n(x),l=h("./src/player/player-events.js"),a=h("./src/config.js"),d=h("./src/utils/exception.js"),r=function(){function n(u,i){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(f()),this._config=(0,a.createDefaultConfig)(),typeof i=="object"&&Object.assign(this._config,i),u.type.toLowerCase()==="flv")throw new d.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(u.hasOwnProperty("segments"))throw new d.InvalidArgumentException("NativePlayer("+u.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=u,this._mediaElement=null}return n.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(u,i){var e=this;u===l.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){e._emitter.emit(l.default.MEDIA_INFO,e.mediaInfo)}):u===l.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){e._emitter.emit(l.default.STATISTICS_INFO,e.statisticsInfo)}),this._emitter.addListener(u,i)},n.prototype.off=function(u,i){this._emitter.removeListener(u,i)},n.prototype.attachMediaElement=function(u){if(this._mediaElement=u,u.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{u.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},n.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},n.prototype.load=function(){if(!this._mediaElement)throw new d.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},n.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},n.prototype.play=function(){return this._mediaElement.play()},n.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(n.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(u){this._mediaElement.volume=u},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(u){this._mediaElement.muted=u},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(u){this._mediaElement?this._mediaElement.currentTime=u:this._pendingSeekTime=u},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mediaInfo",{get:function(){var u=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",i={mimeType:u+this._mediaDataSource.type};return this._mediaElement&&(i.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(i.width=this._mediaElement.videoWidth,i.height=this._mediaElement.videoHeight)),i},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"statisticsInfo",{get:function(){var u={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return u;var i=!0,e=0,s=0;if(this._mediaElement.getVideoPlaybackQuality){var o=this._mediaElement.getVideoPlaybackQuality();e=o.totalVideoFrames,s=o.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(e=this._mediaElement.webkitDecodedFrameCount,s=this._mediaElement.webkitDroppedFrameCount):i=!1;return i&&(u.decodedFrames=e,u.droppedFrames=s),u},enumerable:!1,configurable:!0}),n.prototype._onvLoadedMetadata=function(u){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(l.default.MEDIA_INFO,this.mediaInfo)},n.prototype._reportStatisticsInfo=function(){this._emitter.emit(l.default.STATISTICS_INFO,this.statisticsInfo)},n}();g.default=r},"./src/player/player-errors.js":function(v,g,h){h.r(g),h.d(g,{ErrorTypes:function(){return l},ErrorDetails:function(){return a}});var x=h("./src/io/loader.js"),f=h("./src/demux/demux-errors.js"),l={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},a={NETWORK_EXCEPTION:x.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:x.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:x.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:x.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:f.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:f.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:f.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(v,g,h){h.r(g);var x={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};g.default=x},"./src/remux/aac-silent.js":function(v,g,h){h.r(g);var x=function(){function f(){}return f.getSilentFrame=function(l,a){if(l==="mp4a.40.2"){if(a===1)return new Uint8Array([0,200,0,128,35,128]);if(a===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(a===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(a===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(a===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(a===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(a===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(a===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(a===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},f}();g.default=x},"./src/remux/mp4-generator.js":function(v,g,h){h.r(g);var x=function(){function f(){}return f.init=function(){f.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var l in f.types)f.types.hasOwnProperty(l)&&(f.types[l]=[l.charCodeAt(0),l.charCodeAt(1),l.charCodeAt(2),l.charCodeAt(3)]);var a=f.constants={};a.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),a.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),a.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),a.STSC=a.STCO=a.STTS,a.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),a.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),a.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),a.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},f.box=function(l){for(var a=8,d=null,r=Array.prototype.slice.call(arguments,1),n=r.length,u=0;u<n;u++)a+=r[u].byteLength;d=new Uint8Array(a),d[0]=a>>>24&255,d[1]=a>>>16&255,d[2]=a>>>8&255,d[3]=a&255,d.set(l,4);for(var i=8,u=0;u<n;u++)d.set(r[u],i),i+=r[u].byteLength;return d},f.generateInitSegment=function(l){var a=f.box(f.types.ftyp,f.constants.FTYP),d=f.moov(l),r=new Uint8Array(a.byteLength+d.byteLength);return r.set(a,0),r.set(d,a.byteLength),r},f.moov=function(l){var a=f.mvhd(l.timescale,l.duration),d=f.trak(l),r=f.mvex(l);return f.box(f.types.moov,a,d,r)},f.mvhd=function(l,a){return f.box(f.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,l>>>24&255,l>>>16&255,l>>>8&255,l&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},f.trak=function(l){return f.box(f.types.trak,f.tkhd(l),f.mdia(l))},f.tkhd=function(l){var a=l.id,d=l.duration,r=l.presentWidth,n=l.presentHeight;return f.box(f.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,r&255,0,0,n>>>8&255,n&255,0,0]))},f.mdia=function(l){return f.box(f.types.mdia,f.mdhd(l),f.hdlr(l),f.minf(l))},f.mdhd=function(l){var a=l.timescale,d=l.duration;return f.box(f.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,85,196,0,0]))},f.hdlr=function(l){var a=null;return l.type==="audio"?a=f.constants.HDLR_AUDIO:a=f.constants.HDLR_VIDEO,f.box(f.types.hdlr,a)},f.minf=function(l){var a=null;return l.type==="audio"?a=f.box(f.types.smhd,f.constants.SMHD):a=f.box(f.types.vmhd,f.constants.VMHD),f.box(f.types.minf,a,f.dinf(),f.stbl(l))},f.dinf=function(){var l=f.box(f.types.dinf,f.box(f.types.dref,f.constants.DREF));return l},f.stbl=function(l){var a=f.box(f.types.stbl,f.stsd(l),f.box(f.types.stts,f.constants.STTS),f.box(f.types.stsc,f.constants.STSC),f.box(f.types.stsz,f.constants.STSZ),f.box(f.types.stco,f.constants.STCO));return a},f.stsd=function(l){return l.type==="audio"?l.codec==="mp3"?f.box(f.types.stsd,f.constants.STSD_PREFIX,f.mp3(l)):f.box(f.types.stsd,f.constants.STSD_PREFIX,f.mp4a(l)):f.box(f.types.stsd,f.constants.STSD_PREFIX,f.avc1(l))},f.mp3=function(l){var a=l.channelCount,d=l.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a,0,16,0,0,0,0,d>>>8&255,d&255,0,0]);return f.box(f.types[".mp3"],r)},f.mp4a=function(l){var a=l.channelCount,d=l.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,a,0,16,0,0,0,0,d>>>8&255,d&255,0,0]);return f.box(f.types.mp4a,r,f.esds(l))},f.esds=function(l){var a=l.config||[],d=a.length,r=new Uint8Array([0,0,0,0,3,23+d,0,1,0,4,15+d,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([d]).concat(a).concat([6,1,2]));return f.box(f.types.esds,r)},f.avc1=function(l){var a=l.avcc,d=l.codecWidth,r=l.codecHeight,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,d>>>8&255,d&255,r>>>8&255,r&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return f.box(f.types.avc1,n,f.box(f.types.avcC,a))},f.mvex=function(l){return f.box(f.types.mvex,f.trex(l))},f.trex=function(l){var a=l.id,d=new Uint8Array([0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return f.box(f.types.trex,d)},f.moof=function(l,a){return f.box(f.types.moof,f.mfhd(l.sequenceNumber),f.traf(l,a))},f.mfhd=function(l){var a=new Uint8Array([0,0,0,0,l>>>24&255,l>>>16&255,l>>>8&255,l&255]);return f.box(f.types.mfhd,a)},f.traf=function(l,a){var d=l.id,r=f.box(f.types.tfhd,new Uint8Array([0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255])),n=f.box(f.types.tfdt,new Uint8Array([0,0,0,0,a>>>24&255,a>>>16&255,a>>>8&255,a&255])),u=f.sdtp(l),i=f.trun(l,u.byteLength+16+16+8+16+8+8);return f.box(f.types.traf,r,n,i,u)},f.sdtp=function(l){for(var a=l.samples||[],d=a.length,r=new Uint8Array(4+d),n=0;n<d;n++){var u=a[n].flags;r[n+4]=u.isLeading<<6|u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy}return f.box(f.types.sdtp,r)},f.trun=function(l,a){var d=l.samples||[],r=d.length,n=12+16*r,u=new Uint8Array(n);a+=8+n,u.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255],0);for(var i=0;i<r;i++){var e=d[i].duration,s=d[i].size,o=d[i].flags,t=d[i].cts;u.set([e>>>24&255,e>>>16&255,e>>>8&255,e&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.isNonSync,0,0,t>>>24&255,t>>>16&255,t>>>8&255,t&255],12+16*i)}return f.box(f.types.trun,u)},f.mdat=function(l){return f.box(f.types.mdat,l)},f}();x.init(),g.default=x},"./src/remux/mp4-remuxer.js":function(v,g,h){h.r(g);var x=h("./src/utils/logger.js"),f=h("./src/remux/mp4-generator.js"),l=h("./src/remux/aac-silent.js"),a=h("./src/utils/browser.js"),d=h("./src/core/media-segment-info.js"),r=h("./src/utils/exception.js"),n=function(){function u(i){this.TAG="MP4Remuxer",this._config=i,this._isLive=i.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new d.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new d.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(a.default.chrome&&(a.default.version.major<50||a.default.version.major===50&&a.default.version.build<2661)),this._fillSilentAfterSeek=a.default.msedge||a.default.msie,this._mp3UseMpegAudio=!a.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return u.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},u.prototype.bindDataSource=function(i){return i.onDataAvailable=this.remux.bind(this),i.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(u.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(i){this._onInitSegment=i},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(i){this._onMediaSegment=i},enumerable:!1,configurable:!0}),u.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},u.prototype.seek=function(i){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},u.prototype.remux=function(i,e){if(!this._onMediaSegment)throw new r.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(i,e),this._remuxVideo(e),this._remuxAudio(i)},u.prototype._onTrackMetadataReceived=function(i,e){var s=null,o="mp4",t=e.codec;if(i==="audio")this._audioMeta=e,e.codec==="mp3"&&this._mp3UseMpegAudio?(o="mpeg",t="",s=new Uint8Array):s=f.default.generateInitSegment(e);else if(i==="video")this._videoMeta=e,s=f.default.generateInitSegment(e);else return;if(!this._onInitSegment)throw new r.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(i,{type:i,data:s.buffer,codec:t,container:i+"/"+o,mediaDuration:e.duration})},u.prototype._calculateDtsBase=function(i,e){this._dtsBaseInited||(i.samples&&i.samples.length&&(this._audioDtsBase=i.samples[0].dts),e.samples&&e.samples.length&&(this._videoDtsBase=e.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},u.prototype.flushStashedSamples=function(){var i=this._videoStashedLastSample,e=this._audioStashedLastSample,s={type:"video",id:1,sequenceNumber:0,samples:[],length:0};i!=null&&(s.samples.push(i),s.length=i.length);var o={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};e!=null&&(o.samples.push(e),o.length=e.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(s,!0),this._remuxAudio(o,!0)},u.prototype._remuxAudio=function(i,e){if(this._audioMeta!=null){var s=i,o=s.samples,t=void 0,c=-1,p=-1,_=this._audioMeta.refSampleDuration,E=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,L=this._dtsBaseInited&&this._audioNextDts===void 0,b=!1;if(!(!o||o.length===0)&&!(o.length===1&&!e)){var m=0,w=null,S=0;E?(m=0,S=s.length):(m=8,S=8+s.length);var P=null;if(o.length>1&&(P=o.pop(),S-=P.length),this._audioStashedLastSample!=null){var I=this._audioStashedLastSample;this._audioStashedLastSample=null,o.unshift(I),S+=I.length}P!=null&&(this._audioStashedLastSample=P);var U=o[0].dts-this._dtsBase;if(this._audioNextDts)t=U-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())t=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(b=!0);else{var B=this._audioSegmentInfoList.getLastSampleBefore(U);if(B!=null){var W=U-(B.originalDts+B.duration);W<=3&&(W=0);var C=B.dts+B.duration+W;t=U-C}else t=0}if(b){var k=U-t,G=this._videoSegmentInfoList.getLastSegmentBefore(U);if(G!=null&&G.beginDts<k){var M=l.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(M){var Y=G.beginDts,X=k-G.beginDts;x.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+Y+", duration: "+X),o.unshift({unit:M,dts:Y,pts:Y}),S+=M.byteLength}}else b=!1}for(var J=[],K=0;K<o.length;K++){var I=o[K],$=I.unit,re=I.dts-this._dtsBase,Y=re,ee=!1,te=null,q=0;if(!(re<-.001)){if(this._audioMeta.codec!=="mp3"){var Z=re,se=3;if(this._audioNextDts&&(Z=this._audioNextDts),t=re-Z,t<=-se*_){x.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+re+" ms ,curRefDts: "+Z+" ms)  due to dtsCorrection: "+t+" ms overlap.");continue}else if(t>=se*_&&this._fillAudioTimestampGap&&!a.default.safari){ee=!0;var le=Math.floor(t/_);x.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+re+" ms, curRefDts: "+Z+" ms, ")+("dtsCorrection: "+Math.round(t)+" ms, generate: "+le+" frames")),Y=Math.floor(Z),q=Math.floor(Z+_)-Y;var M=l.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);M==null&&(x.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),M=$),te=[];for(var fe=0;fe<le;fe++){Z=Z+_;var ce=Math.floor(Z),ge=Math.floor(Z+_)-ce,_e={dts:ce,pts:ce,cts:0,unit:M,size:M.byteLength,duration:ge,originalDts:re,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};te.push(_e),S+=_e.size}this._audioNextDts=Z+_}else Y=Math.floor(Z),q=Math.floor(Z+_)-Y,this._audioNextDts=Z+_}else{if(Y=re-t,K!==o.length-1){var Le=o[K+1].dts-this._dtsBase-t;q=Le-Y}else if(P!=null){var Le=P.dts-this._dtsBase-t;q=Le-Y}else J.length>=1?q=J[J.length-1].duration:q=Math.floor(_);this._audioNextDts=Y+q}c===-1&&(c=Y),J.push({dts:Y,pts:Y,cts:0,unit:I.unit,size:I.unit.byteLength,duration:q,originalDts:re,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),ee&&J.push.apply(J,te)}}if(J.length===0){s.samples=[],s.length=0;return}E?w=new Uint8Array(S):(w=new Uint8Array(S),w[0]=S>>>24&255,w[1]=S>>>16&255,w[2]=S>>>8&255,w[3]=S&255,w.set(f.default.types.mdat,4));for(var K=0;K<J.length;K++){var $=J[K].unit;w.set($,m),m+=$.byteLength}var ve=J[J.length-1];p=ve.dts+ve.duration;var he=new d.MediaSegmentInfo;he.beginDts=c,he.endDts=p,he.beginPts=c,he.endPts=p,he.originalBeginDts=J[0].originalDts,he.originalEndDts=ve.originalDts+ve.duration,he.firstSample=new d.SampleInfo(J[0].dts,J[0].pts,J[0].duration,J[0].originalDts,!1),he.lastSample=new d.SampleInfo(ve.dts,ve.pts,ve.duration,ve.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(he),s.samples=J,s.sequenceNumber++;var Ce=null;E?Ce=new Uint8Array:Ce=f.default.moof(s,c),s.samples=[],s.length=0;var Oe={type:"audio",data:this._mergeBoxes(Ce,w).buffer,sampleCount:J.length,info:he};E&&L&&(Oe.timestampOffset=c),this._onMediaSegment("audio",Oe)}}},u.prototype._remuxVideo=function(i,e){if(this._videoMeta!=null){var s=i,o=s.samples,t=void 0,c=-1,p=-1,_=-1,E=-1;if(!(!o||o.length===0)&&!(o.length===1&&!e)){var L=8,b=null,m=8+i.length,w=null;if(o.length>1&&(w=o.pop(),m-=w.length),this._videoStashedLastSample!=null){var S=this._videoStashedLastSample;this._videoStashedLastSample=null,o.unshift(S),m+=S.length}w!=null&&(this._videoStashedLastSample=w);var P=o[0].dts-this._dtsBase;if(this._videoNextDts)t=P-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())t=0;else{var I=this._videoSegmentInfoList.getLastSampleBefore(P);if(I!=null){var U=P-(I.originalDts+I.duration);U<=3&&(U=0);var B=I.dts+I.duration+U;t=P-B}else t=0}for(var W=new d.MediaSegmentInfo,C=[],k=0;k<o.length;k++){var S=o[k],G=S.dts-this._dtsBase,M=S.isKeyframe,Y=G-t,X=S.cts,J=Y+X;c===-1&&(c=Y,_=J);var K=0;if(k!==o.length-1){var $=o[k+1].dts-this._dtsBase-t;K=$-Y}else if(w!=null){var $=w.dts-this._dtsBase-t;K=$-Y}else C.length>=1?K=C[C.length-1].duration:K=Math.floor(this._videoMeta.refSampleDuration);if(M){var re=new d.SampleInfo(Y,J,K,S.dts,!0);re.fileposition=S.fileposition,W.appendSyncPoint(re)}C.push({dts:Y,pts:J,cts:X,units:S.units,size:S.length,isKeyframe:M,duration:K,originalDts:G,flags:{isLeading:0,dependsOn:M?2:1,isDependedOn:M?1:0,hasRedundancy:0,isNonSync:M?0:1}})}b=new Uint8Array(m),b[0]=m>>>24&255,b[1]=m>>>16&255,b[2]=m>>>8&255,b[3]=m&255,b.set(f.default.types.mdat,4);for(var k=0;k<C.length;k++)for(var ee=C[k].units;ee.length;){var te=ee.shift(),q=te.data;b.set(q,L),L+=q.byteLength}var Z=C[C.length-1];if(p=Z.dts+Z.duration,E=Z.pts+Z.duration,this._videoNextDts=p,W.beginDts=c,W.endDts=p,W.beginPts=_,W.endPts=E,W.originalBeginDts=C[0].originalDts,W.originalEndDts=Z.originalDts+Z.duration,W.firstSample=new d.SampleInfo(C[0].dts,C[0].pts,C[0].duration,C[0].originalDts,C[0].isKeyframe),W.lastSample=new d.SampleInfo(Z.dts,Z.pts,Z.duration,Z.originalDts,Z.isKeyframe),this._isLive||this._videoSegmentInfoList.append(W),s.samples=C,s.sequenceNumber++,this._forceFirstIDR){var se=C[0].flags;se.dependsOn=2,se.isNonSync=0}var le=f.default.moof(s,c);s.samples=[],s.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(le,b).buffer,sampleCount:C.length,info:W})}}},u.prototype._mergeBoxes=function(i,e){var s=new Uint8Array(i.byteLength+e.byteLength);return s.set(i,0),s.set(e,i.byteLength),s},u}();g.default=n},"./src/utils/browser.js":function(v,g,h){h.r(g);var x={};function f(){var l=self.navigator.userAgent.toLowerCase(),a=/(edge)\/([\w.]+)/.exec(l)||/(opr)[\/]([\w.]+)/.exec(l)||/(chrome)[ \/]([\w.]+)/.exec(l)||/(iemobile)[\/]([\w.]+)/.exec(l)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(l)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(l)||/(webkit)[ \/]([\w.]+)/.exec(l)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(l)||/(msie) ([\w.]+)/.exec(l)||l.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(l)||l.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(l)||[],d=/(ipad)/.exec(l)||/(ipod)/.exec(l)||/(windows phone)/.exec(l)||/(iphone)/.exec(l)||/(kindle)/.exec(l)||/(android)/.exec(l)||/(windows)/.exec(l)||/(mac)/.exec(l)||/(linux)/.exec(l)||/(cros)/.exec(l)||[],r={browser:a[5]||a[3]||a[1]||"",version:a[2]||a[4]||"0",majorVersion:a[4]||a[2]||"0",platform:d[0]||""},n={};if(r.browser){n[r.browser]=!0;var u=r.majorVersion.split(".");n.version={major:parseInt(r.majorVersion,10),string:r.version},u.length>1&&(n.version.minor=parseInt(u[1],10)),u.length>2&&(n.version.build=parseInt(u[2],10))}if(r.platform&&(n[r.platform]=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),n.rv||n.iemobile){n.rv&&delete n.rv;var i="msie";r.browser=i,n[i]=!0}if(n.edge){delete n.edge;var e="msedge";r.browser=e,n[e]=!0}if(n.opr){var s="opera";r.browser=s,n[s]=!0}if(n.safari&&n.android){var o="android";r.browser=o,n[o]=!0}n.name=r.browser,n.platform=r.platform;for(var t in x)x.hasOwnProperty(t)&&delete x[t];Object.assign(x,n)}f(),g.default=x},"./src/utils/exception.js":function(v,g,h){h.r(g),h.d(g,{RuntimeException:function(){return f},IllegalStateException:function(){return l},InvalidArgumentException:function(){return a},NotImplementedException:function(){return d}});var x=function(){var r=function(n,u){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,e){i.__proto__=e}||function(i,e){for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])},r(n,u)};return function(n,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");r(n,u);function i(){this.constructor=n}n.prototype=u===null?Object.create(u):(i.prototype=u.prototype,new i)}}(),f=function(){function r(n){this._message=n}return Object.defineProperty(r.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),r.prototype.toString=function(){return this.name+": "+this.message},r}(),l=function(r){x(n,r);function n(u){return r.call(this,u)||this}return Object.defineProperty(n.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),n}(f),a=function(r){x(n,r);function n(u){return r.call(this,u)||this}return Object.defineProperty(n.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),n}(f),d=function(r){x(n,r);function n(u){return r.call(this,u)||this}return Object.defineProperty(n.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),n}(f)},"./src/utils/logger.js":function(v,g,h){h.r(g);var x=h("./node_modules/events/events.js"),f=h.n(x),l=function(){function a(){}return a.e=function(d,r){(!d||a.FORCE_GLOBAL_TAG)&&(d=a.GLOBAL_TAG);var n="["+d+"] > "+r;a.ENABLE_CALLBACK&&a.emitter.emit("log","error",n),a.ENABLE_ERROR&&(console.error?console.error(n):console.warn?console.warn(n):console.log(n))},a.i=function(d,r){(!d||a.FORCE_GLOBAL_TAG)&&(d=a.GLOBAL_TAG);var n="["+d+"] > "+r;a.ENABLE_CALLBACK&&a.emitter.emit("log","info",n),a.ENABLE_INFO&&(console.info?console.info(n):console.log(n))},a.w=function(d,r){(!d||a.FORCE_GLOBAL_TAG)&&(d=a.GLOBAL_TAG);var n="["+d+"] > "+r;a.ENABLE_CALLBACK&&a.emitter.emit("log","warn",n),a.ENABLE_WARN&&(console.warn?console.warn(n):console.log(n))},a.d=function(d,r){(!d||a.FORCE_GLOBAL_TAG)&&(d=a.GLOBAL_TAG);var n="["+d+"] > "+r;a.ENABLE_CALLBACK&&a.emitter.emit("log","debug",n),a.ENABLE_DEBUG&&(console.debug?console.debug(n):console.log(n))},a.v=function(d,r){(!d||a.FORCE_GLOBAL_TAG)&&(d=a.GLOBAL_TAG);var n="["+d+"] > "+r;a.ENABLE_CALLBACK&&a.emitter.emit("log","verbose",n),a.ENABLE_VERBOSE&&console.log(n)},a}();l.GLOBAL_TAG="flv.js",l.FORCE_GLOBAL_TAG=!1,l.ENABLE_ERROR=!0,l.ENABLE_INFO=!0,l.ENABLE_WARN=!0,l.ENABLE_DEBUG=!0,l.ENABLE_VERBOSE=!0,l.ENABLE_CALLBACK=!1,l.emitter=new(f()),g.default=l},"./src/utils/logging-control.js":function(v,g,h){h.r(g);var x=h("./node_modules/events/events.js"),f=h.n(x),l=h("./src/utils/logger.js"),a=function(){function d(){}return Object.defineProperty(d,"forceGlobalTag",{get:function(){return l.default.FORCE_GLOBAL_TAG},set:function(r){l.default.FORCE_GLOBAL_TAG=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"globalTag",{get:function(){return l.default.GLOBAL_TAG},set:function(r){l.default.GLOBAL_TAG=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableAll",{get:function(){return l.default.ENABLE_VERBOSE&&l.default.ENABLE_DEBUG&&l.default.ENABLE_INFO&&l.default.ENABLE_WARN&&l.default.ENABLE_ERROR},set:function(r){l.default.ENABLE_VERBOSE=r,l.default.ENABLE_DEBUG=r,l.default.ENABLE_INFO=r,l.default.ENABLE_WARN=r,l.default.ENABLE_ERROR=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableDebug",{get:function(){return l.default.ENABLE_DEBUG},set:function(r){l.default.ENABLE_DEBUG=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableVerbose",{get:function(){return l.default.ENABLE_VERBOSE},set:function(r){l.default.ENABLE_VERBOSE=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableInfo",{get:function(){return l.default.ENABLE_INFO},set:function(r){l.default.ENABLE_INFO=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableWarn",{get:function(){return l.default.ENABLE_WARN},set:function(r){l.default.ENABLE_WARN=r,d._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(d,"enableError",{get:function(){return l.default.ENABLE_ERROR},set:function(r){l.default.ENABLE_ERROR=r,d._notifyChange()},enumerable:!1,configurable:!0}),d.getConfig=function(){return{globalTag:l.default.GLOBAL_TAG,forceGlobalTag:l.default.FORCE_GLOBAL_TAG,enableVerbose:l.default.ENABLE_VERBOSE,enableDebug:l.default.ENABLE_DEBUG,enableInfo:l.default.ENABLE_INFO,enableWarn:l.default.ENABLE_WARN,enableError:l.default.ENABLE_ERROR,enableCallback:l.default.ENABLE_CALLBACK}},d.applyConfig=function(r){l.default.GLOBAL_TAG=r.globalTag,l.default.FORCE_GLOBAL_TAG=r.forceGlobalTag,l.default.ENABLE_VERBOSE=r.enableVerbose,l.default.ENABLE_DEBUG=r.enableDebug,l.default.ENABLE_INFO=r.enableInfo,l.default.ENABLE_WARN=r.enableWarn,l.default.ENABLE_ERROR=r.enableError,l.default.ENABLE_CALLBACK=r.enableCallback},d._notifyChange=function(){var r=d.emitter;if(r.listenerCount("change")>0){var n=d.getConfig();r.emit("change",n)}},d.registerListener=function(r){d.emitter.addListener("change",r)},d.removeListener=function(r){d.emitter.removeListener("change",r)},d.addLogListener=function(r){l.default.emitter.addListener("log",r),l.default.emitter.listenerCount("log")>0&&(l.default.ENABLE_CALLBACK=!0,d._notifyChange())},d.removeLogListener=function(r){l.default.emitter.removeListener("log",r),l.default.emitter.listenerCount("log")===0&&(l.default.ENABLE_CALLBACK=!1,d._notifyChange())},d}();a.emitter=new(f()),g.default=a},"./src/utils/polyfill.js":function(v,g,h){h.r(g);var x=function(){function f(){}return f.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(l,a){return l.__proto__=a,l},Object.assign=Object.assign||function(l){if(l==null)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(l),d=1;d<arguments.length;d++){var r=arguments[d];if(r!=null)for(var n in r)r.hasOwnProperty(n)&&(a[n]=r[n])}return a},typeof self.Promise!="function"&&h("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},f}();x.install(),g.default=x},"./src/utils/utf8-conv.js":function(v,g,h){h.r(g);function x(l,a,d){var r=l;if(a+d<r.length){for(;d--;)if((r[++a]&192)!==128)return!1;return!0}else return!1}function f(l){for(var a=[],d=l,r=0,n=l.length;r<n;){if(d[r]<128){a.push(String.fromCharCode(d[r])),++r;continue}else if(!(d[r]<192)){if(d[r]<224){if(x(d,r,1)){var u=(d[r]&31)<<6|d[r+1]&63;if(u>=128){a.push(String.fromCharCode(u&65535)),r+=2;continue}}}else if(d[r]<240){if(x(d,r,2)){var u=(d[r]&15)<<12|(d[r+1]&63)<<6|d[r+2]&63;if(u>=2048&&(u&63488)!==55296){a.push(String.fromCharCode(u&65535)),r+=3;continue}}}else if(d[r]<248&&x(d,r,3)){var u=(d[r]&7)<<18|(d[r+1]&63)<<12|(d[r+2]&63)<<6|d[r+3]&63;if(u>65536&&u<1114112){u-=65536,a.push(String.fromCharCode(u>>>10|55296)),a.push(String.fromCharCode(u&1023|56320)),r+=4;continue}}}a.push("�"),++r}return a.join("")}g.default=f}},j={};function N(v){var g=j[v];if(g!==void 0)return g.exports;var h=j[v]={exports:{}};return A[v].call(h.exports,h,h.exports,N),h.exports}N.m=A,function(){N.n=function(v){var g=v&&v.__esModule?function(){return v.default}:function(){return v};return N.d(g,{a:g}),g}}(),function(){N.d=function(v,g){for(var h in g)N.o(g,h)&&!N.o(v,h)&&Object.defineProperty(v,h,{enumerable:!0,get:g[h]})}}(),function(){N.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){N.o=function(v,g){return Object.prototype.hasOwnProperty.call(v,g)}}(),function(){N.r=function(v){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(v,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(v,"__esModule",{value:!0})}}();var V=N("./src/index.js");return V}()})}(Ue)),Ue.exports}var gi=mi();const Me=Sr(gi),vi=({setShowBottomNavGlobal:O})=>{const[D,A]=R.useState(!0),[j,N]=R.useState(!1),V=R.useRef(0),v=R.useRef(null),[g,h]=R.useState(""),[x,f]=R.useState([]),[l,a]=R.useState([]),[d,r]=R.useState([]),[n,u]=R.useState(!1),i=R.useRef(!1),[e,s]=R.useState({project:localStorage.getItem("projectId")||void 0}),o=async E=>{console.log("获取摄像头列表"),console.log(E);try{u(!0);let L={ids:E.ids,projectId:E.projectId};const b=await pi(L);r(b||[])}catch(L){console.log("获取摄像头列表失败:",L)}finally{u(!1)}};R.useEffect(()=>{if(i.current)return;i.current=!0;const E=async()=>{try{const m=(await Lr()).map(w=>({id:w.id,name:w.projectName}));a(m)}catch(b){console.log("获取项目列表失败:",b)}},L=async()=>{try{const b=await hi();console.log("接口获取到的值"),console.log(b),console.log("接口获取到的值");const m=Array.isArray(b.cameraRegionRespVO)?b.cameraRegionRespVO:[];console.log("处理后的值"),console.log(m),console.log("处理后的值"),o(),f(m)}catch(b){console.log("获取区域数据失败:",b),f([])}};E(),L()},[]),R.useEffect(()=>{const E=()=>{if(!v.current)return;const L=v.current.scrollTop,b=L>V.current?"down":"up";Math.abs(L-V.current)>50&&(O(b!=="down"),V.current=L)};return v.current&&v.current.addEventListener("scroll",E),()=>{v.current&&v.current.removeEventListener("scroll",E)}},[]);const t=async E=>{console.log("data",E);const L={projectId:E.project,regionIds:[E.id]},b=await _i(L);console.log(b),console.log(b),console.log(b);let m=[];b.forEach(w=>{m.push(w.id)}),console.log("可用摄像头列表:",b),o({projectId:E.project,ids:m}),s(E)},c=g.toLowerCase();console.log("cameras"),console.log(d),console.log("cameras");const p=d.filter(E=>E.cameraName.toLowerCase().includes(c)||E.location.toLowerCase().includes(c)),_=_t.memo(({camera:E})=>{const L=R.useRef(null),b=R.useRef(),[m,w]=R.useState(!1),[S,P]=R.useState(0);R.useEffect(()=>{let B=null;if(console.log("retryCount",S),w(!1),Me.isSupported()&&L.current)try{B=Me.createPlayer({type:"flv",url:E.rtmpUrl});const W=()=>{if(B&&B.destroy){try{B.pause(),B.unload(),B.destroy()}catch(G){console.warn("安全销毁播放器时出错:",G)}B=null}};B.attachMediaElement(L.current),B.load(),B.play(),B.on(Me.Events.PLAYING,()=>{w(!1)}),B.on(Me.Events.ERROR,(G,M)=>{console.log("播放错误:",G,M),w(!0),W()}),b.current=B;const k=setInterval(()=>{B&&B._mediaElement&&(!B._mediaElement.error&&!B._mediaElement.ended&&B._mediaElement.readyState>0||(w(!0),W()))},3e3);return()=>{clearInterval(k),W()}}catch(W){console.log("播放器创建失败:",W),w(!0)}else w(!0);return()=>{}},[E.rtmpUrl,S]);const I=()=>{console.error("handleRetry:"),P(B=>B+1)},U=B=>{console.log("handleFullScreen:"),B&&B&&(B.requestFullscreen?B.requestFullscreen():B.mozRequestFullScreen?B.mozRequestFullScreen():B.webkitRequestFullscreen?B.webkitRequestFullscreen():B.msRequestFullscreen&&B.msRequestFullscreen())};return y.jsxs(yt,{className:"relative overflow-hidden py-0 h-52",children:[m&&y.jsxs("div",{className:"absolute inset-0 bg-black/70 flex flex-col items-center justify-center z-30",style:{pointerEvents:"auto"},children:[y.jsx("div",{className:"text-white mb-4",children:"视频加载失败"}),y.jsx("button",{onClick:I,className:"px-4 py-2 bg-black rounded-md text-white hover:bg-black-700 transition-colors relative z-40",children:"重新加载"})]}),y.jsx("video",{ref:L,className:"absolute inset-0 object-cover w-full h-full z-10 pointer-events-none",muted:!0,playsInline:!0,controls:!1}),y.jsx("button",{onClick:()=>U(L.current),className:"absolute top-3 right-3 z-30 bg-black/50 rounded-md p-1.5 flex items-center justify-center w-8 h-8","aria-label":"全屏播放",children:y.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",children:y.jsx("path",{d:"M4 8V4m0 0h4M4 4l5 5m11-5h-4m4 0v4m0-4l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5h-4m4 0v-4m0 4l-5-5"})})}),y.jsx("div",{className:"relative z-20 h-full flex flex-col justify-end p-3 bg-gradient-to-t from-black/60 to-transparent",children:y.jsxs("div",{className:"flex justify-between text-sm text-white",children:[y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(cn,{className:"h-4 w-4"}),y.jsx("span",{children:E.cameraName})]}),y.jsxs("div",{className:"flex items-center gap-1",children:[y.jsx(on,{className:"h-4 w-4"}),y.jsx("span",{children:E.location})]})]})})]})});return y.jsxs("div",{className:"h-full flex flex-col",children:[y.jsxs("div",{className:"sticky top-0 z-35 bg-white flex gap-2 p-3",children:[y.jsx(wt,{placeholder:"搜索",value:g,onChange:E=>h(E.target.value)}),y.jsx(fi,{onSubmit:t,regions:x,projects:l})]}),p.length===0&&y.jsx("div",{className:"col-span-full text-center text-muted-foreground py-8",children:"请先选择项目及区域"}),p.length>0&&y.jsx("div",{className:"flex-1 grid grid-cols-1 gap-1.5 bg-white p-2 rounded-xl camera_list",ref:v,children:p.map(E=>y.jsx(_,{camera:E},E.id))})]})},xi=_t.memo(vi),yi=[{id:"1",name:"demo",description:"这是一个pdf表单模板。",creator:"张三",createdAt:"2024-01-15",path:"/pdf/demo.pdf"},{id:"2",name:"合同模板.pdf",description:"这是一个文档简介。",creator:"张三",createdAt:"2024-01-10",path:"/pdf/ht.pdf"},{id:"3",name:"合同模板.pdf",description:"这是一个文档简介。",creator:"张三",createdAt:"2024-01-08",path:"/pdf/ht.pdf"},{id:"4",name:"合同模板.pdf",description:"这是一个文档简介。",creator:"张三",createdAt:"2024-01-05",path:"/pdf/ht.pdf"},{id:"5",name:"合同模板.pdf",description:"这是一个文档简介。",creator:"张三",createdAt:"2024-01-03",path:"/pdf/ht.pdf"}],Ei=()=>{const O=mt(),[D,A]=R.useState(""),j=v=>{O({pathname:"/app/report-detail",search:"?fileUrl="+v.path+"&fileName="+v.name})},N=D.toLowerCase(),V=yi.filter(v=>v.name.toLowerCase().includes(N)||v.description.toLowerCase().includes(N)||v.creator.toLowerCase().includes(N));return y.jsxs("div",{className:"flex flex-col gap-0 h-full",children:[y.jsx("div",{className:"flex gap-2 p-4 h-[72px]",children:y.jsx(wt,{placeholder:"搜索",value:D,onChange:v=>A(v.target.value)})}),y.jsx("div",{className:"grid grid-cols-1 p-4 gap-2.5 overflow-auto scroll-smooth",children:V.map(v=>y.jsxs(yt,{className:"hover:shadow-lg transition-shadow",onClick:()=>j(v),children:[y.jsxs(Ir,{children:[y.jsx(Mr,{className:"text-xl",children:v.name}),y.jsx(Pr,{className:"text-sm text-muted-foreground",children:v.description})]}),y.jsx(Dr,{children:y.jsxs("div",{className:"flex flex-row justify-between",children:[y.jsxs("div",{className:"flex items-center text-sm",children:[y.jsx(ln,{className:"w-4 h-4 text-muted-foreground"}),y.jsx("span",{className:"ml-2 font-medium",children:v.creator})]}),y.jsxs("div",{className:"flex items-center text-sm",children:[y.jsx(Rr,{className:"w-4 h-4 text-muted-foreground"}),y.jsx("span",{className:"ml-2 font-medium",children:v.createdAt})]})]})})]},v.id))})]})},Xi=()=>{const O=mt(),[D,A]=R.useState("tasks"),[j,N]=R.useState(!0),V=R.useRef(null),v=R.useRef(0),g=R.useRef(!1),[h,x]=R.useState(0),f=R.useCallback(n=>{N(n)},[]),l=localStorage.getItem("projectId");R.useEffect(()=>{l||(localStorage.removeItem("projectId"),localStorage.removeItem("projectName"),localStorage.removeItem("ACCESS_TOKEN"),localStorage.removeItem("ACCESS_USER_ID"),localStorage.removeItem("REFRESH_TOKEN"),O({to:"/login"}))},[l]);const a=R.useCallback(n=>{console.log("更新任务计数:",n),x(n)},[]),d=R.useMemo(()=>{switch(D){case"tasks":return y.jsx(hn,{setShowBottomNavGlobal:f,updateTaskCount:a});case"gis":return y.jsx(En,{});case"monitor":return y.jsx(xi,{setShowBottomNavGlobal:f});case"reports":return y.jsx(Ei,{});default:return null}},[D,a]),r=()=>{if(!V.current)return;const n=V.current.scrollTop,u=n>v.current?"down":"up";Math.abs(n-v.current)>50&&(N(u==="up"),v.current=n)};return R.useEffect(()=>{if(g.current)return;g.current=!0;let n=null;const u=async()=>{try{console.log("mag_config2",n),await Et(n==null?void 0:n.apiKey),console.log("天地图库预加载成功"),setTimeout(()=>{console.log("销毁地图实例"),window.T.Map=null,window.T=null},500)}catch(e){console.warn("天地图库预加载失败:",e)}};(async()=>{let e=await bt();e.reverse();for(let s=0;s<e.length;s++)if(e[s].mapType==="1"){n={apiKey:e[s].mapApiKey,center:{lat:e[s].defaultCenterLatitude,lng:e[s].defaultCenterLongitude},zoom:7};break}console.log("mag_config",n),u()})()}),y.jsxs("div",{className:"flex flex-col h-screen bg-[#f5f6f8] overflow-hidden",children:[y.jsx("div",{className:"flex-none",children:y.jsx(fn,{activeTab:D,onTabChange:A,taskCount:h})}),y.jsx("div",{ref:V,className:ye("flex-1 min-w-[80px] sm:px-6 sm:py-2 text-gray-500 rounded-lg text-sm  touch-pan-y",D=="gis"?"overflow-hidden":"overflow-auto"),onScroll:r,style:{scrollSnapType:"y mandatory",overscrollBehavior:"contain"},children:y.jsx("div",{className:ye("min-h-full",D=="tasks"?"bg-white":""),children:d})}),j&&D!=="gis"&&y.jsx(nn,{})]})};export{Xi as default};
