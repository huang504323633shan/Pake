import{c as j,x as w,u as N,r as d,j as e,t as n}from"./index-CBGP0-9V.js";import y from"./PDFViewer-BNj8F3Q-.js";import{B as m}from"./button-CiArJRhC.js";import{p as b,c as S}from"./public-DIX_InEl.js";import{C as k}from"./chevron-left-BTOK750O.js";import{S as R}from"./save-ry2PriRR.js";import{C as x}from"./check-4WT4jp_I.js";import"./request-CRuLXg2Q.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],D=j("upload",C),L=()=>{const[r]=w(),i=N(),c=d.useRef(null),[l,o]=d.useState(!1),[u,f]=d.useState(1),h=()=>{f(1),o(!0)},p=()=>{f(2),o(!0)},v=async()=>{var a;if(!((a=c.current)!=null&&a.contentWindow))throw new Error("PDFViewer 引用无效");try{let s=await c.current.contentWindow.getFormData();if(console.log("表单数据:",s),s&&s.canSend){let t=s.fields;return t.push({name:"taskId",value:r.get("taskId")}),console.log("表单数据:",t),t}else return!1}catch(s){throw console.error("获取表单数据失败:",s),s}},g=async a=>{if(a)try{console.log("上传数据:",a);let s;u===1?await b(a).then(t=>{console.log("上传结果:",s),n({description:e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[200px] min-h-[100px]",children:[e.jsx(x,{className:"w-10 h-10 mb-1"}),e.jsx("span",{className:"text-lg font-medium",children:"成功"})]}),variant:"default",duration:1e3}),setTimeout(()=>{i(-1)},1e3)}).catch(t=>{console.log("保存失败:",t),n({variant:"destructive",title:"保存失败",description:t.message||"保存失败"})}):await S(a).then(t=>{console.log("上传结果:",s),n({description:e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[200px] min-h-[100px]",children:[e.jsx(x,{className:"w-10 h-10 mb-1"}),e.jsx("span",{className:"text-lg font-medium",children:"成功"})]}),variant:"default",duration:1e3}),setTimeout(()=>{i(-1)},1e3)}).catch(t=>{console.log("保存失败:",t),n({variant:"destructive",title:"提交失败",description:t.message||"提交失败"})})}catch(s){console.error("保存失败:",s),n({variant:"destructive",title:"操作失败",description:s||"操作失败"})}finally{o(!1)}else o(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col h-screen bg-[#f5f6f8]",children:[e.jsxs("header",{className:"flex items-center px-4 py-3 border-b",children:[e.jsx(m,{variant:"outline",size:"icon",className:"border-0 rounded-full",onClick:()=>i(-1),children:e.jsx(k,{className:"h-6 w-6"})}),e.jsx("div",{className:"flex-1 flex justify-center space-x-4",children:r.get("fileName")}),r.get("saveButton")==1&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(m,{className:"bg-black hover:bg-gray-800 text-white px-4",onClick:h,disabled:l,children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),l?"Saving...":"保存"]}),e.jsxs(m,{className:"bg-black hover:bg-gray-800 text-white px-4",onClick:p,disabled:l,children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),l?"Saving...":"提交"]})]})]}),e.jsx("div",{className:"w-full flex-1",children:e.jsx(y,{ref:c,fileUrl:r.get("fileUrl"),fileName:r.get("fileName"),taskId:r.get("taskId"),onSaveRequest:l?async()=>{const a=await v();return g(a),a}:void 0})})]})})};export{L as default};
