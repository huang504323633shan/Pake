import{r as s,u as S,j as e,X as k,t as o}from"./index-CBGP0-9V.js";import{S as I}from"./public-DIX_InEl.js";import{g as L,v as D}from"./user-BeTEafWb.js";import{C as T}from"./chevron-left-BTOK750O.js";import"./request-CRuLXg2Q.js";function P(){const l=s.useRef(!1),c=S(),[a,d]=s.useState(""),[x,m]=s.useState(!1),[h,n]=s.useState(!1),[p,u]=s.useState(0),[g,r]=s.useState(!1),[j,f]=s.useState(""),[i,v]=s.useState({nickname:"",email:"",mobile:"",telephoneCode:"",avatar:"",deptNames:[],userPosition:[],companyName:""}),N=async()=>{I({mobile:i.mobile,telephoneCode:i.telephoneCode,scene:10}).then(async t=>{u(60),f("验证码已发送"),r(!0),setTimeout(()=>r(!1),2e3);const E=setInterval(()=>{u(b=>b<=1?(clearInterval(E),n(!1),0):b-1)},1e3)}).catch(t=>{console.log("短信发送失败",t),n(!1),o({variant:"destructive",title:"短信发送失败",description:(t==null?void 0:t.msg)||"短信发送失败",duration:1e3})})},w=async()=>{try{const t=await L();v(t)}catch(t){o({variant:"destructive",title:"获取数据失败",description:(t==null?void 0:t.msg)||"获取数据失败",duration:1e3})}};s.useEffect(()=>{if(!l.current){l.current=!0;let t=JSON.parse(localStorage.getItem("USER_INFO"));t&&t.mobile?v(t):w()}},[]);const C=async()=>{if(!h)try{n(!0),N()}catch{n(!1),f("发送失败，请重试"),r(!0),setTimeout(()=>r(!1),2e3)}},y=async()=>{if(a)try{m(!0),await D({mobile:i.mobile,code:a})?c("/app/new-phone"):o({variant:"destructive",title:"验证失败",description:"验证失败",duration:1e3})}catch{o({variant:"destructive",title:"验证失败",description:"验证失败",duration:1e3})}finally{m(!1)}};return e.jsxs("div",{className:"min-h-[100dvh] bg-white",children:[e.jsx("div",{className:"flex items-center px-3 py-4",children:e.jsx(T,{className:"w-6 h-6",onClick:()=>c(-1)})}),e.jsxs("div",{className:"px-5",children:[e.jsx("div",{className:"flex-1 text-left text-[18px] mb-2 mt-4 font-bold font-[600]",children:"更换手机号"}),e.jsx("div",{className:"text-[13px] text-[#999999] mb-8 ",children:"为保障您的账号安全，请进行安全验证，以确保是您本人在操作"}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#0363E0] text-white flex items-center justify-center text-[12px]",children:"1"}),e.jsx("span",{className:"ml-1 text-[14px]",children:"验证"})]}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 12L10 8L6 4",stroke:"#CCCCCC",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("div",{className:"flex items-center opacity-50",children:[e.jsx("div",{className:"w-5 h-5 rounded-full bg-[#999999] text-white flex items-center justify-center text-[12px]",children:"2"}),e.jsx("span",{className:"ml-1 text-[14px]",children:"绑定"})]})]}),e.jsxs("div",{className:"text-[14px] text-[#333333] mb-6",children:[i.telephoneCode," ",i.mobile]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-[14px] text-[#333333] mb-1",children:"验证码"}),e.jsxs("div",{className:"flex items-end gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:a,onChange:t=>d(t.target.value),placeholder:"请输入验证码",maxLength:6,className:"w-full h-12 bg-white text-[14px] placeholder:text-[#999999] placeholder:text-[12px] border-b border-[#EEEEEE] focus:border-[#0363E0] focus:outline-none transition-colors pr-8"}),a&&e.jsx(k,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-[#999999] cursor-pointer",onClick:()=>d("")})]}),e.jsx("button",{className:"h-[30px] px-3 text-[14px] text-[#333333] disabled:text-[#999999] whitespace-nowrap border border-[#EEEEEE] rounded",onClick:C,disabled:h,children:p>0?`${p}s后重新获取`:"获取验证码"})]})]}),e.jsx("button",{className:"w-full h-[35px] bg-[#0D0D0D] text-white rounded-full text-[14px] font-medium disabled:opacity-50 disabled:cursor-not-allowed",onClick:y,disabled:!a||x,children:"下一步"})]}),g&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"bg-[#666666] text-white px-6 py-3 rounded-lg text-[14px]",children:x?"密码重置中，请稍候...":j})})]})}export{P as default};
