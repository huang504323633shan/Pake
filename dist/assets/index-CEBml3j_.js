import{c as he,j as e,u as je,r as t,a as ee,X as ce,t as ae}from"./index-CBGP0-9V.js";import{f as Ce,c as me}from"./publicFun-CiZ9vL8Y.js";import{u as Se,a as ke}from"./uiStore-BW39O6R7.js";import{F as Le,I as Fe,b as De,c as Ge,A as Ie,a as _e,d as Te}from"./task-status-C8h5zVQz.js";import{A as Ae,a as Oe,b as Me}from"./avatar-CZoOSk0v.js";import{C as se}from"./index-DCyT9wRJ.js";import{D as Pe}from"./date-picker-Bebv3-qP.js";import{S as Ve,b as ze,a as He,f as Ue}from"./sheet-DoL-zHHZ.js";import{B as xe}from"./button-CiArJRhC.js";import{i as we,j as Be,k as Re,l as $e}from"./task-CaSVpYz-.js";import{S as ie}from"./search-DxQ-bB_0.js";import{C as X}from"./check-4WT4jp_I.js";import{d as Ze,i as We,g as qe}from"./public-DIX_InEl.js";import{P as Je}from"./plus-CHP_XERv.js";/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Xe=he("calendar",Qe);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],re=he("chevron-up",Ke);/**
 * @license lucide-react v0.488.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],be=he("funnel",Ye);function es({task:a}){const _=a.participantsAvatarList.slice(0,3),h=a.participantsAvatarList.length-3,v=a.title.match(/^(.*?)(\s*\[(\d+)\])?$/),L=v?v[1]:a.title,x=v&&v[3]?v[3]:null,n=["image","png","jpg","jpeg","gif","webp","bmp"];return e.jsxs("div",{className:"rounded-xl bg-white shadow-none p-4 mb-4 w-full max-w-full overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between mb-2 w-full max-w-full min-w-0",children:[e.jsxs("div",{className:"flex items-center min-w-0 mr-2 flex-1",children:[a.isNew>0&&e.jsx("span",{className:"rounded-[15px] border px-4 py-1 text-sm text-white bg-[#010a1a] mr-2 flex-shrink-0",children:"新"}),e.jsx("h3",{className:"font-semibold text-lg text-black break-words min-w-0 max-w-full",children:L}),x&&e.jsx("span",{className:"ml-2 bg-blue-500 text-white rounded-full px-2 text-xs font-bold flex-shrink-0",children:x})]}),e.jsxs("div",{className:"flex -space-x-2 justify-end items-start flex-shrink-0 ml-2  min-w-0 ",children:[_.map((w,p)=>e.jsx("div",{className:"w-6 h-6 ml-[-6px] rounded-full bg-[#EEEEEE] flex items-center justify-center text-xs border-2 border-[#d4d4d4] text-gray-700 font-bold flex-shrink-0",children:e.jsxs(Ae,{className:"w-full h-full object-cover",children:[e.jsx(Oe,{src:w||Se}),e.jsx(Me,{children:w==null?void 0:w.slice(0,1)})]},"mem"+p)},p)),h>0&&e.jsxs("div",{className:"w-6 h-6 ml-[-6px] rounded-full bg-[#EEEEEE] flex items-center justify-center text-xs border-2 border-[#d4d4d4] text-gray-500 flex-shrink-0",children:["+",h]})]})]}),e.jsx("p",{className:"text-gray-400 text-base mb-3 line-clamp-3 break-words min-w-0 w-full overflow-hidden ",children:a.description}),e.jsxs("div",{className:"flex items-center mb-3 space-x-2",children:[a.attachmentList.map((w,p)=>{const C=w.toLowerCase(),g=C.endsWith(".pdf"),j=n.some(F=>C.endsWith(`.${F}`));return e.jsx("div",{className:"shrink-0",children:g?e.jsx("div",{className:"flex items-center justify-center w-6 h-6 bg-red-100 rounded",children:e.jsx(Le,{className:"w-4 h-4 text-red-500"})}):j?e.jsxs(Fe,{className:"w-6 h-6 rounded object-cover border border-gray-200",children:[e.jsx(De,{src:w}),e.jsx(Ge,{})]},"fimg"+p):null},p)}),a.subtasks>0&&e.jsxs("span",{className:"text-blue-500 text-sm font-medium",children:["+",a.subtasks,"个子任务"]})]}),e.jsx("div",{className:"border-t border-[#EEEEEE] pt-3 mt-2",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-400 font-normal",children:"进度"}),e.jsxs("span",{className:"text-sm text-blue-500 font-bold",children:[a.progress,"%"]}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-normal bg-gray-100 text-gray-650",children:a.progress==="10O"||(a==null?void 0:a.approvalStatus)==3?"已完成":"进行中"}),e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-normal bg-gray-100 text-gray-650",children:Ie[a==null?void 0:a.approvalStatus]}),(a==null?void 0:a.isyq)==="1"&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full font-normal bg-gray-100 text-gray-650",children:"延期"})]})})}),e.jsxs("div",{className:"text-sm text-gray-400 mt-2 tracking-wide font-medium",children:["截止: ",Ce((a==null?void 0:a.date)||"")]})]})}function ss({taskGroups:a,searchTerm:E}){const _=je(),[h,v]=t.useState({epc:!0,quality:!1,safety:!1,operation:!1}),L=x=>{v(n=>({...n,[x]:!n[x]}))};return e.jsx("div",{className:"task_page w-full",children:a.map(x=>e.jsxs("div",{className:"w-full bg-white border-b border-[#EEEEEE]",children:[e.jsxs("div",{className:"ml-4 mr-4  w-[calc(100%-2rem)] flex items-center justify-between cursor-pointer py-2",onClick:()=>L(x.taskGroupName),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-bold text-base text-[#1E2939]",children:x.taskGroupName}),e.jsxs("span",{className:ee("ml-2 text-sm",x.taskDOList.some(n=>n.isNew)?"text-[#0363E0]":"text-[#999999]"),children:["(",x.taskGroupSize,")"]})]}),h[x.taskGroupName]?e.jsx(re,{className:"h-5 w-5 text-[#999999]"}):e.jsx(se,{className:"h-5 w-5 text-[#999999]"})]}),h[x.taskGroupName]&&e.jsx("div",{className:"bg-[#F5F6F8] p-3 rounded-xl  w-full max-w-[100vw] overflow-hidden",children:x.taskDOList.filter(n=>n.title.toLowerCase().includes(E.toLowerCase())||n.description.toLowerCase().includes(E.toLowerCase())).map(n=>e.jsx("div",{className:"mb-3 last:mb-0 w-full",onClick:()=>_(`/app/task/detail/${n.id}`),children:e.jsx(es,{task:n})},n.id))})]},"tl"+x.id+"_"+x.taskGroupName))})}function ts({onClose:a,onApply:E,selectedGroups:_,selectedDateRange:h,selectedProject:v,taskGroups:L,projectList:x,selectedLoginUser:n}){const[w,p]=t.useState(!0),[C,g]=t.useState(L),[j,F]=t.useState(_||["全部"]),[T,$]=t.useState(h),[c,te]=t.useState(v),[Z,D]=t.useState(!1),[y,W]=t.useState(!1),[K,q]=t.useState(""),[oe,P]=t.useState(h||"起始日期-结束日期"),V=x.filter(r=>r.name.toLowerCase().includes(K.toLowerCase())),[i,A]=t.useState(n),[J,O]=t.useState(!1);t.useEffect(()=>{const r=localStorage.getItem("projectId");if(r&&x&&!c){console.log("项目ID:",r);const o=x.find(s=>s.id==r);console.log("matchedProject"),console.log(o),o&&(te(o),console.log("setSelectedProject:",c))}},[x]),t.useEffect(()=>{(async()=>{if(c&&c.id){const o=await we({projectId:c.id});g(o||[]),F(["全部"])}})()},[c]);const z=r=>{if(r==="全部")j.includes("全部")?F([]):F(["全部"]);else if(j.includes(r))F(j.filter(o=>o!==r));else{const o=j.filter(s=>s!=="全部");F([...o,r])}},b=()=>{F(["全部"]),A(""),$(""),P("起始日期-结束日期")},G=()=>{console.log("selectedGroups:",j),console.log("selectedDateRange:",T),console.log("selectedProject:",c),console.log("selectedLoginUser:",i),localStorage.setItem("projectId",(c==null?void 0:c.id)||""),localStorage.setItem("projectName",(c==null?void 0:c.name)||""),E(j,T,c,i)},H=r=>{te(r),D(!1)},Y=r=>{$(r),P(r),W(!1)},N=()=>{T==="近一周"?$(""):($("近一周"),P("近一周"))};return e.jsxs(Ve,{open:w,onOpenChange:p,children:[e.jsx(ze,{asChild:!0,children:e.jsx(xe,{variant:"outline",size:"icon",className:"p-2.5",children:e.jsx(be,{})})}),e.jsxs(He,{side:"bottom",className:"rounded-t-xl max-w-md mx-auto transition-all duration-300 bg-white",hideClose:!0,onInteractOutside:a,children:[e.jsx(Pe,{isOpen:y,onClose:()=>W(!1),onSelect:Y,position:"bottom"}),e.jsxs("div",{className:" flex flex-col tracking-wide",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 border-b border-[#E8E8E8]",children:[e.jsx("h2",{className:"text-lg font-medium",children:"筛选"}),e.jsx(Ue,{onClick:a,children:e.jsx(ce,{className:"h-5 w-5 text-[#6A7282]"})})]}),e.jsx("div",{className:"h-[70vh] overflow-y-auto  p-3",children:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 relative",children:[e.jsxs("div",{className:"border border-[#E8E8E8] rounded-lg p-2 flex justify-between items-center mb-2",onClick:()=>{D(!Z),O(!1)},children:[e.jsx("span",{className:"text-gray-700",children:(c==null?void 0:c.name)||"请选择项目"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsx(se,{className:"h-4 w-4 text-gray-400 -mt-1"})]})]}),Z&&e.jsxs("div",{className:"absolute z-50 left-0 right-0 mt-1 border border-[#E8E8E8] rounded-lg overflow-hidden bg-white shadow-lg",children:[e.jsxs("div",{className:"p-3 border-b border-[#E8E8E8] flex items-center",children:[e.jsx(ie,{className:"h-5 w-5 text-[#6A7282] mr-2"}),e.jsx("input",{type:"text",placeholder:"请搜索你想要的内容",className:"w-full outline-none  text-[#6A7282]",value:K,onChange:r=>q(r.target.value)})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:V.length>0?V.map(r=>e.jsxs("div",{className:`p-3 flex justify-between items-center ${(c==null?void 0:c.id)===r.id?"bg-[#F5F6F8]":""}`,onClick:()=>H(r),children:[e.jsx("span",{className:`${r.name.length>20?"line-clamp-2":""}`,children:r.name}),(c==null?void 0:c.id)===r.id&&e.jsx("div",{className:"w-6 h-6 bg-[#0363E0] rounded-full flex items-center justify-center",children:e.jsx(X,{className:"h-4 w-4 text-white"})})]},r.id)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"没有找到相关结果"})})]})]}),e.jsxs("div",{className:"mb-4 relative",children:[e.jsxs("div",{className:"border rounded-lg p-2 flex justify-between items-center mb-2",onClick:()=>{O(!J),D(!1)},children:[e.jsx("span",{className:"text-gray-700",children:i==="1"?"我执行的任务":i==="2"?"我审核的任务":i==="3"?"我创建的任务":i==="4"?"与我相关的任务":i==="5"?"我审批的拒绝任务":i==="6"?"与我相关的拒绝任务":i==="7"?"全部拒绝任务":"全部任务"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsx(se,{className:"h-4 w-4 text-gray-400 -mt-1"})]})]}),J&&e.jsx("div",{className:"absolute z-50 left-0 right-0 mt-1 border rounded-lg overflow-hidden bg-white shadow-lg",children:e.jsx("div",{className:"max-h-60 overflow-y-auto",children:["全部任务","我执行的任务","我审核的任务","我创建的任务","与我相关的任务","我审批的拒绝任务","与我相关的拒绝任务","全部拒绝任务"].map((r,o)=>e.jsxs("div",{className:`p-3 flex justify-between items-center ${o===0&&i===""||o===1&&i==="1"||o===2&&i==="2"||o===3&&i==="3"||o===4&&i==="4"||o===5&&i==="5"||o===6&&i==="6"||o===7&&i==="7"?"bg-gray-100":""}`,onClick:()=>{A(o===0?"":String(o)),O(!1)},children:[e.jsx("span",{children:r}),o===0&&i===""||o===1&&i==="1"||o===2&&i==="2"||o===3&&i==="3"||o===4&&i==="4"||o===5&&i==="5"||o===6&&i==="6"||o===7&&i==="7"?e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"h-4 w-4 text-white"})}):null]},`login_user_${o}`))})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-base font-medium mb-2",children:"业务域"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[C.map(r=>e.jsxs("button",{className:`p-2 border border-[#E8E8E8] rounded-lg flex justify-between items-center ${j.includes(r.key)?"bg-[#F5F6F8] border-[#0363E0] text-[#0363E0]":""}`,onClick:()=>z(r.key),children:[e.jsx("span",{children:r.value}),j.includes(r.key)&&e.jsx("div",{className:"w-5 h-5 bg-[#0363E0] rounded-full flex items-center justify-center",children:e.jsx(X,{className:"h-3 w-3 text-white"})})]},"filter_group_"+r.key)),e.jsxs("button",{className:`p-2 border border-[#E8E8E8] rounded-lg flex justify-between items-center ${j.includes("全部")?"bg-[#F5F6F8] border-[#0363E0] text-[#0363E0]":""}`,onClick:()=>z("全部"),children:[e.jsx("span",{children:"全部"}),j.includes("全部")&&e.jsx("div",{className:"w-5 h-5 bg-[#0363E0] rounded-full flex items-center justify-center",children:e.jsx(X,{className:"h-3 w-3 text-white"})})]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h3",{className:"text-base font-medium mb-2",children:"日期"}),e.jsxs("button",{className:"w-full border border-[#E8E8E8] rounded-lg p-3 flex justify-between items-center",onClick:()=>W(!0),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Xe,{className:"h-5 w-5 text-[#6A7282] mr-2"}),e.jsx("span",{className:" text-[#6A7282] ",children:oe})]}),e.jsx(se,{className:"h-5 w-5 text-[#6A7282]"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-3",children:e.jsxs("button",{className:`p-2 border border-[#E8E8E8] rounded-lg flex justify-between items-center ${T==="近一周"?"bg-[#F5F6F8] border-[#0363E0] text-[#0363E0]":""}`,onClick:N,children:[e.jsx("span",{children:"近一周"}),T==="近一周"&&e.jsx("div",{className:"w-5 h-5 bg-[#0363E0] rounded-full flex items-center justify-center",children:e.jsx(X,{className:"h-3 w-3 text-white"})})]})})]})]})}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx(xe,{variant:"outline",className:"flex-1 mr-4 rounded-4xl border-[#E8E8E8] ",onClick:b,children:"重置"}),e.jsx(xe,{className:"flex-1 bg-black hover:bg-black text-white  rounded-4xl",onClick:G,children:"确定"})]})})]})]})]})}function ls(){return e.jsxs("div",{className:"flex flex-col items-center justify-center h-50",children:[e.jsx("div",{className:"w-24 h-24 rounded-full flex items-center justify-center mb-4",children:e.jsxs("svg",{width:"210",height:"200",viewBox:"0 0 210 200",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("mask",{id:"mask0_565_1125",maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"200",height:"200",children:e.jsx("circle",{cx:"100",cy:"100",r:"100",fill:"url(#paint0_linear_565_1125)"})}),e.jsxs("g",{mask:"url(#mask0_565_1125)",children:[e.jsx("circle",{cx:"101",cy:"100",r:"100",fill:"url(#paint1_linear_565_1125)"}),e.jsx("rect",{x:"29",y:"38",width:"144",height:"233",rx:"23",fill:"#FEFEFE",stroke:"#C9D1D1",strokeWidth:"6"}),e.jsx("path",{d:"M152 74C154.209 74 156 75.7909 156 78V90C156 92.2091 154.209 94 152 94H50C47.7909 94 46 92.2091 46 90V78C46 75.7909 47.7909 74 50 74H152Z",fill:"#F0F2F2"}),e.jsx("path",{d:"M112 113C114.209 113 116 114.791 116 117V129C116 131.209 114.209 133 112 133H50C47.7909 133 46 131.209 46 129V117C46 114.791 47.7909 113 50 113H112Z",fill:"#F0F2F2"}),e.jsx("path",{d:"M90 153C92.2091 153 94 154.791 94 157V169C94 171.209 92.2091 173 90 173H50C47.7909 173 46 171.209 46 169V157C46 154.791 47.7909 153 50 153H90Z",fill:"#F0F2F2"})]}),e.jsx("rect",{x:"134.5",y:"108.5",width:"73",height:"29",rx:"5.5",fill:"white",stroke:"#C9D1D1",strokeWidth:"5"}),e.jsx("rect",{x:"134.5",y:"146.5",width:"73",height:"29",rx:"5.5",fill:"white",stroke:"#C9D1D1",strokeWidth:"5"}),e.jsx("path",{d:"M150 119C151.105 119 152 119.895 152 121V125C152 126.105 151.105 127 150 127H146C144.895 127 144 126.105 144 125V121C144 119.895 144.895 119 146 119H150ZM172 119C173.105 119 174 119.895 174 121V125C174 126.105 173.105 127 172 127H156C154.895 127 154 126.105 154 125V121C154 119.895 154.895 119 156 119H172Z",fill:"#181C1C"}),e.jsx("path",{d:"M150 157C151.105 157 152 157.895 152 159V163C152 164.105 151.105 165 150 165H146C144.895 165 144 164.105 144 163V159C144 157.895 144.895 157 146 157H150ZM172 157C173.105 157 174 157.895 174 159V163C174 164.105 173.105 165 172 165H156C154.895 165 154 164.105 154 163V159C154 157.895 154.895 157 156 157H172Z",fill:"#181C1C"}),e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"paint0_linear_565_1125",x1:"100",y1:"0",x2:"100",y2:"200",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{stopColor:"#F7F7F7"}),e.jsx("stop",{offset:"1",stopColor:"#EBEBEB"})]}),e.jsxs("linearGradient",{id:"paint1_linear_565_1125",x1:"101",y1:"0",x2:"101",y2:"200",gradientUnits:"userSpaceOnUse",children:[e.jsx("stop",{stopColor:"#F7F7F7"}),e.jsx("stop",{offset:"1",stopColor:"#EBEBEB"})]})]})]})}),e.jsx("p",{className:"text-gray-400",children:"无内容"})]})}function as({isOpen:a=!1,onClose:E=()=>{},onCreateTask:_=L=>{},projectList0:h,newProject:v={}}){var ge;t.useRef(!1);const L=je(),[x,n]=t.useState("direct"),[w,p]=t.useState(!1),[C,g]=t.useState([]),[j,F]=t.useState(!1),[T,$]=t.useState(""),[c,te]=t.useState(""),[Z,D]=t.useState([]),[y,W]=t.useState(null),[K,q]=t.useState(!1),[oe,P]=t.useState(!1),[V,i]=t.useState([]),[A,J]=t.useState(),[O,z]=t.useState([]),[b,G]=t.useState(),[H,Y]=t.useState([]),[N,r]=t.useState(),[o,s]=t.useState(!1),[u,d]=t.useState(""),[S,I]=t.useState(""),[U,m]=t.useState(!1),[f,k]=t.useState(()=>{const l=localStorage.getItem("projectId");let M=null;return l&&(M=C.find(Q=>String(Q.id)===l)),M||null});t.useEffect(()=>{(async()=>{if(y&&y.companyCode)try{const Q=(await We({companyCode:y.companyCode})).map(le=>({id:le.id,name:le.projectName}));g(Q);const ne=localStorage.getItem("projectId");if(ne){const le=Q.find(Ee=>String(Ee.id)===ne);le&&k(le)}}catch{ae({variant:"destructive",title:"获取项目列表失败"})}else g([]),k(null)})()},[y]),t.useEffect(()=>{console.log("projectList00",h),console.log("projectList",C);const l=localStorage.getItem("projectId");let M=null;const Q=C.length>0?C:h||[];console.log("newprojectList",Q),l&&(M=Q.find(ne=>String(ne.id)===l)),M&&k(M)},[C,h,v]),C.filter(l=>l.name.toLowerCase().includes(c.toLowerCase())),t.useEffect(()=>{a?(console.log("projectList0",h),B()):(console.log("isOpen",a),G(void 0))},[a]);const B=async()=>{try{const l=await Be({});D(l)}catch{ae({variant:"destructive",title:"获取组织列表失败"})}};Z.filter(l=>l.companyName.toLowerCase().includes(T.toLowerCase())),V.filter(l=>l.categoryName.toLowerCase().includes(c.toLowerCase()));const R=t.useMemo(()=>H&&H.length>0?H.filter(l=>l.name.toLowerCase().includes(u.toLowerCase())):[],[H,u]),de=t.useMemo(()=>(console.log("过滤模板？"),console.log(O),O.filter(l=>l.templateName.toLowerCase().includes(S.toLowerCase()))),[O,S,y]),ue=l=>{l==="template"?(G(void 0),n("template"),p(!0)):(n("direct"),L("/app/task/create"))},fe=()=>{p(!1),m(!1),q(!1),P(!1),s(!1),G(void 0)},Ne=()=>{z([]),G(void 0),W(null),k(null),J(void 0)},ve=()=>{if(!f){ae({variant:"destructive",title:"请先选择项目",className:"toast-center",duration:2e3});return}let l=f;if(!N||!b){ae({variant:"destructive",title:"请选择任务模板",className:"toast-center",duration:2e3});return}L("/app/task/create",{state:{project:{id:l.id,name:l.name},group:N,template:{id:b.id,url:b.uploadedPdf,name:b.templateName}}}),fe()};t.useEffect(()=>{console.log("selectedProject"),console.log(f),console.log("selectedProject")},[f,N]),t.useEffect(()=>{f&&f.id?Ze({projectId:f.id,pageNo:1,pageSize:100}).then(l=>{Y(l.list||l||[]),r(void 0)}):(Y([]),r(void 0))},[f]),t.useEffect(()=>{console.log("selectedGroup"),console.log(N),console.log("selectedGroup"),N?(console.log("进来了没"),ye(),G(void 0)):(console.log("else"),z([]),G(void 0))},[N]);const ye=async()=>{const l={projectId:f.id,taskGroup:N},M=await Re(l);console.log("接口获取的值"),console.log(M),G(void 0),z(M)},pe=()=>{p(!1),n("direct"),E()};return e.jsxs("div",{className:ee("fixed flex items-end justify-center sm:items-center inset-0",a?"z-50 opacity-100 ":"opacity-0 z-0  pointer-events-none "),onClick:pe,children:[a&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.5)",zIndex:9999}}),!w&&e.jsxs("div",{className:ee("bg-white rounded-t-lg sm:rounded-lg w-full max-w-md overflow-hidden","transform transition-transform duration-300  ease-out",a?"translate-y-0":"translate-y-full"),style:{position:"fixed",zIndex:1e4,left:0,right:0,margin:"auto"},onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-center items-center py-4 relative border-b border-[#EEEEEE]",children:[e.jsx("h2",{className:"text-lg font-bold text-black",children:"任务创建"}),e.jsx("button",{onClick:pe,className:"absolute right-4 top-4 text-[#6A7282] hover:text-gray-700",children:e.jsx(ce,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"p-4 grid grid-cols-2 gap-4",children:[e.jsxs("button",{className:ee("flex flex-col items-center justify-center p-6 border rounded-lg transition-all",x==="template"?"border-[#0363E0] bg-[#E6F0FF]":"border-[#E8E8E8] hover:border-[#E8E8E8]"),onClick:()=>ue("template"),children:[e.jsx("div",{className:"w-12 h-12 mb-3 flex items-center justify-center",children:e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-10 h-10 text-[#2B7FFF] fill-current",children:[e.jsx("rect",{x:"4",y:"2",width:"10",height:"14",rx:"1",fill:"currentColor",fillOpacity:"0.2"}),e.jsx("rect",{x:"7",y:"5",width:"10",height:"14",rx:"1",fill:"currentColor",fillOpacity:"0.2"}),e.jsx("rect",{x:"10",y:"8",width:"10",height:"14",rx:"1",fill:"currentColor"})]})}),e.jsx("span",{className:"text-base",children:"模版创建"})]}),e.jsxs("button",{className:ee("flex flex-col items-center justify-center p-6 border rounded-lg transition-all",x==="direct"?"border-[#0363E0] bg-[#E6F0FF]":"border-[#E8E8E8] hover:border-[#E8E8E8]"),onClick:()=>ue("direct"),children:[e.jsx("div",{className:"w-12 h-12 mb-3 flex items-center justify-center",children:e.jsxs("svg",{viewBox:"0 0 24 24",className:"w-10 h-10 text-[#00C951] fill-current",children:[e.jsx("path",{d:"M5 3C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3H5ZM5 5H19V17H5V5Z",fill:"currentColor",fillOpacity:"0.2"}),e.jsx("path",{d:"M7 7H17V9H7V7ZM7 11H17V13H7V11ZM7 15H14V17H7V15Z",fill:"currentColor"}),e.jsx("path",{d:"M17.5 5.5L19.5 7.5L16.5 10.5L14.5 8.5L17.5 5.5ZM13.5 9.5L15.5 11.5L9.5 17.5H7.5V15.5L13.5 9.5Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"0.5",transform:"translate(6 6) scale(0.9)"})]})}),e.jsx("span",{className:"text-base",children:"直接创建"})]})]})]}),w&&e.jsx("div",{className:ee("fixed inset-0 z-50 flex items-end","transform transition-transform duration-300  ease-out",w?"translate-y-0":"translate-y-full"),style:{zIndex:1e4},onClick:l=>l.stopPropagation(),children:e.jsxs("div",{className:"bg-white rounded-t-xl w-full",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-[#EEEEEE]",children:[e.jsx("h2",{className:"text-lg font-bold  flex-1  text-center text-[#1E2939]",children:"选择模板"}),e.jsx("button",{onClick:fe,children:e.jsx(ce,{className:"h-5 w-5 text-[#6A7282]"})})]}),e.jsxs("div",{className:"p-4 h-[60vh] overflow-y-auto",children:[e.jsxs("div",{className:"mb-6 relative",children:[e.jsxs("div",{className:"border rounded-lg p-3 flex justify-between items-center mb-2 border-[#E8E8E8]",onClick:()=>{s(!o),q(!1),P(!1),m(!1)},children:[e.jsx("span",{className:"text-gray-700",children:N?(ge=H.find(l=>l.id===N))==null?void 0:ge.name:"请选择业务域"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsx(se,{className:"h-4 w-4 text-gray-400 -mt-1"})]})]}),o&&e.jsxs("div",{className:"absolute z-50 left-0 right-0 mt-1 border border-[#E8E8E8] rounded-lg overflow-hidden bg-white shadow-lg",children:[e.jsxs("div",{className:"p-2 border-b flex items-center border-[#E8E8E8]",children:[e.jsx(ie,{className:"h-5 w-5 text-[#6A7282] mr-2"}),e.jsx("input",{type:"text",placeholder:"搜索业务域",className:"w-full outline-none placeholder:text-[#8C8C8C]",value:u,onChange:l=>d(l.target.value)})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:R.length>0?R.map(l=>e.jsxs("div",{className:`p-3 flex justify-between items-center ${N===l.id?"bg-gray-100":""}`,onClick:()=>{r(l.id),s(!1)},children:[e.jsx("span",{children:l.name}),N===l.id&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"h-4 w-4 text-white"})})]},`group_${l.id}`)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"没有找到相关业务域"})})]})]}),e.jsxs("div",{className:"mb-6 relative",children:[e.jsxs("div",{className:"border rounded-lg p-3 flex justify-between items-center mb-2 border-[#E8E8E8]",onClick:()=>{m(!U),q(!1),P(!1),s(!1)},children:[e.jsx("span",{className:"text-gray-700",children:b?b.templateName:"请选择任务模板"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsx(se,{className:"h-4 w-4 text-gray-400 -mt-1"})]})]}),U&&e.jsxs("div",{className:"absolute z-50 left-0 right-0 mt-1 border border-[#E8E8E8] rounded-lg overflow-hidden bg-white shadow-lg",children:[e.jsxs("div",{className:"p-2 border-b flex items-center border-[#E8E8E8]",children:[e.jsx(ie,{className:"h-5 w-5 text-[#6A7282] mr-2"}),e.jsx("input",{type:"text",placeholder:"搜索模板名称...",className:"w-full outline-none placeholder:text-[#8C8C8C]",value:S,onChange:l=>I(l.target.value)})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:de.length>0?de.map(l=>e.jsxs("div",{className:`p-3 flex justify-between items-center ${(b==null?void 0:b.id)===l.id?"bg-gray-100":""}`,onClick:()=>{G(l),m(!1)},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{className:"h-5 w-5 text-gray-500 mr-3"}),e.jsx("span",{className:"truncate max-w-[200px]",children:l.templateName})]}),(b==null?void 0:b.id)===l.id&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"h-4 w-4 text-white"})})]},l.id)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:y&&f&&N?"当前筛选条件下暂无模板":"请先选择业务域"})})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{className:"mr-4 flex-1 p-3 border border-[#E8E8E8] rounded-4xl text-center",onClick:Ne,children:"重置"}),e.jsx("button",{className:"flex-1 p-3 bg-[#0363E0] text-white rounded-4xl text-center",onClick:ve,children:"确定"})]})]})]})})]})}const rs=({searchTerm:a,setSearchTerm:E,clearSearch:_})=>e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute left-3 top-1/3 -translate-y-1/3",children:e.jsx(ie,{className:"w-4 h-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"任务/人员/分组",className:"w-full h-10 pl-10 pr-10 bg-white rounded border border-[#E8E8E8] text-base  placeholder:text-[#8C8C8C] outline-none",value:a,onChange:h=>E(h.target.value),"aria-label":"搜索任务"}),a&&e.jsx("button",{className:"absolute right-3 top-1/4 -translate-y-1/4",onClick:_,"aria-label":"清除搜索",children:e.jsx(ce,{className:"w-5 h-5 text-gray-400"})})]});function os({onScrollDirectionChange:a,updateTaskCount:E}){const _=t.useRef(!1),[h,v]=t.useState(""),[L,x]=t.useState(!1),[n,w]=t.useState(["全部"]),[p,C]=t.useState(""),[g,j]=t.useState(null),[F,T]=t.useState(!1),{setBottomNavVisible:$}=ke(),[c,te]=t.useState([]),Z=t.useRef(0),D=t.useRef(null),[y,W]=t.useState("4"),[K,q]=t.useState(!1),[oe,P]=t.useState(!0),[V,i]=t.useState([]),[A,J]=t.useState([]),[O,z]=t.useState({projectId:"",groups:[],dateRange:"",searchTerm:""}),b=async()=>{qe().then(async s=>{const u=s.map(d=>({id:d.id,name:d.projectName}));te(u)}).catch(s=>{ae({variant:"destructive",title:"获取数据失败",description:(s==null?void 0:s.msg)||"获取数据失败"})})},G=async s=>{const u=(s==null?void 0:s.id)||(g==null?void 0:g.id)||localStorage.getItem("projectId");J([]),i([]),we({projectId:u||""}).then(async d=>{J(d),console.log("getTaskGroupDrop",d),console.log("taskGroupDrop1",A);const S=d.map(I=>({id:I.key,taskGroupName:I.value,code:I.key,taskGroupSize:0,taskDOList:[]}));console.log("formattedData1",S),i(S),console.log("TaskGroups1",V)}).catch(d=>{i([])}).finally(()=>{q(!0)})};t.useEffect(()=>{if(_.current)return;_.current=!0,b(),G();const s=sessionStorage.getItem("taskFilterState");if(console.log("savedState",s),s){const{searchTerm:u,selectedGroups:d,selectedDateRange:S,selectedProject:I,selectedLoginUser:U,filterParams:m}=JSON.parse(s);v(u||""),w(d||["全部"]),C(S||""),j(c.find(f=>f.id===I)||null),W(U?U=="all"?"":U:"4"),z(m)}else{const u=localStorage.getItem("projectId");j(c.find(d=>d.id===u)||null)}},[]);const H=s=>{console.log(`Creating task using ${s} method`),T(!1)},Y=()=>{v("")},N=(s,u,d,S)=>{const I=(g==null?void 0:g.id)!==(d==null?void 0:d.id);w(s),C(u),j(d),W(S),x(!1),I&&G(d),z({projectId:(d==null?void 0:d.id)||"",groups:s,dateRange:u,loginUserJudgment:S})};t.useEffect(()=>{const s={searchTerm:h,selectedGroups:n,selectedDateRange:p,selectedProject:g==null?void 0:g.id,selectedLoginUser:y||"all",filterParams:O};console.log("filterState",s),sessionStorage.setItem("taskFilterState",JSON.stringify(s))},[h,n,p,g,y,O]);const r=async()=>{P(!0);try{let s={};if(p){let m="",f="",k,B;if(p==="近一周"){const R=new Date;m=new Date(R.getTime()-7*24*60*60*1e3).toISOString().slice(0,19),f=R.toISOString().slice(0,19)}else p.includes(" - ")?(k=p.split(" - ")[0],B=p.split(" - ")[1],k&&(m=me(k)),B&&(f=me(B))):(k=p.split("-")[0],k&&(m=me(k)));s={startDate:m,endDate:f}}if(n&&n.length>0&&(n.includes("全部")?s.taskGroupList=[]:s.taskGroupList=n),g)s.projectId=g.id;else{let m=localStorage.getItem("projectId");m&&(s.projectId=m)}y&&(s.loginUserJudgment=y),h&&(s.search=h),console.log("getTaskList2 params",s),console.log("请求接口");const u=await $e(s);console.log("接口返回数据",u);const d=new Map;u.list.forEach(m=>{d.set(String(m.id),m)}),console.log("处理后的数据",d);const S=A.map(m=>{const f=d.get(String(m.key));if(console.log("又处理了一下数据",d),f){const k=(f.taskDOList||[]).map(o).sort((B,R)=>B.isNew!==R.isNew?R.isNew-B.isNew:R.createTime-B.createTime);return{...f,id:String(m.key),taskDOList:k,taskGroupSize:k.length,taskGroupName:m.value}}else return{id:String(m.key),taskGroupName:m.value,code:m.key,taskGroupSize:0,taskDOList:[]}});console.log("formattedData00",S),console.log("selectedGroups00",n);const I=S.filter(m=>n.length===0||n.includes("全部")||n.includes(String(m.id)));console.log("filteredData2",I),i(I),console.log("TaskGroups2",V);let U=0;I.forEach(m=>{(m.taskDOList||[]).forEach(f=>{f.isNew===1&&U++})}),E&&E(U)}catch(s){console.error("获取任务列表失败:",s)}finally{P(!1)}},o=s=>{var u;return{id:s.id,title:s.taskTitle,description:s.taskDescription||"",progress:s.progress||0,status:"",flowStatus:s!=null&&s.flowStatus?Te[s.flowStatus]:"",approvalStatus:s==null?void 0:s.approvalStatus,date:s.endDate||"未设置",members:s.participants?s.participants.split(","):[],attachmentList:s.attachmentList?s.attachmentList:[],subtasks:((u=s.subtaskIdList)==null?void 0:u.length)||0,isNew:Number(s.isNew)||0,isyq:s.isyq||"0",participantsAvatarList:s.participantsAvatarList?s.participantsAvatarList:[],createTime:s.createTime}};return t.useEffect(()=>{K&&A&&A.length>0&&r()},[O,h,A,K]),t.useEffect(()=>{$(!L&&!F)},[L,F,$]),t.useEffect(()=>{const s=()=>{if(!D.current)return;const u=D.current.scrollTop,d=u>Z.current?"down":"up";Math.abs(u-Z.current)>50&&(a(d!=="down"),Z.current=u)};return D.current&&D.current.addEventListener("scroll",s),()=>{D.current&&D.current.removeEventListener("scroll",s)}},[]),e.jsxs("div",{className:"flex flex-col bg-gray-100 w-full max-w-full overflow-x-hidden",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white px-2 sm:px-4 py-2 shadow-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(rs,{searchTerm:h,setSearchTerm:v,clearSearch:Y}),e.jsx("button",{className:"flex-shrink-0 w-10 h-10 ml-2 sm:w-12 sm:h-12 bg-white rounded border border-[#E8E8E8] flex items-center justify-center",onClick:()=>x(!0),"aria-label":"筛选任务",children:e.jsx(be,{className:"h-5 w-5 text-[#666666]"})})]})}),e.jsxs("div",{className:"flex-1 overflow-auto bg-white w-full max-w-full",ref:D,children:[e.jsx("div",{className:"bg-white rounded-t-lg p-4 sm:p-4",children:e.jsxs("button",{className:"w-full py-2 sm:py-3 border border-dashed border-[#C1C1C1] flex items-center justify-center text-gray-500 rounded-lg text-base sm:text-base font-bold",onClick:()=>{T(!0)},"aria-label":"创建任务",children:[e.jsx(Je,{className:"h-5 w-5 mr-2 text-[#C1C1C1]"}),e.jsx("span",{className:"text-black",children:"任务创建"})]})}),e.jsx("div",{className:"pb-2 sm:pb-4",children:oe?e.jsx("div",{className:"p-4 text-center",children:"加载中..."}):V.length===0?e.jsx(ls,{}):e.jsx(ss,{taskGroups:V,searchTerm:h})}),e.jsx("div",{className:"h-40"})]}),L&&e.jsx(ts,{onClose:()=>x(!1),onApply:N,selectedGroups:n,selectedDateRange:p,selectedProject:g,taskGroups:A,projectList:c,selectedLoginUser:y}),e.jsx(as,{isOpen:F,onClose:()=>T(!1),onCreateTask:H,taskGroups:A,projectList0:c,newProject:g})]})}function ns({onScrollDirectionChange:a,updateTaskCount:E}){return e.jsx(os,{onScrollDirectionChange:a,updateTaskCount:E})}const vs=Object.freeze(Object.defineProperty({__proto__:null,default:ns},Symbol.toStringTag,{value:"Module"}));export{re as C,be as F,ns as T,Xe as a,vs as i};
