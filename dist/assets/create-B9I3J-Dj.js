import{r as l,j as e,d as Be,u as He,X as ee,t as N}from"./index-CBGP0-9V.js";import{D as Ue}from"./date-picker-Bebv3-qP.js";import{C as We}from"./checkbox-BwjNAnVK.js";import{S as _e,a as Ge}from"./sheet-DoL-zHHZ.js";import{I as $e}from"./input-CZNvtCT8.js";import{A as _,a as G,b as $}from"./avatar-CZoOSk0v.js";import{S as ae}from"./search-DxQ-bB_0.js";import{C as W}from"./index-DCyT9wRJ.js";import{f as Ve,h as Fe,a as Pe}from"./task-CaSVpYz-.js";import{d as qe}from"./public-DIX_InEl.js";import{c as te}from"./publicFun-CiZ9vL8Y.js";import{C as Oe}from"./chevron-left-BTOK750O.js";import{C as se}from"./check-4WT4jp_I.js";import"./chevron-right-Bag1OeAJ.js";import"./index-S6Ml47UC.js";import"./index-D-Z7Lifn.js";import"./index-jn0p1ufw.js";import"./request-CRuLXg2Q.js";function je({open:V,onClose:L,onSelect:M,groupUserList:w,isMulti:f=!1,selectedUsers:D=[],title:A=""}){const[R,F]=l.useState(""),T=l.useRef(null);l.useRef({});const[y,re]=l.useState({}),[d,P]=l.useState(D),[v,B]=l.useState(""),q=d.length>0,le=a=>{re(c=>({...c,[a]:!c[a]}))},O=a=>{B(a.target.value),F(a.target.value)},j=l.useMemo(()=>{if(w.length>0){let a=v.toLowerCase();return w.filter(c=>{const m=c.bmName.toLowerCase().includes(a),u=c.userList.filter(h=>{var k,U;return h.userName.toLowerCase().includes(a)||((k=h.zwList)==null?void 0:k.some(b=>b.toLowerCase().includes(a)))||((U=h.bmList)==null?void 0:U.some(b=>b.toLowerCase().includes(a)))});return m||u.length>0})}else return[]},[w,v]),H=()=>{if(!T.current)return;T.current.getBoundingClientRect().top},ne=a=>{let c;d.length>0?c=d.some(u=>u.id===a.id):c=!1;let m;f?m=c?d.filter(u=>u.id!==a.id):[...d,a]:m=c?[]:[a],P(m)},ie=a=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded cursor-pointer",onClick:()=>le(a.bmName),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:a.bmName}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",a.size,")"]})]}),e.jsx(W,{className:`w-4 h-4 transition-transform ${y[a.bmName]?"rotate-180":""}`})]}),oe=a=>{var m,u;let c;return d.length>0?c=d.some(h=>h.id===a.id):c=!1,e.jsxs("div",{className:"flex items-center p-2 bg-white rounded-lg cursor-pointer mb-2",onClick:()=>ne(a),children:[e.jsx(We,{checked:c,className:"mr-3 rounded-full w-5 h-5 data-[state=checked]:bg-blue-600 data-[state=checked]:border-blue-600"}),e.jsxs(_,{className:"w-10 h-10 rounded-full object-cover mr-3 border-2 border-white",children:[e.jsx(G,{src:a.avatar}),e.jsx($,{children:a.userName.slice(0,1)})]},a.id),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-gray-800 mb-1",children:a.userName}),e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:(m=a.zwList)==null?void 0:m.join("  ")}),e.jsx("div",{className:"text-sm text-gray-500 mb-1",children:(a==null?void 0:a.bmList)&&((u=a==null?void 0:a.bmList)==null?void 0:u.length)&&(a==null?void 0:a.bmList.length)>0&&a.bmList.map((h,k)=>e.jsx("span",{className:"text-xs px-2.5 py-1 rounded-full font-medium bg-gray-100 text-gray-500",children:h},"user_bm"+a.id+"_"+k))})]})]},"uid"+a.id)},ce=()=>{console.log("handleSubmit"),console.log("localSelected",d),M(d),L()};return e.jsx(_e,{open:V,onOpenChange:L,children:e.jsxs(Ge,{side:"bottom",className:"p-0 rounded-t-xl bg-white gap-0",children:[e.jsxs("div",{className:"p-2 ",children:[e.jsx("div",{className:"text-lg font-bold mb-4 flex-1 text-center",children:A}),e.jsxs("div",{className:"relative mb-1 ",children:[e.jsx(ae,{className:"absolute left-3 top-2 -translate-y-1/2 w-4 h-4 text-[#6A7282]"}),e.jsx($e,{type:"text",placeholder:"搜索",className:"placeholder:text-[13px] pl-9 focus-visible:ring-0 focus-visible:ring-offset-0 shadow-none bg-white border border-[#E8E8E8] rounded-xl",value:R,onChange:O})]}),e.jsx("div",{className:"flex",children:e.jsx("div",{ref:T,className:"flex-1 space-y-2 max-h-[calc(80vh-6rem)] overflow-y-auto",onScroll:H})})]}),e.jsx("div",{className:"flex",children:e.jsx("div",{className:"flex-1 max-h-[calc(80vh-6rem)] overflow-y-auto bg-gray-50",children:j.map((a,c)=>e.jsxs("div",{className:"mb-2",children:[ie(a),y[a.bmName]&&e.jsx("div",{className:"bg-gray-50 p-2",children:a.userList.filter(m=>m.userName.toLowerCase().includes(v.toLowerCase())||a.bmName.toLowerCase().includes(v.toLowerCase())).map(oe)})]},c+a.bmName))})}),e.jsx("div",{className:"sticky bottom-0  bg-white py-4",children:e.jsxs("div",{className:"flex justify-end items-center",children:[e.jsx("div",{className:"flex items-center gap-2 flex-1 overflow-hidden",children:q&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-black whitespace-nowrap ml-2 mr-2",children:["已选(",d.length,")"]}),e.jsxs("div",{className:"flex -space-x-2",children:[d.length>0&&d.slice(0,8).map((a,c)=>e.jsxs(_,{className:"w-8 h-8 ml-[-10px] border-2 border-white shadow-sm bg-[#EEEEEE]",children:[e.jsx(G,{src:a.avatar}),e.jsx($,{className:"text-xs",children:a.userName.slice(0,1)})]},`selected-${a.id}`)),d.length>8&&e.jsxs("div",{className:` w-8 h-8 rounded-full bg-[#EEEEEE] border-2 border-white\r
              flex items-center justify-center text-xs font-medium text-gray-600 shadow-sm`,style:{zIndex:100},children:["+",d.length-8]},"selected-100")]})]})}),e.jsx("button",{className:"px-7 py-2 bg-black hover:bg-gray-700 text-white rounded-l-full transition-colors shadow-md active:scale-95",onClick:ce,children:"确定"})]})})]})})}function mt(){var fe,ge;const V=Be(),L=l.useRef(!1),M=He(),[w,f]=l.useState(!1),[D,A]=l.useState(""),[R,F]=l.useState("起始日期-结束日期"),[T,y]=l.useState(!1),[re,d]=l.useState(""),[P,v]=l.useState(!1),[B,q]=l.useState([]),[le,O]=l.useState(!1),[j,H]=l.useState(""),[ne,ie]=l.useState(!1),[oe,ce]=l.useState([]),[a,c]=l.useState(!1),[m,u]=l.useState(!1),[h,k]=l.useState([]),[U,b]=l.useState(!1),[C,be]=l.useState(null),[de,Ne]=l.useState(null),[xe,we]=l.useState(null);l.useRef(null);const[Ye,Ke]=l.useState(!1),[S,ye]=l.useState([]),[Y,ke]=l.useState([]),[z,Ce]=l.useState(null),[he,K]=l.useState(!1),[X,Se]=l.useState(""),[pe,J]=l.useState(!1),[Q,Ee]=l.useState(""),[x,g]=l.useState({}),[s,p]=l.useState({name:"",description:"",userList:[],dateRange:"",projectId:0,projectName:"",taskType:"",group:0,subTaskList:[],attachmentList:[],approverId:""}),Le=t=>{p({...s,dateRange:t}),F(t),y(!1),g(r=>({...r,dateRange:""}))};l.useEffect(()=>{if(!s.name&&!s.description&&!s.dateRange&&!s.group&&!s.taskType&&s.userList.length==0&&!s.approverId){A("");return}A("")},[s]);const Te=async()=>{const t={};if(s.name||(t.name="请填写任务标题"),s.description||(t.description="请填写任务描述"),s.dateRange||(t.dateRange="请选择日期范围"),s.group||(t.group="请选择业务域"),s.taskType||(t.taskType="请选择任务类型"),s.userList.length===0&&(t.userList="请选择执行人"),(!s.approverId||s.approverId.length===0)&&(t.approverId="请选择审批人"),Object.keys(t).length>0){g(t),N({variant:"destructive",title:"请填写完整信息"});const o=Object.keys(t)[0],E=document.getElementById(o);E&&E.scrollIntoView({behavior:"smooth",block:"center"}),f(!1);return}if(D){N({variant:"destructive",title:"请填写完整信息",description:D}),f(!1);return}let r="",n="";if(s.dateRange){let o,E;s.dateRange.includes("-")?(o=s.dateRange.split(" - ")[0],E=s.dateRange.split(" - ")[1],o&&(r=te(o)),E&&(n=te(E))):(o=s.dateRange.split(" - ")[0],o&&(r=te(o)))}let i=[];s.subTaskList.length>0&&s.subTaskList.forEach(o=>{o&&i.push({subtaskTitle:o})}),j.trim()!==""&&i.push({subtaskTitle:j});let I=[];s.attachmentList.length>0&&s.attachmentList.forEach(o=>{o&&o.url&&!o.id&&I.push(o.url)});let Z=s.userList.length>0?s.userList.map(o=>o.id):[],Re=s.approverId.length>0?s.approverId.map(o=>o.id):[],ve={taskTitle:s.name,taskDescription:s.description,participantsList:Z,projectId:s.projectId,startDate:r,endDate:n,taskGroup:String(s.group),taskType:s.taskType,subtaskList:i,attachment:I.length>0?I.join(","):"",approverIdList:Re};z&&z.id&&(ve.templateId=z.id);try{f(!0);const o=await Ve(ve);o?(N({description:e.jsxs("div",{className:"flex flex-col items-center justify-center min-w-[200px] min-h-[100px]",children:[e.jsx(se,{className:"w-10 h-10 mb-1"}),e.jsx("span",{className:"text-lg font-medium",children:"成功"})]}),variant:"default",duration:1e3}),setTimeout(()=>{M("/app/workspace")},1e3)):(N({variant:"destructive",title:"任务创建失败",description:o.message}),f(!1))}catch{N({variant:"destructive",title:"任务创建失败",description:res.message}),f(!1)}finally{f(!1)}},ze=async t=>{try{const r=await Fe({projectId:t});q(r)}catch(r){N({variant:"destructive",title:"获取数据失败",description:(r==null?void 0:r.msg)||"获取数据失败"})}},Ie=async()=>{Pe({fieldName:"taskType"}).then(async t=>{ye(t||[])}).catch(t=>{N({variant:"destructive",title:"获取任务类型失败",description:(t==null?void 0:t.msg)||"请稍后重试"})})};l.useEffect(()=>{var t,r;if(!L.current){L.current=!0;const n=V.state||{};console.log(n);const i=((t=n.project)==null?void 0:t.id)||localStorage.getItem("projectId"),I=((r=n.project)==null?void 0:r.name)||localStorage.getItem("projectName");p(Z=>({...Z,projectId:Number(i),projectName:I||"",group:n!=null&&n.group?Number(n.group):0,attachmentList:[]})),Ce((n==null?void 0:n.template)||null),ze(i),Ie(),Me(i)}},[]);const Me=async t=>{try{const r=await qe({projectId:t,pageNo:1,pageSize:100});ke(r.list.map(n=>({key:n.id,value:n.name}))||[])}catch{}},me=l.useMemo(()=>Y.filter(t=>t.value.toLowerCase().includes(X.toLowerCase())),[Y,X]),ue=l.useMemo(()=>S.filter(t=>t.value.toLowerCase().includes(Q.toLowerCase())),[S,Q]);l.useEffect(()=>{S.length>0&&!s.taskType&&p(t=>({...t,taskType:S[0].key}))},[S]);const De=t=>{console.log("handleUserSelect");let r=[],n=null;t.length>0&&(r=t.map(i=>({id:i.id,userName:i.userName,avatar:i.avatar,zwList:i.zwList,bmList:i.bmList})),n=t[0]),k(r),Ne(n),p(i=>({...i,userList:r})),g(i=>({...i,userList:""}))},Ae=t=>{let r=[],n=null;t.length>0&&(r=t.map(i=>({id:i.id,userName:i.userName,avatar:i.avatar,zwList:i.zwList,bmList:i.bmList})),n=t[0]),be(r),we(n),p(i=>({...i,approverId:r})),b(!1),g(i=>({...i,approverId:""}))};return e.jsxs("div",{className:"min-h-[100dvh] bg-[#F8F8F8]",children:[e.jsxs("div",{className:"flex items-center px-3 py-4",children:[e.jsx(Oe,{className:"w-6 h-6",onClick:()=>M("/app/workspace")}),e.jsx("span",{className:"flex-1 text-center text-[18px] font-[600] mr-6",children:"任务创建"})]}),e.jsxs("div",{className:"px-0",children:[e.jsxs("div",{className:"bg-white rounded-2xl px-2 space-y-0",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8"})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center pl-10",children:e.jsx("span",{className:"text-black font-bold text-[14px]",children:s.projectName})}),e.jsx("div",{className:"w-full h-16 pl-10 bg-transparent text-[14px] border-b border-[#ECECEC] focus:border-[#0363E0] focus:outline-none transition-colors"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"absolute left-3 top-6 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"}),e.jsx("path",{d:"M4 22v-7"})]}),e.jsxs("div",{className:"relative w-full",id:"name",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center pl-10",children:!s.name&&e.jsxs("span",{className:"text-[#999999] text-[13px]",children:["任务标题",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),e.jsx("textarea",{id:"taskName",value:s.name,onChange:t=>{p({...s,name:t.target.value}),g(r=>({...r,name:""})),t.target.scrollHeight>64&&(t.target.style.height="auto",t.target.style.height=`${t.target.scrollHeight}px`)},className:"w-full min-h-[64px] pl-10 pr-8 bg-transparent  text-[14px] border-b border-[#ECECEC] focus:border-[#0363E0] focus:outline-none transition-colors leading-[1.5] resize-none overflow-hidden",style:{boxSizing:"border-box",lineHeight:"24px",paddingTop:"20px",paddingBottom:"20px"},rows:1,maxLength:100}),s.name&&e.jsx(ee,{className:"absolute right-4 top-6 -translate-y-1/2 w-4 h-4 text-[#999999] cursor-pointer z-[1]",onClick:()=>{p({...s,name:""});const t=document.querySelector("#taskName");t&&(t.style.height="64px")}}),x.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1 pl-10",children:x.name})]})]}),e.jsxs("div",{className:"relative",id:"description",children:[e.jsxs("svg",{className:"absolute left-3 top-6 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M17 3L21 7L7 21H3V17L17 3z"}),e.jsx("path",{d:"M15 5L19 9"})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center pl-10",children:!s.description&&e.jsxs("span",{className:"text-[#999999] text-[13px]",children:["任务描述",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),e.jsx("textarea",{id:"taskDescription",value:s.description,onChange:t=>{p({...s,description:t.target.value}),g(r=>({...r,description:""})),t.target.scrollHeight>64&&(t.target.style.height="auto",t.target.style.height=`${t.target.scrollHeight}px`)},className:"w-full min-h-[64px] pl-10 pr-8 bg-transparent  text-[14px] border-b border-[#ECECEC] focus:border-[#0363E0] focus:outline-none transition-colors leading-[1.5] resize-none overflow-hidden",style:{boxSizing:"border-box",lineHeight:"24px",paddingTop:"20px",paddingBottom:"20px"},rows:1,maxLength:100}),s.description&&e.jsx(ee,{className:"absolute right-4 top-6 -translate-y-1/2 w-4 h-4 text-[#999999] cursor-pointer z-[1]",onClick:()=>{p({...s,description:""});const t=document.querySelector("#taskDescription");t&&(t.style.height="64px")}})]}),x.description&&e.jsx("p",{className:"text-red-500 text-xs mt-1 pl-10",children:x.description})]}),e.jsxs("div",{className:"relative",id:"userList",children:[e.jsxs("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"7",r:"4"}),e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("path",{d:"M17 11l2 2 4-4"})]}),e.jsxs("div",{className:"relative flex items-center w-full",onClick:()=>v(!0),children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center pl-10",children:s.userList.length==0?e.jsxs("span",{className:"text-[#999999] text-[13px]",children:["执行人",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}):e.jsxs("span",{className:"text-gray-700 text-[13px]",children:[de.userName,s.userList.length>1&&e.jsxs("span",{className:"text-gray-400 pl-2",children:["(",de.userName,"等",s.userList.length,"人执行)"]})]})}),e.jsx("div",{className:"w-full h-16 pl-10 pr-12 bg-transparent text-[14px] border-b border-[#ECECEC] focus:border-[#0363E0] focus:outline-none transition-colors"}),s.userList.length==0?e.jsx("button",{className:"dense-dashed absolute right-3 top-5 -translate-y-1/2 w-7 h-7 rounded-full bg-white flex items-center justify-center hover:bg-[#0363E0] transition-colors aspect-square",type:"button",children:e.jsx("svg",{className:"w-5 h-5 text-[#6A7282] hover:text-white transition-colors",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 5v14M5 12h14"})})}):e.jsx("div",{className:"flex items-center gap-1 ml-auto",children:e.jsxs("div",{className:"relative flex items-center h-full",style:{width:`${Math.min(h.length,3)*30}px`},children:[h.slice(0,3).map((t,r)=>{var n;return e.jsxs(_,{className:"w-7 h-7 rounded-full border-2 border-white shadow-sm  absolute",style:{left:`${r*16}px`,top:"50%",transform:"translateY(-50%)",zIndex:r+1},children:[e.jsx(G,{src:t.avatar}),e.jsx($,{children:(n=t==null?void 0:t.userName)==null?void 0:n.slice(0,1)})]},t.id)}),h.length>3&&e.jsxs("div",{className:`absolute left-[48px] w-8 h-8 rounded-full bg-gray-100 border-2 border-white\r
              flex items-center justify-center text-xs font-medium text-gray-600 shadow-sm`,style:{top:"50%",transform:"translateY(-50%)",zIndex:4},children:["+",h.length-3]})]})})]}),x.userList&&e.jsx("p",{className:"text-red-500 text-xs mt-1 pl-10",children:x.userList})]}),e.jsxs("div",{className:"relative",id:"dateRange",children:[e.jsxs("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]}),e.jsxs("div",{className:"relative w-full",onClick:()=>y(!0),children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center pl-10",children:s.dateRange?e.jsx("span",{className:"text-black text-[13px]",children:R}):e.jsxs("span",{className:"text-[#999999] text-[13px]",children:[R,e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})}),e.jsx("div",{className:"w-full h-16 pl-10 bg-transparent text-[14px] border-b border-[#ECECEC] focus:border-[#0363E0] focus:outline-none transition-colors"}),e.jsx(W,{className:"absolute right-3 top-5 -translate-y-1/2 w-7 h-7 text-[#6A7282] pointer-events-none"})]}),x.dateRange&&e.jsx("p",{className:"text-red-500 text-xs mt-1 pl-10",children:x.dateRange})]}),e.jsxs("div",{className:"relative",children:[e.jsx("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"})}),e.jsxs("div",{className:"relative w-full",id:"group",children:[e.jsx("div",{className:"h-16 flex justify-between items-center  border-b border-[#ECECEC] cursor-pointer pl-10 pr-12",onClick:()=>{K(!he),J(!1)},children:e.jsx("span",{children:s.group?(fe=Y.find(t=>Number(t.key)===s.group))==null?void 0:fe.value:"请选择业务域"})}),e.jsx(W,{className:"absolute right-3 top-5 -translate-y-1/2 w-7 h-7 text-[#6A7282] pointer-events-none"}),he&&e.jsxs("div",{className:"absolute z-50 left-0 right-0 mt-1 border border-[#E8E8E8] rounded-lg overflow-hidden bg-white shadow-lg",children:[e.jsxs("div",{className:"p-2 border-b flex items-center border-[#E8E8E8]",children:[e.jsx(ae,{className:"h-5 w-5 text-[#6A7282] mr-2"}),e.jsx("input",{type:"text",placeholder:"搜索业务域",className:"w-full outline-none placeholder:text-[#8C8C8C]",value:X,onChange:t=>Se(t.target.value)})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:me.length>0?me.map(t=>e.jsxs("div",{className:`p-3 flex justify-between items-center ${s.group===Number(t.key)?"bg-gray-100":""}`,onClick:()=>{p({...s,group:Number(t.key)}),g(r=>({...r,group:""})),K(!1)},children:[e.jsx("span",{children:t.value}),s.group===Number(t.key)&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(se,{className:"h-4 w-4 text-white"})})]},t.key)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"没有找到相关业务域"})})]})]}),x.group&&e.jsx("p",{className:"text-red-500 text-xs mt-1 pl-10",children:x.group})]}),e.jsxs("div",{className:"relative",id:"taskType",children:[e.jsx("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5.586a1 1 0 0 1 .707.293l5.414 5.414a1 1 0 0 1 .293.707V19a2 2 0 0 1-2 2z"})}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:"h-16 flex justify-between items-center  border-b border-[#ECECEC] cursor-pointer pl-10 pr-12",onClick:()=>{J(!pe),K(!1)},children:e.jsx("span",{children:s.taskType?(ge=S.find(t=>t.key===s.taskType))==null?void 0:ge.value:"请选择任务类型"})}),e.jsx(W,{className:"absolute right-3 top-5 -translate-y-1/2 w-7 h-7 text-[#6A7282] pointer-events-none"}),pe&&e.jsxs("div",{className:"absolute z-50 left-0 right-0 mt-1 border border-[#E8E8E8] rounded-lg overflow-hidden bg-white shadow-lg",children:[e.jsxs("div",{className:"p-2 border-b flex items-center border-[#E8E8E8]",children:[e.jsx(ae,{className:"h-5 w-5 text-[#6A7282] mr-2"}),e.jsx("input",{type:"text",placeholder:"搜索任务类型",className:"w-full outline-none placeholder:text-[#8C8C8C]",value:Q,onChange:t=>Ee(t.target.value)})]}),e.jsx("div",{className:"max-h-60 overflow-y-auto",children:ue.length>0?ue.map(t=>e.jsxs("div",{className:`p-3 flex justify-between items-center ${s.taskType===t.key?"bg-gray-100":""}`,onClick:()=>{p({...s,taskType:t.key}),g(r=>({...r,taskType:""})),J(!1)},children:[e.jsx("span",{children:t.value}),s.taskType===t.key&&e.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx(se,{className:"h-4 w-4 text-white"})})]},t.key)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"没有找到相关任务类型"})})]})]}),x.taskType&&e.jsx("p",{className:"text-red-500 text-xs mt-1 pl-10",children:x.taskType})]}),s.subTaskList&&s.subTaskList.map((t,r)=>e.jsxs("div",{className:"relative",children:[r==0&&e.jsxs("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M6 3v12M18 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM6 21a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}),e.jsx("path",{d:"M18 9a9 9 0 0 1-9 9"})]}),e.jsx("div",{className:" space-y-4",children:e.jsxs("div",{className:"min-h-16 flex items-center py-4 border-b border-[#ECECEC] pl-10 pr-8 relative",children:[e.jsx("span",{className:"pr-0 text-[14px] flex items-center",children:t}),e.jsx(ee,{className:"absolute right-3 top-5 -translate-y-1/2 w-7 h-7 text-[#6A7282] hover:text-red-500 cursor-pointer",onClick:()=>{const n=[...s.subTaskList];n.splice(r,1),p({...s,subTaskList:n})}})]})})]},r)),e.jsxs("div",{className:"relative",children:[s.subTaskList.length==0&&e.jsxs("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M6 3v12M18 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM6 21a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}),e.jsx("path",{d:"M18 9a9 9 0 0 1-9 9"})]}),e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"w-full flex min-h-[64px] gap-2 pl-10 pr-0 border-b border-[#ECECEC] items-center",children:[e.jsx("textarea",{id:"subTask",placeholder:"输入子任务",value:j,onChange:t=>{H(t.target.value),t.target.scrollHeight>64&&(t.target.style.height="auto",t.target.style.height=`${t.target.scrollHeight}px`)},className:`flex-1 w-full py-4 bg-transparent text-[14px]\r
               focus:border-[#0363E0] focus:outline-none transition-colors\r
               leading-[1.5] resize-none overflow-hidden placeholder:text-[#999999]`,style:{boxSizing:"border-box",lineHeight:"24px",minHeight:"auto",alignSelf:"center"},rows:1,maxLength:100}),e.jsx("button",{className:"dense-dashed absolute right-3 top-6 -translate-y-1/2 w-7 h-7 rounded-full bg-white flex items-center justify-center hover:bg-[#0363E0] transition-colors aspect-square",type:"button",onClick:()=>{j&&p({...s,subTaskList:[...s.subTaskList,j]}),H(""),O(!1)},children:e.jsx("svg",{className:"w-5 h-5 text-[#6A7282] hover:text-white transition-colors",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 5v14M5 12h14"})})})]})})]}),z&&e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("path",{d:"M14 2v6h6"}),e.jsx("line",{x1:"8",y1:"12",x2:"16",y2:"12"}),e.jsx("line",{x1:"8",y1:"15",x2:"16",y2:"15"}),e.jsx("line",{x1:"8",y1:"18",x2:"16",y2:"18"}),e.jsx("line",{x1:"10",y1:"10",x2:"10",y2:"20"}),e.jsx("line",{x1:"13",y1:"10",x2:"13",y2:"20"})]}),e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center pl-10",children:e.jsxs("span",{className:"text-black text-[14px]",children:["模板：",e.jsx("span",{className:"text-blue-800",children:z.name})]})}),e.jsx("div",{className:"w-full h-16 pl-10 bg-transparent text-[14px] border-b border-[#ECECEC] focus:border-[#0363E0] focus:outline-none transition-colors"})]})]}),e.jsxs("div",{className:"relative",id:"approverId",children:[e.jsxs("svg",{className:"absolute left-3 top-5 -translate-y-1/2 w-5 h-5 text-[#6A7282] z-[1]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"7",r:"4"}),e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"})]}),e.jsxs("div",{className:"relative flex items-center  w-full",onClick:()=>b(!0),children:[e.jsx("div",{className:"absolute inset-0 pointer-events-none flex items-center pl-10",children:s.approverId.length==0?e.jsxs("span",{className:"text-[#999999] text-[13px]",children:["审批人",e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}):e.jsxs("span",{className:"text-gray-700 text-[13px]",children:[xe.userName,s.approverId.length>1&&e.jsxs("span",{className:"text-gray-400 pl-2",children:["(",xe.userName,"等",s.approverId.length,"人审批)"]})]})}),e.jsx("div",{className:"w-full h-16 pl-10 pr-12 bg-transparent text-[14px] border-b border-[#ECECEC] focus:border-[#0363E0] focus:outline-none transition-colors"}),s.approverId.length==0?e.jsx("button",{className:"dense-dashed absolute right-3 top-5 -translate-y-1/2 w-7 h-7 rounded-full bg-white flex items-center justify-center hover:bg-[#0363E0] transition-colors aspect-square",type:"button",children:e.jsx("svg",{className:"w-5 h-5 text-[#6A7282] hover:text-white transition-colors",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 5v14M5 12h14"})})}):e.jsx("div",{className:"flex items-center gap-1 ml-auto",children:e.jsxs("div",{className:"relative flex items-center h-full",style:{width:`${Math.min(C.length,3)*30}px`},children:[C.slice(0,3).map((t,r)=>{var n;return e.jsxs(_,{className:"w-7 h-7 rounded-full border-2 border-white shadow-sm  absolute",style:{left:`${r*16}px`,top:"50%",transform:"translateY(-50%)",zIndex:r+1},children:[e.jsx(G,{src:t.avatar}),e.jsx($,{children:(n=t==null?void 0:t.userName)==null?void 0:n.slice(0,1)})]},t.id)}),C.length>3&&e.jsxs("div",{className:`absolute left-[48px] w-8 h-8 rounded-full bg-gray-100 border-2 border-white\r
              flex items-center justify-center text-xs font-medium text-gray-600 shadow-sm`,style:{top:"50%",transform:"translateY(-50%)",zIndex:4},children:["+",C.length-3]})]})})]}),x.approverId&&e.jsx("p",{className:"text-red-500 text-xs mt-1 pl-10",children:x.approverId})]}),e.jsx("div",{className:"h-[100px]"})]}),e.jsx("button",{className:"absolute bottom-8 w-full h-[35px] bg-black text-white rounded-full text-[14px] font-medium hover:bg-black/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed z-50",onClick:Te,disabled:w,children:w?"保存中...":"保存"})]}),e.jsx(Ue,{isOpen:T,onClose:()=>y(!1),onSelect:Le,position:"bottom"}),e.jsx(je,{title:"添加执行人",open:P,onClose:()=>{v(!1)},onSelect:De,groupUserList:B,isMulti:!0,selectedUsers:h}),e.jsx(je,{title:"添加审批人",open:U,onClose:()=>b(!1),onSelect:Ae,groupUserList:B,isMulti:!0,selectedUsers:C?[C]:[]})]})}export{mt as default};
